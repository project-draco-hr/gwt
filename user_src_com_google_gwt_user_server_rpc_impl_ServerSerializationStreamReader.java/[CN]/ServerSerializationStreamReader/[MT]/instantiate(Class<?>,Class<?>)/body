{
  if (customSerializer != null) {
    for (    Method method : customSerializer.getMethods()) {
      if ("instantiate".equals(method.getName())) {
        return method.invoke(null,this);
      }
    }
  }
  if (instanceClass.isArray()) {
    int length=readInt();
    return new BoundedList<Object>(instanceClass.getComponentType(),length);
  }
 else   if (instanceClass.isEnum()) {
    Enum<?>[] enumConstants=(Enum[])instanceClass.getEnumConstants();
    int ordinal=readInt();
    assert(ordinal >= 0 && ordinal < enumConstants.length);
    return enumConstants[ordinal];
  }
 else {
    Constructor<?> constructor=instanceClass.getDeclaredConstructor();
    constructor.setAccessible(true);
    return constructor.newInstance();
  }
}
