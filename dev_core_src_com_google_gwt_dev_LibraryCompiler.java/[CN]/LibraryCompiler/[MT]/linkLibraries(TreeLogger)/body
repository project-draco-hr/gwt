{
  long beforeLinkMs=System.currentTimeMillis();
  Event linkEvent=SpeedTracerLogger.start(CompilerEventType.LINK);
  try {
    resultLibrary=new ZipLibrary(compilerOptions.getOutputLibraryPath());
  }
 catch (  IncompatibleLibraryVersionException e) {
    logger.log(TreeLogger.ERROR,e.getMessage());
    throw new UnableToCompleteException();
  }
  generatedArtifacts.addAll(libraryGroup.getGeneratedArtifacts());
  Set<PermutationResult> libraryPermutationResults=Sets.newLinkedHashSet();
  List<PersistenceBackedObject<PermutationResult>> resultFiles=Lists.newArrayList();
  resultFiles.add(resultLibrary.getPermutationResultHandle());
  List<PersistenceBackedObject<PermutationResult>> permutationResultHandles=libraryGroup.getPermutationResultHandlesInLinkOrder();
  for (  PersistenceBackedObject<PermutationResult> permutationResultHandle : permutationResultHandles) {
    libraryPermutationResults.add(permutationResultHandle.newInstance(logger));
  }
  File absPath=new File(compilerOptions.getWarDir(),module.getName());
  absPath=absPath.getAbsoluteFile();
  try {
    Link.link(TreeLogger.NULL,module,compilerContext.getPublicResourceOracle(),generatedArtifacts,permutations,resultFiles,libraryPermutationResults,compilerOptions,compilerOptions);
    long durationMs=System.currentTimeMillis() - beforeLinkMs;
    logger.log(TreeLogger.INFO,String.format("%.3fs -- Successfully linking application",durationMs / 1000d));
  }
 catch (  IOException e) {
    long durationMs=System.currentTimeMillis() - beforeLinkMs;
    logger.log(TreeLogger.INFO,String.format("%.3fs -- Failing to link application",durationMs / 1000d));
    throw new UnableToCompleteException();
  }
  linkEvent.end();
}
