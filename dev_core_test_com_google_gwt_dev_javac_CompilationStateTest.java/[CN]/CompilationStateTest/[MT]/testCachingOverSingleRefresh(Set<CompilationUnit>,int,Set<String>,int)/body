{
  assertEquals(0,state.graveyardUnits.size());
  assertUnitsChecked(state.getCompilationUnits());
  state.refresh(createTreeLogger());
  assertEquals(graveyardUnitsSize,state.graveyardUnits.size());
  int initialSize=state.graveyardUnits.size();
  Map<String,CompilationUnit> usefulUnits=state.getUsefulGraveyardUnits(generatedCups);
  assertEquals(reusedTypes.size(),usefulUnits.size());
  for (  String typeName : reusedTypes) {
    assertNotNull(usefulUnits.get(typeName));
  }
  assertEquals(numInvalidated,initialSize - reusedTypes.size() - state.graveyardUnits.size());
  state.addGeneratedCompilationUnits(createTreeLogger(),generatedCups,usefulUnits);
  assertUnitsChecked(state.getCompilationUnits());
}
