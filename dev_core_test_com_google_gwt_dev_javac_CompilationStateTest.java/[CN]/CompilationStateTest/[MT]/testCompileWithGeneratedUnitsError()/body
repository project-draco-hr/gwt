{
  assertUnitsChecked(state.getCompilationUnits());
  state.addGeneratedCompilationUnits(createTreeLogger(),getCompilationUnits(JavaSourceCodeBase.BAR));
  CompilationUnit badUnit=state.getCompilationUnitMap().get(JavaSourceCodeBase.BAR.getTypeName());
  assertSame(State.ERROR,badUnit.getState());
  Set<CompilationUnit> goodUnits=new HashSet<CompilationUnit>(state.getCompilationUnits());
  goodUnits.remove(badUnit);
  assertUnitsChecked(goodUnits);
}
