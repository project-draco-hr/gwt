{
  compilerContext.getOptions().setCompilePerFile(compilePerFile);
  MinimalRebuildCache minimalRebuildCache=compilerContext.getMinimalRebuildCache();
  validateCompilationState();
  assertFalse(minimalRebuildCache.getModifiedCompilationUnitNames().contains("test.Foo"));
  addGeneratedUnits(JavaResourceBase.FOO);
  validateCompilationState(Shared.getTypeName(JavaResourceBase.FOO));
  assertEquals(compilePerFile,minimalRebuildCache.getModifiedCompilationUnitNames().contains("test.Foo"));
  rebuildCompilationState();
  validateCompilationState();
}
