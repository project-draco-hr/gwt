{
  oracle.add(JavaResourceBase.BAR);
  rebuildCompilationState();
  CompilationUnit badUnit=state.getCompilationUnitMap().get(Shared.getTypeName(JavaResourceBase.BAR));
  assertSame(State.ERROR,badUnit.getState());
  Set<CompilationUnit> goodUnits=new HashSet<CompilationUnit>(state.getCompilationUnits());
  goodUnits.remove(badUnit);
  assertUnitsChecked(goodUnits);
}
