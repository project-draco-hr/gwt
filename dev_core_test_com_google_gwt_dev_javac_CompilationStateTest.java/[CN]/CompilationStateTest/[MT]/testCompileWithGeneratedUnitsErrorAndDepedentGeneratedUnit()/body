{
  assertUnitsChecked(state.getCompilationUnits());
  MockJavaResource badFoo=new MockJavaResource(Shared.getTypeName(JavaResourceBase.FOO)){
    @Override protected CharSequence getContent(){
      return Shared.readSource(JavaResourceBase.FOO) + "\ncompilation error LOL!";
    }
  }
;
  oracle.add(badFoo);
  rebuildCompilationState();
  addGeneratedUnits(JavaResourceBase.BAR);
  CompilationUnit badUnit=state.getCompilationUnitMap().get(Shared.getTypeName(badFoo));
  assertSame(State.ERROR,badUnit.getState());
  CompilationUnit invalidUnit=state.getCompilationUnitMap().get(Shared.getTypeName(JavaResourceBase.BAR));
  assertSame(State.ERROR,invalidUnit.getState());
  Set<CompilationUnit> goodUnits=new HashSet<CompilationUnit>(state.getCompilationUnits());
  goodUnits.remove(badUnit);
  goodUnits.remove(invalidUnit);
  assertUnitsChecked(goodUnits);
}
