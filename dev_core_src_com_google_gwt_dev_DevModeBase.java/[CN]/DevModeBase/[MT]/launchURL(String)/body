{
  URL parsedUrl=null;
  try {
    parsedUrl=new URL(url);
    String path=parsedUrl.getPath();
    String query=parsedUrl.getQuery();
    String hash=parsedUrl.getRef();
    String hostedParam=BrowserListener.getDevModeURLParams(listener.getEndpointIdentifier());
    if (query == null) {
      query=hostedParam;
    }
 else {
      query+='&' + hostedParam;
    }
    path+='?' + query;
    if (hash != null) {
      path+='#' + hash;
    }
    parsedUrl=new URL(parsedUrl.getProtocol(),parsedUrl.getHost(),parsedUrl.getPort(),path);
    url=parsedUrl.toExternalForm();
  }
 catch (  MalformedURLException e) {
    getTopLogger().log(TreeLogger.ERROR,"Invalid URL " + url,e);
    throw new UnableToCompleteException();
  }
  System.err.println("Using a browser with the GWT Development Plugin, please browse to");
  System.err.println("the following URL:");
  System.err.println("  " + url);
  final URL helpInfoUrl=parsedUrl;
  getTopLogger().log(TreeLogger.INFO,"Waiting for browser connection to " + url,null,new HelpInfo(){
    @Override public String getAnchorText(){
      return "Launch default browser";
    }
    @Override public String getPrefix(){
      return "";
    }
    @Override public URL getURL(){
      return helpInfoUrl;
    }
  }
);
}
