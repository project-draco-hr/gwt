{
  if (started) {
    throw new IllegalStateException("Startup code has already been run");
  }
  ui=options.getUI();
  if (ui == null) {
    if (headlessMode) {
      ui=new HeadlessUI(options);
    }
 else {
      ui=new SwingUI(options);
    }
  }
  started=true;
  if (!doStartup()) {
    return false;
  }
  if (!options.isNoServer()) {
    int resultPort=doStartUpServer();
    if (resultPort < 0) {
      return false;
    }
    options.setPort(resultPort);
    getTopLogger().log(TreeLogger.INFO,"Started web server on port " + resultPort);
  }
  return true;
}
