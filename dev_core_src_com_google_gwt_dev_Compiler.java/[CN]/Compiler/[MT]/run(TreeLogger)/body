{
  PerfLogger.start("compile");
  boolean tempWorkDir=false;
  try {
    if (options.getWorkDir() == null) {
      options.setWorkDir(Utility.makeTemporaryDirectory(null,"gwtc"));
      tempWorkDir=true;
    }
    for (    String moduleName : options.getModuleNames()) {
      ModuleDef module=ModuleDefLoader.loadFromClassPath(logger,moduleName,true);
      File compilerWorkDir=options.getCompilerWorkDir(moduleName);
      if (options.isValidateOnly()) {
        if (!Precompile.validate(logger,options,module,options.getGenDir(),compilerWorkDir)) {
          return false;
        }
      }
 else {
        long compileStart=System.currentTimeMillis();
        logger=logger.branch(TreeLogger.INFO,"Compiling module " + moduleName);
        Precompilation precompilation=Precompile.precompile(logger,options,module,options.getGenDir(),compilerWorkDir);
        if (precompilation == null) {
          return false;
        }
        Permutation[] allPerms=precompilation.getPermutations();
        File[] resultFiles=CompilePerms.makeResultFiles(compilerWorkDir,allPerms);
        CompilePerms.compile(logger,precompilation,allPerms,options.getLocalWorkers(),resultFiles);
        Link.link(logger.branch(TreeLogger.INFO,"Linking into " + options.getWarDir().getPath()),module,precompilation,resultFiles,options.getWarDir(),options.getExtraDir());
        long compileDone=System.currentTimeMillis();
        long delta=compileDone - compileStart;
        logger.log(TreeLogger.INFO,"Compilation succeeded -- " + String.format("%.3f",delta / 1000d) + "s");
      }
    }
  }
 catch (  IOException e) {
    logger.log(TreeLogger.ERROR,"Unable to create compiler work directory",e);
    return false;
  }
 finally {
    PerfLogger.end();
    if (tempWorkDir) {
      Util.recursiveDelete(options.getWorkDir(),false);
    }
  }
  return true;
}
