{
  Event typeOracleMediatorEvent=SpeedTracerLogger.start(CompilerEventType.TYPE_ORACLE_MEDIATOR);
  Event visitClassFileEvent=SpeedTracerLogger.start(CompilerEventType.TYPE_ORACLE_MEDIATOR,"phase","Visit Class Files");
  classMap=new HashMap<String,CollectClassData>();
  for (  CompilationUnit unit : units) {
    Collection<CompiledClass> compiledClasses=unit.getCompiledClasses();
    for (    CompiledClass compiledClass : compiledClasses) {
      CollectClassData cv=processClass(compiledClass);
      if (!cv.hasNoExternalName()) {
        classMap.put(compiledClass.getInternalName(),cv);
      }
    }
  }
  visitClassFileEvent.end();
  Event identityEvent=SpeedTracerLogger.start(CompilerEventType.TYPE_ORACLE_MEDIATOR,"phase","Establish Identity");
  classMapType=new HashMap<JRealClassType,CollectClassData>();
  allMethodArgs=new MethodArgNamesLookup();
  Set<JRealClassType> unresolvedTypes=new HashSet<JRealClassType>();
  for (  CompilationUnit unit : units) {
    Collection<CompiledClass> compiledClasses=unit.getCompiledClasses();
    for (    CompiledClass compiledClass : compiledClasses) {
      String internalName=compiledClass.getInternalName();
      CollectClassData cv=classMap.get(internalName);
      if (cv == null) {
        continue;
      }
      JRealClassType type=createType(compiledClass,unresolvedTypes);
      if (type != null) {
        allMethodArgs.mergeFrom(unit.getMethodArgs());
        binaryMapper.put(internalName,type);
        classMapType.put(type,cv);
      }
    }
  }
  identityEvent.end();
  Event resolveEnclosingEvent=SpeedTracerLogger.start(CompilerEventType.TYPE_ORACLE_MEDIATOR,"phase","Resolve Enclosing Classes");
  TreeLogger branch=logger.branch(TreeLogger.SPAM,"Resolving enclosing classes");
  for (Iterator<JRealClassType> it=unresolvedTypes.iterator(); it.hasNext(); ) {
    JRealClassType type=it.next();
    if (!resolveEnclosingClass(branch,type)) {
      it.remove();
    }
  }
  resolveEnclosingEvent.end();
  Event resolveUnresolvedEvent=SpeedTracerLogger.start(CompilerEventType.TYPE_ORACLE_MEDIATOR,"phase","Resolve Unresolved Types");
  for (  JRealClassType type : unresolvedTypes) {
    branch=logger.branch(TreeLogger.SPAM,"Resolving " + type.getQualifiedSourceName());
    if (!resolveClass(branch,type)) {
    }
  }
  resolveUnresolvedEvent.end();
  Event finishEvent=SpeedTracerLogger.start(CompilerEventType.TYPE_ORACLE_MEDIATOR,"phase","Finish");
  typeOracle.finish();
  finishEvent.end();
  allMethodArgs=null;
  classMap=null;
  classMapType=null;
  typeOracleMediatorEvent.end();
}
