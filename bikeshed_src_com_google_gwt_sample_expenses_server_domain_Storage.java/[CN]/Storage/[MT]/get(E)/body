{
  if (getDepth == 0) {
    freshForCurrentGet=new HashMap<Long,Entity>();
  }
  getDepth++;
  try {
    if (entity == null) {
      return null;
    }
    Entity previous=rawGet(entity.getId());
    if (null == previous) {
      throw new IllegalArgumentException(String.format("In %s, unknown id %d",entity,entity.getId()));
    }
    if (!previous.getClass().equals(entity.getClass())) {
      throw new IllegalArgumentException(String.format("Type mismatch, fetched %s for %s",entity,previous));
    }
    Entity rtn=freshForCurrentGet.get(previous.getId());
    if (rtn == null) {
      rtn=copy(previous);
      freshForCurrentGet.put(previous.getId(),rtn);
      rtn.accept(new RelationshipRefreshingVisitor(this));
    }
    return (E)rtn;
  }
  finally {
    getDepth--;
    if (getDepth == 0) {
      freshForCurrentGet=null;
    }
  }
}
