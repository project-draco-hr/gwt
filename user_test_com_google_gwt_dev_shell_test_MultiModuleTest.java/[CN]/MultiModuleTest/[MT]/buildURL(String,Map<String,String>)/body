{
  int pos=url.indexOf("?");
  if (pos >= 0) {
    url=url.substring(0,pos);
  }
  boolean firstParam=true;
  if (params.containsKey("gwt.hybrid")) {
    url+="?gwt.hybrid";
    firstParam=false;
  }
  for (  Map.Entry<String,String> entry : params.entrySet()) {
    String param=entry.getKey();
    if (param.equals("gwt.hybrid")) {
      continue;
    }
    if (firstParam) {
      url+="?";
      firstParam=false;
    }
 else {
      url+="&";
    }
    url+=param;
    String value=entry.getValue();
    if (value != null) {
      url+="=" + value;
    }
  }
  return url;
}
