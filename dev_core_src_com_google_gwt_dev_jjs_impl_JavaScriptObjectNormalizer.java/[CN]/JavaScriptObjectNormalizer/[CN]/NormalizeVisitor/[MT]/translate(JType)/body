{
  if (!(type instanceof JReferenceType)) {
    return type;
  }
  JReferenceType refType=(JReferenceType)type;
  boolean canBeNull=refType.canBeNull();
  refType=refType.getUnderlyingType();
  if (program.isJavaScriptObject(refType)) {
    refType=program.getJavaScriptObject();
  }
 else   if (program.typeOracle.getSingleJsoImpl(refType) != null && !program.typeOracle.isDualJsoInterface(refType)) {
    refType=program.getJavaScriptObject();
  }
 else   if (refType instanceof JArrayType) {
    JArrayType arrayType=(JArrayType)refType;
    JType leafType=arrayType.getLeafType();
    JType replacement=translate(leafType);
    if (leafType != replacement) {
      refType=program.getTypeArray(replacement,arrayType.getDims());
    }
  }
  return canBeNull ? refType : refType.getNonNull();
}
