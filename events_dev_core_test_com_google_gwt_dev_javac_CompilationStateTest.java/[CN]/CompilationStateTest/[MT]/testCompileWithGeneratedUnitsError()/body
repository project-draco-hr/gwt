{
  validateUncompiled();
  state.compile(createTreeLogger());
  assertUnitsChecked(state.getCompilationUnits());
  addGeneratedUnit(JavaSourceCodeBase.BAR);
  state.compile(createTreeLogger());
  CompilationUnit badUnit=state.getCompilationUnitMap().get(JavaSourceCodeBase.BAR.getTypeName());
  assertSame(State.ERROR,badUnit.getState());
  Set<CompilationUnit> goodUnits=new HashSet<CompilationUnit>(state.getCompilationUnits());
  goodUnits.remove(badUnit);
  assertUnitsChecked(goodUnits);
}
