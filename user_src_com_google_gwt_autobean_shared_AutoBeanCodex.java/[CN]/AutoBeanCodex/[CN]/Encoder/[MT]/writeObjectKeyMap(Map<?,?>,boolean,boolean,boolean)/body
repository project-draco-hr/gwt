{
  StringBuilder keys=new StringBuilder();
  StringBuilder values=new StringBuilder();
  for (  Map.Entry<?,?> entry : map.entrySet()) {
    if (isEncodedKey) {
      keys.append(",").append(((Splittable)entry.getKey()).getPayload());
    }
 else {
      encodeToStringBuilder(keys.append(","),entry.getKey());
    }
    if (isEncodedValue) {
      values.append(",").append(((Splittable)entry.getValue()).getPayload());
    }
 else     if (isValueValue) {
      values.append(",").append(encodeValue(entry.getValue()).getPayload());
    }
 else {
      encodeToStringBuilder(values.append(","),entry.getValue());
    }
  }
  keys.setCharAt(0,'[');
  keys.append("]");
  values.setCharAt(0,'[');
  values.append("]");
  sb.append("[").append(keys.toString()).append(",").append(values.toString()).append("]");
}
