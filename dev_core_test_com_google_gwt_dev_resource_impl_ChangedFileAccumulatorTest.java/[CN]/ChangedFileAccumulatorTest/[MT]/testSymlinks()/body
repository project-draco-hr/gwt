{
  File scratchDirectory=Files.createTempDir();
  File newFile=createFileIn("New.java",scratchDirectory);
  File rootDirectory=Files.createTempDir();
  File subDirectory=Files.createTempDir();
  ChangedFileAccumulator changedFileAccumulator=new ChangedFileAccumulator(rootDirectory.toPath());
  assertTrue(changedFileAccumulator.getAndClearChangedFiles().isEmpty());
  java.nio.file.Files.createSymbolicLink(new File(rootDirectory,"sublink").toPath(),subDirectory.toPath()).toFile();
  java.nio.file.Files.createSymbolicLink(new File(subDirectory,"New.java").toPath(),newFile.toPath()).toFile();
  waitForFileEvents();
  List<File> modifiedFiles=changedFileAccumulator.getAndClearChangedFiles();
  assertEquals(3,modifiedFiles.size());
  assertTrue(modifiedFiles.get(0).getPath().endsWith("New.java"));
  assertTrue(modifiedFiles.get(1).getPath().endsWith("sublink"));
  assertEquals(modifiedFiles.get(2).getPath(),subDirectory.getPath());
  changedFileAccumulator.shutdown();
}
