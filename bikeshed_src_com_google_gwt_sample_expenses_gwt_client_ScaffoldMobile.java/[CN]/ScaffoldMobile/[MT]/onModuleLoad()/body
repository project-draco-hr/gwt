{
  ScaffoldFactory factory=GWT.create(ScaffoldFactory.class);
  final EventBus eventBus=factory.getEventBus();
  final ExpensesRequestFactory requestFactory=factory.getRequestFactory();
  final PlaceController placeController=factory.getPlaceController();
  final ScaffoldMobileShell shell=factory.getMobileShell();
  eventBus.addHandler(RequestEvent.TYPE,new AuthenticationFailureHandler());
  final LoginWidget login=shell.getLoginWidget();
  Receiver<UserInformationRecord> receiver=new Receiver<UserInformationRecord>(){
    public void onSuccess(    UserInformationRecord userInformationRecord,    Set<SyncResult> syncResults){
      login.setUserInformation(userInformationRecord);
    }
  }
;
  requestFactory.userInformationRequest().getCurrentUserInformation(Location.getHref()).fire(receiver);
  HasConstrainedValue<ProxyListPlace> placePickerView=shell.getPlacesBox();
  placePickerView.setAcceptableValues(getTopPlaces());
  factory.getListPlacePicker().register(eventBus,placePickerView);
  final ActivityMapper mapper=new ScaffoldMobileActivities(new ExpensesMasterActivities(requestFactory,placeController),new ExpensesDetailsActivities(requestFactory,placeController));
  final ActivityManager activityManager=new ActivityManager(mapper,eventBus);
  activityManager.setDisplay(new Activity.Display(){
    public void showActivityWidget(    IsWidget widget){
      shell.getBody().setWidget(widget == null ? null : widget.asWidget());
    }
  }
);
  Element loading=Document.get().getElementById("loading");
  loading.getParentElement().removeChild(loading);
  PlaceHistoryHandler placeHistoryHandler=factory.getPlaceHistoryHandler();
  placeHistoryHandler.register(placeController,eventBus,getTopPlaces().iterator().next());
  placeHistoryHandler.handleCurrentHistory();
  RootLayoutPanel.get().add(shell);
}
