{
  do {
    getStreamToOtherSide().flush();
    MessageType messageType=Message.readMessageType(getStreamFromOtherSide());
switch (messageType) {
case FREE_VALUE:
      final FreeMessage freeMsg=FreeMessage.receive(this);
    handler.freeValue(this,freeMsg.getIds());
  break;
case INVOKE:
final InvokeOnServerMessage imsg=InvokeOnServerMessage.receive(this);
ReturnMessage.send(this,handler.invoke(this,imsg.getThis(),imsg.getMethodDispatchId(),imsg.getArgs()));
break;
case INVOKE_SPECIAL:
handleInvokeSpecial(handler);
break;
case QUIT:
return;
default :
throw new BrowserChannelException("Invalid message type " + messageType);
}
}
 while (true);
}
