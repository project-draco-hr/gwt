{
  URL[] resources=ResourceGeneratorUtil.findResources(logger,context,method);
  if (resources.length != 1) {
    logger.log(TreeLogger.ERROR,"Exactly one resource must be specified",null);
    throw new UnableToCompleteException();
  }
  MimeType mimeTypeAnnotation=method.getAnnotation(MimeType.class);
  String mimeType=mimeTypeAnnotation != null ? mimeTypeAnnotation.value() : null;
  DoNotEmbed doNotEmbed=method.getAnnotation(DoNotEmbed.class);
  boolean forceExternal=(doNotEmbed != null);
  URL resource=resources[0];
  String outputUrlExpression=context.deploy(resource,mimeType,forceExternal);
  SourceWriter sw=new StringSourceWriter();
  sw.println("new " + DataResource.class.getName() + "() {");
  sw.indent();
  sw.println("// " + resource.toExternalForm());
  sw.println("public String getUrl() {");
  sw.indent();
  sw.println("return " + outputUrlExpression + ";");
  sw.outdent();
  sw.println("}");
  sw.println("public String getName() {");
  sw.indent();
  sw.println("return \"" + method.getName() + "\";");
  sw.outdent();
  sw.println("}");
  sw.outdent();
  sw.println("}");
  return sw.toString();
}
