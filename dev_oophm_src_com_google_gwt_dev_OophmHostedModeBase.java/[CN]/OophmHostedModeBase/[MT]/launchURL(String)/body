{
  try {
    URL parsedUrl=new URL(url);
    String path=parsedUrl.getPath();
    String query=parsedUrl.getQuery();
    String hash=parsedUrl.getRef();
    String hostedParam="gwt.hosted=" + listener.getEndpointIdentifier();
    if (query == null) {
      query=hostedParam;
    }
 else {
      query+='&' + hostedParam;
    }
    path+='?' + query;
    if (hash != null) {
      path+='#' + hash;
    }
    url=new URL(parsedUrl.getProtocol(),parsedUrl.getHost(),parsedUrl.getPort(),path).toExternalForm();
  }
 catch (  MalformedURLException e) {
    getTopLogger().log(TreeLogger.ERROR,"Invalid URL " + url,e);
    throw new UnableToCompleteException();
  }
  TreeLogger branch=getTopLogger().branch(TreeLogger.INFO,"Launching firefox with " + url,null);
  try {
    Process browser=Runtime.getRuntime().exec("firefox " + url + "&");
    int exitCode=browser.waitFor();
    if (exitCode != 0) {
      branch.log(TreeLogger.ERROR,"Exit code " + exitCode,null);
    }
  }
 catch (  IOException e) {
    branch.log(TreeLogger.ERROR,"Error starting browser",e);
  }
catch (  InterruptedException e) {
    branch.log(TreeLogger.ERROR,"Error starting browser",e);
  }
}
