{
  Activity nextActivity=getNextActivity(event);
  Throwable caughtOnStop=null;
  Throwable caughtOnCancel=null;
  Throwable caughtOnStart=null;
  if (nextActivity == null) {
    nextActivity=NULL_ACTIVITY;
  }
  if (currentActivity.equals(nextActivity)) {
    return;
  }
  if (startingNext) {
    caughtOnCancel=tryStopOrCancel(false);
    currentActivity=NULL_ACTIVITY;
    startingNext=false;
  }
 else   if (!currentActivity.equals(NULL_ACTIVITY)) {
    showWidget(null);
    stopperedEventBus.removeHandlers();
    caughtOnStop=tryStopOrCancel(true);
  }
  currentActivity=nextActivity;
  if (currentActivity.equals(NULL_ACTIVITY)) {
    showWidget(null);
  }
 else {
    startingNext=true;
    caughtOnStart=tryStart();
  }
  if (caughtOnStart != null || caughtOnCancel != null || caughtOnStop != null) {
    Set<Throwable> causes=new LinkedHashSet<Throwable>();
    if (caughtOnStop != null) {
      causes.add(caughtOnStop);
    }
    if (caughtOnCancel != null) {
      causes.add(caughtOnCancel);
    }
    if (caughtOnStart != null) {
      causes.add(caughtOnStart);
    }
    throw new UmbrellaException(causes);
  }
}
