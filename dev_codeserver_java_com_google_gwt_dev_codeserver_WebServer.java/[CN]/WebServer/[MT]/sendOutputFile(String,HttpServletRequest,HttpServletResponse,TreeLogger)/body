{
  int secondSlash=target.indexOf('/',1);
  String moduleName=target.substring(1,secondSlash);
  ModuleState moduleState=modules.get(moduleName);
  File file=moduleState.getOutputFile(target);
  if (!file.isFile()) {
    file=moduleState.getOutputFile(target + ".gz");
    if (!file.isFile()) {
      response.sendError(HttpServletResponse.SC_NOT_FOUND);
      logger.log(TreeLogger.WARN,"not found: " + file.toString());
      return;
    }
    if (!request.getHeader("Accept-Encoding").contains("gzip")) {
      response.sendError(HttpServletResponse.SC_NOT_IMPLEMENTED);
      logger.log(TreeLogger.WARN,"client doesn't accept gzip; bailing");
      return;
    }
    response.setHeader("Content-Encoding","gzip");
  }
  Matcher match=CACHE_JS_FILE.matcher(target);
  if (match.matches()) {
    String strongName=match.group(1);
    String template=SourceHandler.sourceMapLocationTemplate(moduleName);
    String sourceMapUrl=template.replace("__HASH__",strongName);
    response.setHeader("X-SourceMap",sourceMapUrl);
  }
  response.setHeader("Access-Control-Allow-Origin","*");
  String mimeType=guessMimeType(target);
  PageUtil.sendFile(mimeType,file,response);
}
