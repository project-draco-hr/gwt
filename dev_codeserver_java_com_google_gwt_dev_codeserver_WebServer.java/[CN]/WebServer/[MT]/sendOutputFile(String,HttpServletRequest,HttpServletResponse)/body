{
  int secondSlash=target.indexOf('/',1);
  String moduleName=target.substring(1,secondSlash);
  ModuleState moduleState=modules.get(moduleName);
  File file=moduleState.getOutputFile(target);
  if (!file.isFile()) {
    file=moduleState.getOutputFile(target + ".gz");
    if (!file.isFile()) {
      response.sendError(HttpServletResponse.SC_NOT_FOUND);
      logger.log(TreeLogger.WARN,"not found: " + file.toString());
      return;
    }
    if (!request.getHeader("Accept-Encoding").contains("gzip")) {
      response.sendError(HttpServletResponse.SC_NOT_IMPLEMENTED);
      logger.log(TreeLogger.WARN,"client doesn't accept gzip; bailing");
      return;
    }
    response.setHeader("Content-Encoding","gzip");
  }
  if (target.endsWith(".cache.js")) {
    response.setHeader("X-SourceMap",sourceMapLocationForModule(moduleName));
  }
 else   if (target.endsWith(".nocache.js")) {
    response.setHeader("Cache-Control","no-cache, no-store, max-age=0, must-revalidate");
    response.setHeader("Pragma","no-cache");
    response.setHeader("Expires",TIME_IN_THE_PAST);
    response.setDateHeader("Date",new Date().getTime());
  }
  response.setHeader("Access-Control-Allow-Origin","*");
  String mimeType=guessMimeType(target);
  PageUtil.sendFile(mimeType,file,response);
}
