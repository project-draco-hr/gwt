{
  if (config == null) {
synchronized (this) {
      if (config != null) {
        return;
      }
      try {
        final String serverOperation=getServletContext().getInitParameter(SERVER_OPERATION_CONTEXT_PARAM);
        if (null == serverOperation) {
          failConfig();
        }
        Class<?> clazz=Class.forName(serverOperation);
        if (Config.class.isAssignableFrom(clazz)) {
          config=((Class<? extends Config>)clazz).newInstance();
          tokenToEntityRecord=new HashMap<String,EntityRecordPair>();
          for (          Class<? extends Record> recordClass : config.recordTypes()) {
            ServerType serverType=recordClass.getAnnotation(ServerType.class);
            String token=serverType.token();
            if ("[UNASSIGNED]".equals(token)) {
              token=recordClass.getSimpleName();
            }
            tokenToEntityRecord.put(token,new EntityRecordPair(serverType.type(),recordClass));
          }
        }
      }
 catch (      ClassNotFoundException e) {
        failConfig(e);
      }
catch (      InstantiationException e) {
        failConfig(e);
      }
catch (      IllegalAccessException e) {
        failConfig(e);
      }
catch (      SecurityException e) {
        failConfig(e);
      }
catch (      ClassCastException e) {
        failConfig(e);
      }
    }
  }
}
