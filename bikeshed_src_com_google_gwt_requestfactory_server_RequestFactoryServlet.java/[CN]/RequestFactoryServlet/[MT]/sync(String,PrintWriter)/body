{
  try {
    JSONObject jsonObject=new JSONObject(content);
    JSONObject returnJsonObject=new JSONObject();
    for (    WriteOperation writeOperation : WriteOperation.values()) {
      if (!jsonObject.has(writeOperation.name())) {
        continue;
      }
      JSONArray reportArray=new JSONArray(jsonObject.getString(writeOperation.name()));
      JSONArray returnArray=new JSONArray();
      int length=reportArray.length();
      if (length == 0) {
        throw new IllegalArgumentException("No json array for " + writeOperation.name() + " should have been sent");
      }
      for (int i=0; i < length; i++) {
        JSONObject recordWithSchema=reportArray.getJSONObject(i);
        Iterator<?> iterator=recordWithSchema.keys();
        String recordToken=(String)iterator.next();
        if (iterator.hasNext()) {
          throw new IllegalArgumentException("There cannot be more than one record token");
        }
        JSONObject recordObject=recordWithSchema.getJSONObject(recordToken);
        JSONObject returnObject=updateRecordInDataStore(recordToken,recordObject,writeOperation);
        returnArray.put(returnObject);
      }
      returnJsonObject.put(writeOperation.name(),returnArray);
    }
    writer.print(returnJsonObject.toString());
  }
 catch (  JSONException e) {
    throw new IllegalArgumentException("sync failed: ",e);
  }
}
