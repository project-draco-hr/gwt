{
  CompilerOptions compilerOptions=new CompilerOptionsImpl();
  compilerOptions.setModuleNames(Lists.newArrayList(canonicalModuleName));
  compilerOptions.setLink(link);
  compilerOptions.setLogLevel(TreeLogger.ERROR);
  compilerOptions.setGenDir(new File(buildTargetOptions.getGenDir()));
  compilerOptions.setWorkDir(new File(buildTargetOptions.getOutputDir()));
  compilerOptions.setLibraryPaths(Lists.newArrayList(Iterables.transform(getTransitiveDependencyBuildTargets(),LIBRARY_PATH_FUNCTION)));
  compilerOptions.setFinalProperties(buildTargetOptions.getFinalProperties());
  if (!link) {
    compilerOptions.setOutputLibraryPath(computeLibraryPath());
  }
 else {
    compilerOptions.setWarDir(new File(buildTargetOptions.getWarDir()));
  }
  return compilerOptions;
}
