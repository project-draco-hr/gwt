{
  final Set<JsName> referenced=new HashSet<JsName>();
  new JsVisitor(){
    public void endVisit(    JsForIn x,    JsContext ctx){
      reference(x.getIterVarName());
    }
    public void endVisit(    JsFunction x,    JsContext ctx){
      reference(x.getName());
    }
    public void endVisit(    JsLabel x,    JsContext ctx){
      reference(x.getName());
    }
    public void endVisit(    JsNameOf x,    JsContext ctx){
      reference(x.getName());
    }
    public void endVisit(    JsNameRef x,    JsContext ctx){
      reference(x.getName());
    }
    public void endVisit(    JsParameter x,    JsContext ctx){
      reference(x.getName());
    }
    public void endVisit(    JsVars.JsVar x,    JsContext ctx){
      reference(x.getName());
    }
    private void reference(    JsName name){
      if (name != null) {
        referenced.add(name);
      }
    }
  }
.accept(program);
  return referenced;
}
