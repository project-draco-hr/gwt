{
  addMockIntrinsic();
  sourceOracle.addOrReplace(new MockJavaResource("test.EntryPoint"){
    @Override public CharSequence getContent(){
      return code;
    }
  }
);
  addBuiltinClasses(sourceOracle);
  CompilerContext compilerContext=new CompilerContext();
  CompilationState state=CompilationStateBuilder.buildFrom(logger,compilerContext,sourceOracle.getResources(),getAdditionalTypeProviderDelegate());
  Properties properties=createPropertiesObject(configProps);
  jProgram=JavaAstConstructor.construct(logger,state,properties,"test.EntryPoint","com.google.gwt.lang.Exceptions");
  jProgram.addEntryMethod(findMethod(jProgram,"onModuleLoad"));
  ComputeCastabilityInformation.exec(jProgram,false);
  ImplementCastsAndTypeChecks.exec(jProgram,false);
  ArrayNormalizer.exec(jProgram,false);
  TypeTightener.exec(jProgram);
  MethodCallTightener.exec(jProgram);
  Map<JType,JLiteral> typeIdsByType=ResolveRuntimeTypeReferencesIntoIntLiterals.exec(jProgram);
  Map<StandardSymbolData,JsName> symbolTable=new TreeMap<StandardSymbolData,JsName>(new SymbolData.ClassIdentComparator());
  JavaToJavaScriptMap map=GenerateJavaScriptAST.exec(jProgram,jsProgram,JsOutputOption.PRETTY,typeIdsByType,symbolTable,new PropertyOracle[]{new StaticPropertyOracle(orderedProps,orderedPropValues,configProps)}).getLeft();
  CodeSplitter.exec(logger,jProgram,jsProgram,map,expectedFragmentCount,leftOverMergeSize,NULL_RECORDER);
}
