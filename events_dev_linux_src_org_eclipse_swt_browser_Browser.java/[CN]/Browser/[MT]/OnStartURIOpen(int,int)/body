{
  nsIURI location=new nsIURI(aURI);
  int aSpec=XPCOM.nsEmbedCString_new();
  location.GetSpec(aSpec);
  int length=XPCOM.nsEmbedCString_Length(aSpec);
  int buffer=XPCOM.nsEmbedCString_get(aSpec);
  buffer=XPCOM.nsEmbedCString_get(aSpec);
  byte[] dest=new byte[length];
  XPCOM.memmove(dest,buffer,length);
  XPCOM.nsEmbedCString_delete(aSpec);
  String value=new String(dest);
  boolean isHttps=value.startsWith(XPCOM.HTTPS_PROTOCOL);
  if (locationListeners.length == 0) {
    XPCOM.memmove(retval,new int[]{isHttps && !usingProfile ? 1 : 0},4);
    return XPCOM.NS_OK;
  }
  boolean doit=!isHttps || usingProfile;
  if (request == 0) {
    LocationEvent event=new LocationEvent(this);
    event.display=getDisplay();
    event.widget=this;
    event.location=value;
    if (event.location.equals(URI_FROMMEMORY)) {
      event.location=ABOUT_BLANK;
    }
    event.doit=doit;
    for (int i=0; i < locationListeners.length; i++)     locationListeners[i].changing(event);
    if (!isHttps || usingProfile)     doit=event.doit;
  }
  XPCOM.memmove(retval,new int[]{doit ? 0 : 1},4);
  return XPCOM.NS_OK;
}
