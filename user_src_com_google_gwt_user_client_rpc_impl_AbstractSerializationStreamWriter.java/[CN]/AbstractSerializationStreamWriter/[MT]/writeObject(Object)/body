{
  if (instance == null) {
    writeString(null);
    return;
  }
  int objIndex=getIndexForObject(instance);
  if (objIndex >= 0) {
    writeInt(-(objIndex + 1));
    return;
  }
  saveIndexForObject(instance);
  String typeSignature=getObjectTypeSignature(instance);
  if (typeSignature == null) {
    throw new SerializationException("could not get type signature for " + instance.getClass());
  }
  writeString(typeSignature);
  serialize(instance,typeSignature);
}
