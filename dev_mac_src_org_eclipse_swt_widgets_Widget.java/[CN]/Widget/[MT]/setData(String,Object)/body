{
  checkWidget();
  if (key == null)   error(SWT.ERROR_NULL_ARGUMENT);
  if (key.equals(CLEAR_GRAB_BIT)) {
    state&=~GRAB;
    return;
  }
  int index=1;
  Object[] table=null;
  if ((state & KEYED_DATA) != 0) {
    table=(Object[])data;
    while (index < table.length) {
      if (key.equals(table[index]))       break;
      index+=2;
    }
  }
  if (value != null) {
    if ((state & KEYED_DATA) != 0) {
      if (index == table.length) {
        Object[] newTable=new Object[table.length + 2];
        System.arraycopy(table,0,newTable,0,table.length);
        data=table=newTable;
      }
    }
 else {
      table=new Object[3];
      table[0]=data;
      data=table;
      state|=KEYED_DATA;
    }
    table[index]=key;
    table[index + 1]=value;
  }
 else {
    if ((state & KEYED_DATA) != 0) {
      if (index != table.length) {
        int length=table.length - 2;
        if (length == 1) {
          data=table[0];
          state&=~KEYED_DATA;
        }
 else {
          Object[] newTable=new Object[length];
          System.arraycopy(table,0,newTable,0,index);
          System.arraycopy(table,index + 2,newTable,index,length - index);
          data=newTable;
        }
      }
    }
  }
}
