{
  if (user == null && password != null) {
    throw new IllegalStateException("A password is set, but no user is set");
  }
  JavaScriptObject xmlHttpRequest=httpRequest.createXmlHTTPRequest();
  String openError;
  if (password != null) {
    openError=XMLHTTPRequest.open(xmlHttpRequest,httpMethod,url,true,user,password);
  }
 else   if (user != null) {
    openError=XMLHTTPRequest.open(xmlHttpRequest,httpMethod,url,true,user);
  }
 else {
    openError=XMLHTTPRequest.open(xmlHttpRequest,httpMethod,url,true);
  }
  if (openError != null) {
    RequestPermissionException requestPermissionException=new RequestPermissionException(url);
    requestPermissionException.initCause(new RequestException(openError));
    throw requestPermissionException;
  }
  setHeaders(xmlHttpRequest);
  Request request=new Request(xmlHttpRequest,timeoutMillis,callback);
  String sendError=XMLHTTPRequest.send(xmlHttpRequest,request,requestData,callback);
  if (sendError != null) {
    throw new RequestException(sendError);
  }
  return request;
}
