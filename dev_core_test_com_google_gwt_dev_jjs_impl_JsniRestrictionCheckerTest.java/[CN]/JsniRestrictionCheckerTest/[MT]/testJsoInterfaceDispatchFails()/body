{
  addSnippetImport("com.google.gwt.core.client.JavaScriptObject");
  addSnippetClassDecl("static class Buggy {","  interface IFoo {","    void foo();","  }","  static final class Foo extends JavaScriptObject implements IFoo {","    protected Foo() { };","    public void foo() { };","  }","  native void jsniMeth(Object o) /*-{","    new Object().@Buggy.IFoo::foo()();","  }-*/;","}");
  try {
    optimize("void","new Buggy().jsniMeth(null);");
    fail("JsniRestrictionChecker should have prevented JSO interface dispatch in a JSNI method.");
  }
 catch (  Exception e) {
    assertTrue(e.getCause() instanceof UnableToCompleteException);
  }
}
