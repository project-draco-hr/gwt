{
  if (firingDepth > 0) {
    enqueueAdd(type,source,handler);
  }
 else {
    doAddNow(type,source,handler);
  }
  return new HandlerRegistration(){
    public void removeHandler(){
      doRemove(type,source,handler);
    }
  }
;
}
