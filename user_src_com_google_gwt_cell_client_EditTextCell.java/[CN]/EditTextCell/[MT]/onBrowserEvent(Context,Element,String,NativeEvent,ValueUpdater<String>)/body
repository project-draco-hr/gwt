{
  Object key=context.getKey();
  ViewData viewData=getViewData(key);
  if (viewData != null && viewData.isEditing()) {
    editEvent(context,parent,value,viewData,event,valueUpdater);
  }
 else {
    String type=event.getType();
    int keyCode=event.getKeyCode();
    boolean enterPressed="keyup".equals(type) && keyCode == KeyCodes.KEY_ENTER;
    if ("click".equals(type) || enterPressed) {
      if (viewData == null) {
        viewData=new ViewData(value);
        setViewData(key,viewData);
      }
 else {
        viewData.setEditing(true);
      }
      edit(context,parent,value);
    }
  }
}
