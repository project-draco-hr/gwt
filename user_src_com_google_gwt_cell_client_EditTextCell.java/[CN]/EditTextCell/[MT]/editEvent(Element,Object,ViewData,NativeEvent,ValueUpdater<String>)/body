{
  String type=event.getType();
  boolean keyUp="keyup".equals(type);
  boolean keyDown="keydown".equals(type);
  if (keyUp || keyDown) {
    int keyCode=event.getKeyCode();
    if (keyUp && keyCode == KeyCodes.KEY_ENTER) {
      commit(parent,viewData,valueUpdater);
    }
 else     if (keyUp && keyCode == KeyCodes.KEY_ESCAPE) {
      String originalText=viewData.getOriginal();
      if (viewData.isEditingAgain()) {
        viewData.setText(originalText);
        viewData.setEditing(false);
      }
 else {
        setViewData(key,null);
      }
      cancel(parent,originalText);
    }
 else {
      updateViewData(parent,viewData,true);
    }
  }
 else   if ("blur".equals(type)) {
    EventTarget eventTarget=event.getEventTarget();
    if (Element.is(eventTarget)) {
      Element target=Element.as(eventTarget);
      if ("input".equals(target.getTagName().toLowerCase())) {
        commit(parent,viewData,valueUpdater);
      }
    }
  }
}
