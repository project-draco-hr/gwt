{
  Settings settings=new Settings();
  List<String> remainingArguments=new LinkedList<String>(Arrays.asList(allArguments));
  next_argument:   while (!remainingArguments.isEmpty()) {
    for (    Setting<?> setting : settings.allSettings) {
      if (setting.consumeArguments(remainingArguments)) {
        continue next_argument;
      }
    }
    break;
  }
  if (settings.resources.get() == null) {
    throw new ArgumentListException("The -resources option is required");
  }
  if ((settings.soycDir.get() == null) && (settings.symbolMapsDir.get() == null)) {
    if (remainingArguments.isEmpty()) {
      throw new ArgumentListException("Must specify the soyc directory");
    }
    if (remainingArguments.get(0).startsWith("-")) {
      throw new ArgumentListException("Unrecognized argument: " + remainingArguments.get(0));
    }
    settings.storiesFileName=remainingArguments.remove(0);
    if (!remainingArguments.isEmpty()) {
      settings.depFileName=remainingArguments.remove(0);
    }
    if (!remainingArguments.isEmpty()) {
      settings.splitPointsFileName=remainingArguments.remove(0);
    }
    if (!remainingArguments.isEmpty()) {
      throw new ArgumentListException("Too many arguments");
    }
  }
 else   if (settings.soycDir.get() != null) {
    if (settings.symbolMapsDir.get() == null) {
      throw new ArgumentListException("Must specify symbol maps directory when specifying Soyc directory.");
    }
  }
 else {
    if (settings.soycDir.get() == null) {
      throw new ArgumentListException("Must specify Soyc directory when specifying symbol maps directory .");
    }
  }
  if (settings.out.get() != null) {
    File dir=new File(settings.out.get());
    if (!dir.exists()) {
      dir.mkdir();
    }
  }
  return settings;
}
