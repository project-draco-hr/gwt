{
  Set<CompilationUnit> usefulGeneratedCups=new HashSet<CompilationUnit>();
  for (  CompilationUnit newGeneratedUnit : newGeneratedCups) {
    String typeName=newGeneratedUnit.getTypeName();
    CompilationUnit oldGeneratedUnit=usefulGraveyardUnitsMap.get(typeName);
    if (oldGeneratedUnit != null) {
      usefulGeneratedCups.add(oldGeneratedUnit);
      unitMap.put(typeName,oldGeneratedUnit);
    }
 else {
      usefulGeneratedCups.add(newGeneratedUnit);
      unitMap.put(typeName,newGeneratedUnit);
    }
  }
  assert(newGeneratedCups.size() == usefulGeneratedCups.size());
  for (  CompilationUnit generatedUnit : usefulGeneratedCups) {
    unitMap.put(generatedUnit.getTypeName(),generatedUnit);
  }
  updateExposedUnits();
  compile(logger,usefulGeneratedCups,getCompilationUnits());
  mediator.addNewUnits(logger,usefulGeneratedCups);
  markSurvivorsChecked(usefulGeneratedCups);
}
