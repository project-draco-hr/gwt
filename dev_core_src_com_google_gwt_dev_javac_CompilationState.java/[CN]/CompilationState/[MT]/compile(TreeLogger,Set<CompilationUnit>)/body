{
  PerfLogger.start("CompilationState.compile");
  if (jdtCompiler.doCompile(newUnits)) {
    boolean anyErrors=CompilationUnitInvalidator.invalidateUnitsWithErrors(logger,newUnits);
    CompilationUnitInvalidator.validateCompilationUnits(newUnits,validBinaryTypeNames);
    anyErrors|=CompilationUnitInvalidator.invalidateUnitsWithErrors(logger,newUnits);
    if (anyErrors) {
      CompilationUnitInvalidator.invalidateUnitsWithInvalidRefs(logger,newUnits);
    }
    recordValidBinaryTypeNames(newUnits);
    JsniCollector.collectJsniMethods(logger,newUnits,new JsProgram());
  }
  PerfLogger.end();
}
