{
  for (Iterator<CompilationUnit> it=unitMap.values().iterator(); it.hasNext(); ) {
    CompilationUnit unit=it.next();
    if (unit.isGenerated()) {
      unit.setState(State.FRESH);
      it.remove();
    }
  }
  refreshFromSourceOracle();
  updateExposedUnits();
  CompilationUnitInvalidator.invalidateUnitsWithInvalidRefs(TreeLogger.NULL,getCompilationUnits());
  jdtCompiler=new JdtCompiler();
  validBinaryTypeNames.clear();
  compile(logger,getCompilationUnits());
  mediator.refresh(logger,getCompilationUnits());
  markSurvivorsChecked(getCompilationUnits());
}
