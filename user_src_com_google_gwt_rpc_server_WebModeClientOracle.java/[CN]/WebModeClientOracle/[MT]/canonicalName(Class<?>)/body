{
  if (clazz.isArray()) {
    Class<?> leafType=clazz;
    do {
      leafType=leafType.getComponentType();
    }
 while (leafType.isArray());
    Class<?> enclosing=leafType.getEnclosingClass();
    if (enclosing != null) {
      return canonicalName(enclosing) + "$" + clazz.getSimpleName();
    }
 else     if (leafType.getPackage() == null) {
      return clazz.getSimpleName();
    }
 else {
      return leafType.getPackage().getName() + "." + clazz.getSimpleName();
    }
  }
 else {
    return clazz.getName();
  }
}
