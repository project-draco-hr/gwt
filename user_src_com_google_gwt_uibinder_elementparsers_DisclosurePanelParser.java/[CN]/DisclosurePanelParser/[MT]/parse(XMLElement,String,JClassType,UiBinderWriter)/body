{
  Children children=findChildren(panelElem,writer);
  if (null != children.body) {
    if (!writer.isWidgetElement(children.body)) {
      writer.die("In %s, %s must be a widget",panelElem,children.body);
    }
    String bodyField=writer.parseElementToField(children.body);
    writer.addInitStatement("%s.add(%s);",panelField,bodyField);
  }
  if (null != children.customHeader) {
    XMLElement headerElement=children.customHeader.consumeSingleChildElement();
    if (!writer.isWidgetElement(headerElement)) {
      writer.die("In %s of %s, %s is not a widget",children.customHeader,panelElem,headerElement);
    }
    String headerField=writer.parseElementToField(headerElement);
    writer.addInitStatement("%s.setHeader(%s);",panelField,headerField);
  }
  if (null != children.header) {
    String openImage=children.header.consumeImageResourceAttribute(OPEN_IMAGE);
    String closedImage=children.header.consumeImageResourceAttribute(CLOSED_IMAGE);
    String headerText=children.header.consumeInnerTextEscapedAsHtmlStringLiteral(new TextInterpreter(writer));
    if ((openImage == null) ^ (closedImage == null)) {
      writer.die("In %s of %s, both %s and %s must be specified, or neither",children.header,panelElem,OPEN_IMAGE,CLOSED_IMAGE);
    }
    String panelTypeName=type.getQualifiedSourceName();
    if (openImage != null) {
      writer.setFieldInitializer(panelField,String.format("new %s(%s, %s, \"%s\")",panelTypeName,openImage,closedImage,headerText));
    }
 else {
      writer.setFieldInitializer(panelField,String.format("new %s(\"%s\")",panelTypeName,headerText));
    }
  }
}
