{
  String newTestCaseClassName=testCase.getClass().getName();
  boolean sameTest=newTestCaseClassName.equals(testCaseClassName);
  if (sameTest && lastLaunchFailed) {
    throw new UnableToCompleteException();
  }
  messageQueue.setNextTestName(newTestCaseClassName,testCase.getName());
  try {
    lastLaunchFailed=false;
    testCaseClassName=newTestCaseClassName;
    runStyle.maybeLaunchModule(moduleName,!sameTest);
  }
 catch (  UnableToCompleteException e) {
    lastLaunchFailed=true;
    throw e;
  }
  try {
    testBeginTimout=System.currentTimeMillis() + TEST_BEGIN_TIMEOUT_MILLIS;
    pumpEventLoop();
  }
 catch (  TimeoutException e) {
    testResult.addError(testCase,e);
    return;
  }
  Throwable result=messageQueue.getResult(testCaseClassName);
  if (result instanceof AssertionFailedError) {
    testResult.addFailure(testCase,(AssertionFailedError)result);
  }
 else   if (result != null) {
    testResult.addError(testCase,result);
  }
}
