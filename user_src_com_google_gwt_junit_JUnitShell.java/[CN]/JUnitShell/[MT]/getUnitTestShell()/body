{
  if (unitTestShell == null) {
    try {
      BootStrapPlatform.init();
      BootStrapPlatform.applyPlatformHacks();
      unitTestShell=new JUnitShell();
      String[] args=unitTestShell.synthesizeArgs();
      if (!unitTestShell.processArgs(args)) {
        throw new JUnitFatalLaunchException("Error processing shell arguments");
      }
      unitTestShell.messageQueue=new JUnitMessageQueue(unitTestShell.numClients);
      if (!unitTestShell.startUp()) {
        throw new JUnitFatalLaunchException("Shell failed to start");
      }
    }
  finally {
      if (unitTestShell != null) {
        unitTestShell.lastLaunchFailed=true;
      }
    }
  }
  return unitTestShell;
}
