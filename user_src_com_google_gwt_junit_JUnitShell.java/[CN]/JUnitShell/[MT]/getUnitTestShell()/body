{
  if (unitTestShell == null) {
    unitTestShell=new JUnitShell();
    unitTestShell.lastLaunchFailed=true;
    String[] args=unitTestShell.synthesizeArgs();
    ArgProcessor argProcessor=unitTestShell.new ArgProcessor();
    if (!argProcessor.processArgs(args)) {
      throw new JUnitFatalLaunchException("Error processing shell arguments");
    }
    unitTestShell.messageQueue=new JUnitMessageQueue(unitTestShell.numClients);
    if (!unitTestShell.startUp()) {
      throw new JUnitFatalLaunchException("Shell failed to start");
    }
    Runtime.getRuntime().addShutdownHook(new Thread(new Runnable(){
      public void run(){
        unitTestShell.shutDown();
      }
    }
));
    unitTestShell.lastLaunchFailed=false;
  }
  return unitTestShell;
}
