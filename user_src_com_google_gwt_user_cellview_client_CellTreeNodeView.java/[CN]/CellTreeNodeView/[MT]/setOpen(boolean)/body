{
  if (this.open == open) {
    return;
  }
  this.animate=true;
  this.open=open;
  if (open) {
    if (!nodeInfoLoaded) {
      nodeInfoLoaded=true;
      nodeInfo=tree.getTreeViewModel().getNodeInfo(value);
      if (nodeInfo != null) {
        Set<String> consumedEvents=nodeInfo.getCell().getConsumedEvents();
        if (consumedEvents != null) {
          int eventsToSink=0;
          for (          String typeName : consumedEvents) {
            int typeId=Event.getTypeInt(typeName);
            if (typeId > 0) {
              eventsToSink|=typeId;
            }
          }
          tree.sinkEvents(eventsToSink);
        }
      }
    }
    if (nodeInfo != null) {
      ensureChildContainer();
      showOrHide(showMoreElem,false);
      showOrHide(emptyMessageElem,false);
      if (!isRootNode()) {
        setStyleName(getCellParent(),tree.getStyle().openItem(),true);
      }
      ensureAnimationFrame().getStyle().setProperty("display","");
      onOpen(nodeInfo);
    }
  }
 else {
    if (!isRootNode()) {
      setStyleName(getCellParent(),tree.getStyle().openItem(),false);
    }
    cleanup();
    tree.maybeAnimateTreeNode(this);
    updateImage(false);
  }
}
