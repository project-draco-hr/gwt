{
  if (!attached) {
    throw new IllegalStateException("Should only call onDetach when the widget is attached to the browser's document");
  }
  try {
    onUnload();
  }
  finally {
    attached=false;
    DOM.setEventListener(getElement(),null);
  }
}
