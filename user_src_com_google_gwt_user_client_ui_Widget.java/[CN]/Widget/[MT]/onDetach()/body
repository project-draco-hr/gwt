{
  if (!isAttached()) {
    throw new IllegalStateException("Should only call onDetach when the widget is attached to the browser's document");
  }
  try {
    onUnload();
    AttachEvent.fire(this,false);
  }
  finally {
    try {
      doDetachChildren();
    }
  finally {
      DOM.setEventListener(getElement(),null);
      attached=false;
    }
  }
}
