{
  logger=logger.branch(TreeLogger.DEBUG,String.format("Generating implementation of %s",interfaceType.getName()));
  ClassSourceFileComposerFactory f=new ClassSourceFileComposerFactory(packageName,implName);
  f.addImport(interfaceType.getQualifiedSourceName());
  f.addImport(Record.class.getName());
  f.addImport(RecordSchema.class.getName());
  f.addImport(interfaceType.getQualifiedSourceName());
  f.addImplementedInterface(interfaceType.getName());
  f.addImplementedInterface(interfaceType.getName());
  SourceWriter sw=f.createSourceWriter(generatorContext,out);
  sw.println();
  sw.println("public <R extends Record> RecordSchema<R> getType(Class<R> recordClass) {");
  sw.indent();
  for (  JClassType publicRecordType : generatedRecordTypes) {
    String qualifiedSourceName=publicRecordType.getQualifiedSourceName();
    sw.println("if (recordClass == " + qualifiedSourceName + ".class) {");
    sw.indent();
    sw.println("return (RecordSchema<R>) " + qualifiedSourceName + "Impl.SCHEMA;");
    sw.outdent();
    sw.println("}");
  }
  sw.println("throw new IllegalArgumentException(\"Unknown recordClass \" + recordClass);");
  sw.indent();
  sw.outdent();
  sw.outdent();
  sw.println("}");
  sw.println("public RecordSchema<? extends Record> getType(String token) {");
  sw.indent();
  sw.println("String[] bits = token.split(\"-\");");
  for (  JClassType publicRecordType : generatedRecordTypes) {
    String qualifiedSourceName=publicRecordType.getQualifiedSourceName();
    sw.println("if (bits[0].equals(\"" + qualifiedSourceName + "\")) {");
    sw.indent();
    sw.println("return " + qualifiedSourceName + "Impl.SCHEMA;");
    sw.outdent();
    sw.println("}");
  }
  sw.println("throw new IllegalArgumentException(\"Unknown string token: \" + token);");
  sw.outdent();
  sw.println("}");
  sw.println("public String getClassToken(Class<?> recordClass) {");
  sw.indent();
  for (  JClassType publicRecordType : generatedRecordTypes) {
    String qualifiedSourceName=publicRecordType.getQualifiedSourceName();
    sw.println("if (recordClass == " + qualifiedSourceName + ".class) {");
    sw.indent();
    sw.println("return \"" + qualifiedSourceName + "\";");
    sw.outdent();
    sw.println("}");
  }
  sw.println("throw new IllegalArgumentException(\"Unknown recordClass \" + recordClass);");
  sw.indent();
  sw.outdent();
  sw.outdent();
  sw.println("}");
  sw.outdent();
  sw.println("}");
  sw.println();
  generatorContext.commit(logger,out);
}
