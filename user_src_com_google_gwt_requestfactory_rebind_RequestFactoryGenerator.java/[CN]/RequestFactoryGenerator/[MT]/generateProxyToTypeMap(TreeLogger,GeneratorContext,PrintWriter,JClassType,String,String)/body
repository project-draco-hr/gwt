{
  logger=logger.branch(TreeLogger.DEBUG,String.format("Generating implementation of %s",interfaceType.getName()));
  ClassSourceFileComposerFactory f=new ClassSourceFileComposerFactory(packageName,implName);
  f.addImport(interfaceType.getQualifiedSourceName());
  f.addImport(EntityProxy.class.getName());
  f.addImport(ProxySchema.class.getName());
  f.addImport(interfaceType.getQualifiedSourceName());
  f.addImplementedInterface(interfaceType.getName());
  f.addImplementedInterface(interfaceType.getName());
  SourceWriter sw=f.createSourceWriter(generatorContext,out);
  sw.println();
  sw.println("public <R extends EntityProxy> ProxySchema<R> getType(Class<R> proxyClass) {");
  sw.indent();
  for (  JClassType publicProxyType : generatedProxyTypes) {
    String qualifiedSourceName=publicProxyType.getQualifiedSourceName();
    sw.println("if (proxyClass == " + qualifiedSourceName + ".class) {");
    sw.indent();
    sw.println("return (ProxySchema<R>) " + qualifiedSourceName + "Impl.SCHEMA;");
    sw.outdent();
    sw.println("}");
  }
  sw.println("throw new IllegalArgumentException(\"Unknown proxyClass \" + proxyClass);");
  sw.indent();
  sw.outdent();
  sw.outdent();
  sw.println("}");
  sw.println("public ProxySchema<? extends EntityProxy> getType(String token) {");
  sw.indent();
  sw.println("String[] bits = token.split(\"-\");");
  for (  JClassType publicProxyType : generatedProxyTypes) {
    String qualifiedSourceName=publicProxyType.getQualifiedSourceName();
    sw.println("if (bits[0].equals(\"" + qualifiedSourceName + "\")) {");
    sw.indent();
    sw.println("return " + qualifiedSourceName + "Impl.SCHEMA;");
    sw.outdent();
    sw.println("}");
  }
  sw.println("throw new IllegalArgumentException(\"Unknown string token: \" + token);");
  sw.outdent();
  sw.println("}");
  sw.println("public String getClassToken(Class<?> proxyClass) {");
  sw.indent();
  for (  JClassType publicProxyType : generatedProxyTypes) {
    String qualifiedSourceName=publicProxyType.getQualifiedSourceName();
    sw.println("if (proxyClass == " + qualifiedSourceName + ".class) {");
    sw.indent();
    sw.println("return \"" + qualifiedSourceName + "\";");
    sw.outdent();
    sw.println("}");
  }
  sw.println("throw new IllegalArgumentException(\"Unknown proxyClass \" + proxyClass);");
  sw.indent();
  sw.outdent();
  sw.outdent();
  sw.println("}");
  sw.outdent();
  sw.println("}");
  sw.println();
  generatorContext.commit(logger,out);
}
