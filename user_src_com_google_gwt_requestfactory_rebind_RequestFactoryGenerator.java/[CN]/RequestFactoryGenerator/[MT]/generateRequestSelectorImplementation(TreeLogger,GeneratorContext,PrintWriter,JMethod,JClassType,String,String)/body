{
  JClassType selectorInterface=selectorMethod.getReturnType().isInterface();
  logger=logger.branch(TreeLogger.DEBUG,String.format("Generating implementation of %s",selectorInterface.getName()));
  ClassSourceFileComposerFactory f=new ClassSourceFileComposerFactory(packageName,implName);
  f.addImport(RequestData.class.getName());
  f.addImport(mainType.getQualifiedSourceName() + "Impl");
  f.addImplementedInterface(selectorInterface.getQualifiedSourceName());
  SourceWriter sw=f.createSourceWriter(generatorContext,out);
  sw.println();
  sw.println("private final " + mainType.getName() + "Impl factory;");
  sw.println();
  sw.println("public " + implName + "("+ mainType.getName()+ "Impl factory) {");
  sw.indent();
  sw.println("this.factory = factory;");
  sw.outdent();
  sw.println("}");
  sw.println();
  for (  JMethod method : selectorInterface.getOverridableMethods()) {
    JClassType returnType=method.getReturnType().isParameterized().getTypeArgs()[0];
    ensureProxyType(logger,generatorContext,returnType.getPackage().getName(),returnType);
    String operationName=selectorInterface.getQualifiedBinaryName() + ReflectionBasedOperationRegistry.SCOPE_SEPARATOR + method.getName();
    JClassType requestType=method.getReturnType().isClassOrInterface();
    String requestClassName=null;
    TypeOracle typeOracle=generatorContext.getTypeOracle();
    String enumOrFindArgument="";
    if (isProxyListRequest(typeOracle,requestType)) {
      requestClassName=asInnerImplClass("ListRequestImpl",returnType);
    }
 else     if (isProxyRequest(typeOracle,requestType)) {
      if (selectorInterface.isAssignableTo(typeOracle.findType(FindRequest.class.getName()))) {
        enumOrFindArgument=", proxyId";
        requestClassName=FindRequestObjectImpl.class.getName();
      }
 else {
        requestClassName=asInnerImplClass("ObjectRequestImpl",returnType);
      }
    }
 else     if (isStringRequest(typeOracle,requestType)) {
      requestClassName=AbstractStringRequest.class.getName();
    }
 else     if (isLongRequest(typeOracle,requestType)) {
      requestClassName=AbstractLongRequest.class.getName();
    }
 else     if (isIntegerRequest(typeOracle,requestType)) {
      requestClassName=AbstractIntegerRequest.class.getName();
    }
 else     if (isDoubleRequest(typeOracle,requestType)) {
      requestClassName=AbstractDoubleRequest.class.getName();
    }
 else     if (isByteRequest(typeOracle,requestType)) {
      requestClassName=AbstractByteRequest.class.getName();
    }
 else     if (isBooleanRequest(typeOracle,requestType)) {
      requestClassName=AbstractBooleanRequest.class.getName();
    }
 else     if (isShortRequest(typeOracle,requestType)) {
      requestClassName=AbstractShortRequest.class.getName();
    }
 else     if (isFloatRequest(typeOracle,requestType)) {
      requestClassName=AbstractFloatRequest.class.getName();
    }
 else     if (isCharacterRequest(typeOracle,requestType)) {
      requestClassName=AbstractCharacterRequest.class.getName();
    }
 else     if (isDateRequest(typeOracle,requestType)) {
      requestClassName=AbstractDateRequest.class.getName();
    }
 else     if (isBigDecimalRequest(typeOracle,requestType)) {
      requestClassName=AbstractBigDecimalRequest.class.getName();
    }
 else     if (isBigIntegerRequest(typeOracle,requestType)) {
      requestClassName=AbstractBigIntegerRequest.class.getName();
    }
 else     if (isEnumRequest(typeOracle,requestType)) {
      requestClassName=AbstractEnumRequest.class.getName();
      enumOrFindArgument=", " + requestType.isParameterized().getTypeArgs()[0] + ".values()";
    }
 else     if (isVoidRequest(typeOracle,requestType)) {
      requestClassName=AbstractVoidRequest.class.getName();
    }
 else {
      logger.log(TreeLogger.ERROR,"Return type " + requestType + " is not yet supported");
      throw new UnableToCompleteException();
    }
    sw.println(getMethodDeclaration(method) + " {");
    sw.indent();
    sw.println("return new " + requestClassName + "(factory"+ enumOrFindArgument+ ") {");
    sw.indent();
    String requestDataName=RequestData.class.getSimpleName();
    sw.println("public " + requestDataName + " getRequestData() {");
    sw.indent();
    sw.println("return new " + requestDataName + "(\""+ operationName+ "\", "+ getParametersAsString(method,typeOracle)+ ", "+ "getPropertyRefs());");
    sw.outdent();
    sw.println("}");
    sw.outdent();
    sw.println("};");
    sw.outdent();
    sw.println("}");
  }
  sw.outdent();
  sw.println("}");
  generatorContext.commit(logger,out);
}
