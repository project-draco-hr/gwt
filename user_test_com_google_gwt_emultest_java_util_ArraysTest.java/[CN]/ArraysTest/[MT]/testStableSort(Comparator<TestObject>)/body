{
  TestObject[] origData=new TestObject[]{new TestObject(3),new TestObject(11),new TestObject(2),new TestObject(3),new TestObject(1),new TestObject(3),new TestObject(22)};
  int[] permutation=new int[origData.length];
  while (validPermutation(permutation,origData.length)) {
    TestObject[] permutedArray=getPermutation(origData,permutation);
    Arrays.sort(permutedArray,comparator);
    for (int i=1; i < permutedArray.length; ++i) {
      TestObject prev=permutedArray[i - 1];
      TestObject cur=permutedArray[i];
      int cmp=comparator.compare(prev,cur);
      if (cmp > 0 || (cmp == 0 && prev.getIndex() > cur.getIndex())) {
        String msg="Permutation " + Arrays.toString(permutation) + ": "+ Arrays.toString(permutedArray);
        permutedArray=getPermutation(origData,permutation);
        msg+=" (orig: " + Arrays.toString(permutedArray) + ")";
        fail(msg);
      }
    }
    nextPermutation(permutation);
  }
}
