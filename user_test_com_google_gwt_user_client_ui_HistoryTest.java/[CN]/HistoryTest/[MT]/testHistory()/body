{
  if (isSafari2()) {
    return;
  }
  History.newItem("if-you-see-this-then-history-went-back-too-far");
  delayTestFinish(10000);
  addHistoryListenerImpl(new HistoryListener(){
    private int state=0;
    public void onHistoryChanged(    String historyToken){
switch (state) {
case 0:
{
          if (!historyToken.equals("foo bar")) {
            fail("Expecting token 'foo bar', but got: " + historyToken);
          }
          state=1;
          History.newItem("baz");
          break;
        }
case 1:
{
        if (!historyToken.equals("baz")) {
          fail("Expecting token 'baz', but got: " + historyToken);
        }
        state=2;
        History.back();
        break;
      }
case 2:
{
      if (!historyToken.equals("foo bar")) {
        fail("Expecting token 'foo bar' after History.back(), but got: " + historyToken);
      }
      finishTest();
      break;
    }
}
}
}
);
new Timer(){
@Override public void run(){
History.newItem("foo bar");
}
}
.schedule(5000);
}
