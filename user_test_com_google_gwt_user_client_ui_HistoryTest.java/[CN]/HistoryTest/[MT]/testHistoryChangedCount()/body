{
  delayTestFinish(5000);
  timer=new Timer(){
    private int count=0;
    @Override public void run(){
      if (count++ == 0) {
        History.newItem("testHistoryChangedCount");
        timer.schedule(500);
      }
 else {
        finishTest();
      }
    }
  }
;
  addHistoryListenerImpl(new ValueChangeHandler<String>(){
    final ArrayList<Object> counter=new ArrayList<Object>();
    @Override public void onValueChange(    ValueChangeEvent<String> event){
      counter.add(null);
      if (counter.size() != 1) {
        fail("onHistoryChanged called multiple times");
      }
      timer.schedule(500);
    }
  }
);
  History.newItem("testHistoryChangedCount");
}
