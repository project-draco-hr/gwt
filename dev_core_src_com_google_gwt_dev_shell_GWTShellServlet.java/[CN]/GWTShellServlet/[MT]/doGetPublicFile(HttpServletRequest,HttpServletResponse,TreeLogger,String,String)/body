{
  logger=logger.branch(TreeLogger.TRACE,"The development shell servlet received a request for '" + partialPath + "' in module '"+ moduleName+ ".gwt.xml' ",null);
  if (shouldAutoGenerateResources()) {
    if (autoGenerateResources(request,response,logger,partialPath,moduleName)) {
      return;
    }
  }
  URL foundResource=null;
  try {
    ModuleDef moduleDef=getModuleDef(logger,moduleName);
    if (shouldAutoGenerateResources()) {
      Resource publicResource=moduleDef.findPublicFile(partialPath);
      if (publicResource != null) {
        foundResource=publicResource.getURL();
      }
      if (foundResource == null) {
        File shellDir=getShellWorkDirs().getShellPublicGenDir(moduleDef);
        File requestedFile=new File(shellDir,partialPath);
        if (requestedFile.exists()) {
          try {
            foundResource=requestedFile.toURI().toURL();
          }
 catch (          MalformedURLException e) {
          }
        }
      }
    }
    if (foundResource == null) {
      File moduleDir=getShellWorkDirs().getCompilerOutputDir(moduleDef);
      File requestedFile=new File(moduleDir,partialPath);
      if (requestedFile.exists()) {
        try {
          foundResource=requestedFile.toURI().toURL();
        }
 catch (        MalformedURLException e) {
        }
      }
    }
    if (foundResource == null) {
      String msg;
      if ("gwt.js".equals(partialPath)) {
        msg="Loading the old 'gwt.js' bootstrap script is no longer supported; please load '" + moduleName + ".nocache.js' directly";
      }
 else {
        msg="Resource not found: " + partialPath + "; "+ "(could a file be missing from the public path or a <servlet> "+ "tag misconfigured in module "+ moduleName+ ".gwt.xml ?)";
      }
      logger.log(TreeLogger.WARN,msg,null);
      throw new UnableToCompleteException();
    }
  }
 catch (  UnableToCompleteException e) {
    sendErrorResponse(response,HttpServletResponse.SC_NOT_FOUND,"Cannot find resource '" + partialPath + "' in the public path of module '"+ moduleName+ "'");
    return;
  }
  String path=foundResource.toExternalForm();
  String mimeType=null;
  try {
    mimeType=getServletContext().getMimeType(path);
  }
 catch (  UnsupportedOperationException e) {
  }
  if (mimeType == null) {
    mimeType=guessMimeType(path);
    if (logger.isLoggable(TreeLogger.TRACE)) {
      logger.log(TreeLogger.TRACE,"Guessed MIME type '" + mimeType + "'",null);
    }
  }
  maybeIssueXhtmlWarning(logger,mimeType,partialPath);
  long cacheSeconds=getCacheTime(path);
  InputStream is=null;
  try {
    URLConnection conn=foundResource.openConnection();
    long lastModified=conn.getLastModified();
    if (isNotModified(request,lastModified)) {
      response.setStatus(HttpServletResponse.SC_NOT_MODIFIED);
      setResponseCacheHeaders(response,cacheSeconds);
      return;
    }
    response.setStatus(HttpServletResponse.SC_OK);
    long now=new Date().getTime();
    response.setHeader(HttpHeaders.DATE,HttpHeaders.toInternetDateFormat(now));
    response.setContentType(mimeType);
    String lastModifiedStr=HttpHeaders.toInternetDateFormat(lastModified);
    response.setHeader(HttpHeaders.LAST_MODIFIED,lastModifiedStr);
    setResponseCacheHeaders(response,cacheSeconds);
    int contentLength=conn.getContentLength();
    if (contentLength >= 0) {
      response.setHeader(HttpHeaders.CONTENT_LENGTH,Integer.toString(contentLength));
    }
    is=conn.getInputStream();
    streamOut(is,response.getOutputStream(),1024 * 8);
  }
  finally {
    Utility.close(is);
  }
}
