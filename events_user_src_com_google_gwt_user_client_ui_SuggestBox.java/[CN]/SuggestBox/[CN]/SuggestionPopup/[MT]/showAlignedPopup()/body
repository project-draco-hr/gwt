{
  setPopupPositionAndShow(new PositionCallback(){
    public void setPosition(    int offsetWidth,    int offsetHeight){
      int textBoxOffsetWidth=box.getOffsetWidth();
      int offsetWidthDiff=offsetWidth - textBoxOffsetWidth;
      int left;
      if (LocaleInfo.getCurrentLocale().isRTL()) {
        int textBoxAbsoluteLeft=box.getAbsoluteLeft();
        left=textBoxAbsoluteLeft - offsetWidthDiff;
        if (offsetWidthDiff > 0) {
          int windowRight=Window.getClientWidth() + Window.getScrollLeft();
          int windowLeft=Window.getScrollLeft();
          int textBoxLeftValForRightEdge=textBoxAbsoluteLeft + textBoxOffsetWidth;
          int distanceToWindowRight=windowRight - textBoxLeftValForRightEdge;
          int distanceFromWindowLeft=textBoxLeftValForRightEdge - windowLeft;
          if (distanceFromWindowLeft < offsetWidth && distanceToWindowRight >= offsetWidthDiff) {
            left=textBoxAbsoluteLeft;
          }
        }
      }
 else {
        left=box.getAbsoluteLeft();
        if (offsetWidthDiff > 0) {
          int windowRight=Window.getClientWidth() + Window.getScrollLeft();
          int windowLeft=Window.getScrollLeft();
          int distanceToWindowRight=windowRight - left;
          int distanceFromWindowLeft=left - windowLeft;
          if (distanceToWindowRight < offsetWidth && distanceFromWindowLeft >= offsetWidthDiff) {
            left-=offsetWidthDiff;
          }
        }
      }
      int top=box.getAbsoluteTop();
      int windowTop=Window.getScrollTop();
      int windowBottom=Window.getScrollTop() + Window.getClientHeight();
      int distanceFromWindowTop=top - windowTop;
      int distanceToWindowBottom=windowBottom - (top + box.getOffsetHeight());
      if (distanceToWindowBottom < offsetHeight && distanceFromWindowTop >= offsetHeight) {
        top-=offsetHeight;
      }
 else {
        top+=box.getOffsetHeight();
      }
      setPopupPosition(left,top);
    }
  }
);
}
