{
  assertEquals("overall dir matches context dir (LTR)",en + "&lt;",ltrFmt.spanWrapWithKnownDir(LTR,en + "<"));
  assertEquals("overall dir matches context dir (LTR), HTML",en + "<br>",ltrFmt.spanWrapWithKnownDir(LTR,en + "<br>",true));
  assertEquals("overall dir matches context dir (RTL)",he + "&lt;",rtlFmt.spanWrapWithKnownDir(RTL,he + "<"));
  assertEquals("overall dir matches context dir (RTL), HTML",he + " <some strange tag>",rtlFmt.spanWrapWithKnownDir(RTL,he + " <some strange tag>",true));
  assertEquals("overall dir (RTL) doesnt match context dir (LTR)","<span dir=rtl>" + he + "</span>"+ LRM,ltrFmt.spanWrapWithKnownDir(RTL,he));
  assertEquals("overall dir (RTL) doesnt match context dir (LTR), no dirReset","<span dir=rtl>" + he + "</span>",ltrFmt.spanWrapWithKnownDir(RTL,he,false,false));
  assertEquals("overall dir (LTR) doesnt match context dir (RTL)","<span dir=ltr>" + en + "</span>"+ RLM,rtlFmt.spanWrapWithKnownDir(LTR,en));
  assertEquals("overall dir (LTR) doesnt match context dir (RTL), no dirReset","<span dir=ltr>" + en + "</span>",rtlFmt.spanWrapWithKnownDir(LTR,en,false,false));
  assertEquals("overall dir (RTL) doesnt match context dir (unknown)","<span dir=rtl>" + he + "</span>",unkFmt.spanWrapWithKnownDir(RTL,he));
  assertEquals("overall dir (LTR) doesnt match context dir (unknown), no dirReset","<span dir=ltr>" + en + "</span>",unkFmt.spanWrapWithKnownDir(LTR,en,false,false));
  assertEquals("overall dir (neutral) doesnt match context dir (LTR)",".",ltrFmt.spanWrapWithKnownDir(DEFAULT,"."));
  assertEquals("exit dir (but not overall dir) is opposite to context dir",longEn + he + LRM,ltrFmt.spanWrapWithKnownDir(LTR,longEn + he));
  assertEquals("overall dir (but not exit dir) is opposite to context dir","<span dir=ltr>" + longEn + he+ "</span>"+ RLM,rtlFmt.spanWrapWithKnownDir(LTR,longEn + he));
  assertEquals("exit dir (but not overall dir) is opposite to context dir",longEn + he + html+ LRM,ltrFmt.spanWrapWithKnownDir(LTR,longEn + he + html,true,true));
  assertEquals("overall dir (but not exit dir) is opposite to context dir, dirReset","<span dir=ltr>" + longEn + he+ "</span>"+ RLM,rtlFmt.spanWrapWithKnownDir(LTR,longEn + he,true,true));
  assertEquals("plain text overall and exit dir same as context dir","&lt;br&gt; " + he + " &lt;br&gt;",ltrFmt.spanWrapWithKnownDir(LTR,"<br> " + he + " <br>",false));
  assertEquals("HTML overall and exit dir opposite to context dir","<span dir=rtl><br> " + he + " <br></span>"+ LRM,ltrFmt.spanWrapWithKnownDir(RTL,"<br> " + he + " <br>",true));
  BidiFormatter ltrAlwaysSpanFmt=BidiFormatter.getInstance(LTR,true);
  BidiFormatter rtlAlwaysSpanFmt=BidiFormatter.getInstance(RTL,true);
  BidiFormatter unkAlwaysSpanFmt=BidiFormatter.getInstance(DEFAULT,true);
  assertEquals("alwaysSpan, overall dir matches context dir (LTR)","<span>" + en + "</span>",ltrAlwaysSpanFmt.spanWrapWithKnownDir(LTR,en));
  assertEquals("alwaysSpan, overall dir matches context dir (LTR), no dirReset","<span>" + en + "</span>",ltrAlwaysSpanFmt.spanWrapWithKnownDir(LTR,en,false,false));
  assertEquals("alwaysSpan, overall dir matches context dir (RTL)","<span>" + he + "</span>",rtlAlwaysSpanFmt.spanWrapWithKnownDir(RTL,he));
  assertEquals("alwaysSpan, overall dir matches context dir (RTL), no dirReset","<span>" + he + "</span>",rtlAlwaysSpanFmt.spanWrapWithKnownDir(RTL,he,false,false));
  assertEquals("alwaysSpan, exit dir (but not overall dir) is opposite to context dir","<span>" + longEn + he+ "</span>"+ LRM,ltrAlwaysSpanFmt.spanWrapWithKnownDir(LTR,longEn + he,true,true));
  assertEquals("alwaysSpan, overall dir (but not exit dir) is opposite to context dir, dirReset","<span dir=ltr>" + longEn + he+ "</span>"+ RLM,rtlAlwaysSpanFmt.spanWrapWithKnownDir(LTR,longEn + he,true,true));
  assertEquals("alwaysSpan, plain text overall and exit dir same as context dir","<span>&lt;br&gt; " + he + " &lt;br&gt;</span>",ltrAlwaysSpanFmt.spanWrapWithKnownDir(LTR,"<br> " + he + " <br>",false));
  assertEquals("alwaysSpan, HTML overall and exit dir opposite to context dir","<span dir=rtl><br> " + he + " <br></span>"+ LRM,ltrAlwaysSpanFmt.spanWrapWithKnownDir(RTL,"<br> " + he + " <br>",true));
}
