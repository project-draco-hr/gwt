{
  if (isDisposed())   SWT.error(SWT.ERROR_DEVICE_DISPOSED);
  int window=gcWindow;
  if (window == 0) {
    window=gcWindow=createOverlayWindow();
  }
 else {
    int gdevice=OS.GetMainDevice();
    int[] ptr=new int[1];
    OS.memcpy(ptr,gdevice,4);
    GDevice device=new GDevice();
    OS.memcpy(device,ptr[0],GDevice.sizeof);
    Rect rect=new Rect();
    OS.SetRect(rect,device.left,device.top,device.right,device.bottom);
    OS.SetWindowBounds(window,(short)OS.kWindowStructureRgn,rect);
  }
  int port=OS.GetWindowPort(window);
  int[] buffer=new int[1];
  OS.CreateCGContextForPort(port,buffer);
  int context=buffer[0];
  if (context == 0)   SWT.error(SWT.ERROR_NO_HANDLES);
  Rect portRect=new Rect();
  OS.GetPortBounds(port,portRect);
  OS.CGContextScaleCTM(context,1,-1);
  OS.CGContextTranslateCTM(context,0,portRect.top - portRect.bottom);
  if (data != null) {
    int mask=SWT.LEFT_TO_RIGHT | SWT.RIGHT_TO_LEFT;
    if ((data.style & mask) == 0) {
      data.style|=SWT.LEFT_TO_RIGHT;
    }
    data.device=this;
    data.window=window;
    data.background=getSystemColor(SWT.COLOR_WHITE).handle;
    data.foreground=getSystemColor(SWT.COLOR_BLACK).handle;
    data.font=getSystemFont();
    data.updateClip=true;
  }
 else {
    OS.ShowWindow(window);
  }
  return context;
}
