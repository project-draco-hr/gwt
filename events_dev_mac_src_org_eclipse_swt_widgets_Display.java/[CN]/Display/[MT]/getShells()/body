{
  checkDevice();
  int index=0;
  Shell[] result=new Shell[16];
  for (int i=0; i < widgetTable.length; i++) {
    Widget widget=widgetTable[i];
    if (widget != null && widget instanceof Shell) {
      int j=0;
      while (j < index) {
        if (result[j] == widget)         break;
        j++;
      }
      if (j == index) {
        if (index == result.length) {
          Shell[] newResult=new Shell[index + 16];
          System.arraycopy(result,0,newResult,0,index);
          result=newResult;
        }
        result[index++]=(Shell)widget;
      }
    }
  }
  if (index == result.length)   return result;
  Shell[] newResult=new Shell[index];
  System.arraycopy(result,0,newResult,0,index);
  return newResult;
}
