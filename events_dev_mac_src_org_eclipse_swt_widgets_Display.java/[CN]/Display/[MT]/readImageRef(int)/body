{
  int[] image=null;
  int url=OS.CFURLCreateFromFileSystemRepresentation(OS.kCFAllocatorDefault,path,OS.strlen(path),false);
  if (url != 0) {
    int extention=OS.CFURLCopyPathExtension(url);
    if (extention != 0) {
      int length=OS.CFStringGetLength(extention);
      char[] buffer=new char[length];
      CFRange range=new CFRange();
      range.length=length;
      OS.CFStringGetCharacters(extention,range,buffer);
      String ext=new String(buffer);
      if (ext.equalsIgnoreCase("png")) {
        int provider=OS.CGDataProviderCreateWithURL(url);
        if (provider != 0) {
          image=new int[]{OS.CGImageCreateWithPNGDataProvider(provider,null,true,OS.kCGRenderingIntentDefault),0};
          OS.CGDataProviderRelease(provider);
        }
      }
 else       if (ext.equalsIgnoreCase("jpeg") || ext.equals("jpg")) {
        int provider=OS.CGDataProviderCreateWithURL(url);
        if (provider != 0) {
          image=new int[]{OS.CGImageCreateWithJPEGDataProvider(provider,null,true,OS.kCGRenderingIntentDefault),0};
          OS.CGDataProviderRelease(provider);
        }
      }
 else       if (ext.equalsIgnoreCase("icns")) {
        byte[] fsRef=new byte[80];
        if (OS.CFURLGetFSRef(url,fsRef)) {
          byte[] fsSpec=new byte[70];
          if (OS.FSGetCatalogInfo(fsRef,0,null,null,fsSpec,null) == OS.noErr) {
            int[] iconFamily=new int[1];
            OS.ReadIconFile(fsSpec,iconFamily);
            if (iconFamily[0] != 0) {
              image=createImageFromFamily(iconFamily[0],OS.kThumbnail32BitData,OS.kThumbnail8BitMask,128,128);
              OS.DisposeHandle(iconFamily[0]);
            }
          }
        }
      }
      OS.CFRelease(extention);
    }
    OS.CFRelease(url);
  }
  return image;
}
