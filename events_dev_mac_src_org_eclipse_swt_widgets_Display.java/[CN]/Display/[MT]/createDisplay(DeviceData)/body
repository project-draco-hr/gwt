{
  int[] psn=new int[2];
  if (OS.GetCurrentProcess(psn) == OS.noErr) {
    int pid=OS.getpid();
    byte[] buffer=null;
    int ptr=OS.getenv(ascii("APP_NAME_" + pid));
    if (ptr != 0) {
      buffer=new byte[OS.strlen(ptr) + 1];
      OS.memcpy(buffer,ptr,buffer.length);
    }
 else {
      if (APP_NAME != null) {
        char[] chars=new char[APP_NAME.length()];
        APP_NAME.getChars(0,chars.length,chars,0);
        int cfstring=OS.CFStringCreateWithCharacters(OS.kCFAllocatorDefault,chars,chars.length);
        if (cfstring != 0) {
          CFRange range=new CFRange();
          range.length=chars.length;
          int encoding=OS.CFStringGetSystemEncoding();
          int[] size=new int[1];
          int numChars=OS.CFStringGetBytes(cfstring,range,encoding,(byte)'?',true,null,0,size);
          if (numChars != 0) {
            buffer=new byte[size[0] + 1];
            numChars=OS.CFStringGetBytes(cfstring,range,encoding,(byte)'?',true,buffer,size[0],size);
          }
          OS.CFRelease(cfstring);
        }
      }
    }
    if (buffer != null)     OS.CPSSetProcessName(psn,buffer);
    OS.CPSEnableForegroundOperation(psn,0x03,0x3C,0x2C,0x1103);
    OS.SetFrontProcess(psn);
    ptr=OS.getenv(ascii("APP_ICON_" + pid));
    if (ptr != 0) {
      int[] image=readImageRef(ptr);
      if (image != null) {
        dockImage=image[0];
        dockImageData=image[1];
        OS.SetApplicationDockTileImage(dockImage);
      }
    }
  }
  OS.ClearMenuBar();
  queue=OS.GetCurrentEventQueue();
  OS.TXNInitTextension(0,0,0);
  OS.RegisterAppearanceClient();
  highlightColor=new RGBColor();
  OS.GetThemeBrushAsColor((short)OS.kThemeBrushPrimaryHighlightColor,(short)getDepth(),true,highlightColor);
}
