{
  int eventKind=OS.GetEventKind(theEvent);
  HICommand command=new HICommand();
  OS.GetEventParameter(theEvent,OS.kEventParamDirectObject,OS.typeHICommand,null,HICommand.sizeof,null,command);
switch (eventKind) {
case OS.kEventProcessCommand:
{
      if (command.commandID == OS.kAEQuitApplication) {
        if (!closing)         close();
        return OS.noErr;
      }
      if ((command.attributes & OS.kHICommandFromMenu) != 0) {
        if (userData != 0) {
          Widget widget=getWidget(userData);
          if (widget != null)           return widget.commandProc(nextHandler,theEvent,userData);
        }
 else {
          int result=OS.eventNotHandledErr;
          int menuRef=command.menu_menuRef;
          short menuID=OS.GetMenuID(menuRef);
          Menu menu=getMenu(menuID);
          if (menu != null) {
            MenuItem item=null;
            if (menu.closed && menu.modified) {
              item=menu.lastTarget;
            }
 else {
              item=menu.getItem(command.menu_menuItemIndex - 1);
            }
            if (item != null) {
              result=item.kEventProcessCommand(nextHandler,theEvent,userData);
            }
          }
          OS.HiliteMenu((short)0);
          return result;
        }
      }
    }
}
return OS.eventNotHandledErr;
}
