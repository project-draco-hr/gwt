{
  sourceOracle.addOrReplace(new MockJavaResource("test.EntryPoint"){
    @Override public CharSequence getContent(){
      return code;
    }
  }
);
  CompilerContext compilerContext=provideCompilerContext();
  CompilationState state=CompilationStateBuilder.buildFrom(logger,compilerContext,sourceOracle.getResources(),getAdditionalTypeProviderDelegate());
  ConfigProps config=new ConfigProps(Lists.newArrayList(configProps));
  jProgram=JavaAstConstructor.construct(logger,state,compilerContext.getOptions(),config,"test.EntryPoint","com.google.gwt.lang.Exceptions");
  jProgram.addEntryMethod(findMethod(jProgram,"onModuleLoad"));
  optimizeJava();
  ComputeCastabilityInformation.exec(jProgram,false);
  ComputeInstantiatedJsoInterfaces.exec(jProgram);
  ImplementCastsAndTypeChecks.exec(jProgram,false);
  ArrayNormalizer.exec(jProgram,false);
  TypeTightener.exec(jProgram);
  MethodCallTightener.exec(jProgram);
  Map<JType,JLiteral> typeIdsByType=ResolveRuntimeTypeReferences.IntoIntLiterals.exec(jProgram);
  Map<StandardSymbolData,JsName> symbolTable=new TreeMap<StandardSymbolData,JsName>(new SymbolData.ClassIdentComparator());
  PermProps props=new PermProps(Arrays.asList(new BindingProps(orderedProps,orderedPropValues,config)));
  return GenerateJavaScriptAST.exec(logger,jProgram,jsProgram,compilerContext,typeIdsByType,symbolTable,props);
}
