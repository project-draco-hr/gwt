{
  JsFunction callerFunction=functionStack.peek();
  JsFunction invokedFunction=JsUtils.isFunction(x.getQualifier());
  if (invokedFunction == null) {
    return;
  }
  if (!invokedFunction.isInliningAllowed() || blacklist.contains(invokedFunction)) {
    return;
  }
  if (invokedFunction.getBody().getStatements().size() > MAX_INLINE_FN_SIZE) {
    return;
  }
  if (invokedFunction == callerFunction) {
    blacklist.add(invokedFunction);
    return;
  }
  if (inlining.contains(invokedFunction)) {
    return;
  }
  inlining.push(invokedFunction);
  x=tryToUnravelExplicitCall(x);
  JsExpression op=process(x,callerFunction,invokedFunction);
  if (x != op) {
    op=accept(op);
    ctx.replaceMe(op);
  }
  if (inlining.pop() != invokedFunction) {
    throw new RuntimeException("Unexpected function popped");
  }
}
