{
  Process process=runCommandIgnoringErr(workDir,cmd);
  StringBuilder output=new StringBuilder();
  LineNumberReader lnr=new LineNumberReader(new InputStreamReader(process.getInputStream()));
  try {
    for (String line=lnr.readLine(); line != null; line=lnr.readLine()) {
      output.append(line);
      output.append('\n');
    }
    int statusCode=process.waitFor();
    if (checkStatusCode && statusCode != 0) {
      throw new BuildException("Non-zero status code result (" + statusCode + ") running command: "+ makeCmdString(cmd));
    }
    return output.toString();
  }
 catch (  IOException e) {
    throw new BuildException("Unable to read command: " + makeCmdString(cmd),e);
  }
catch (  InterruptedException e) {
    throw new BuildException("Interrupted waiting for command: " + makeCmdString(cmd),e);
  }
}
