{
  char[] input=toEscape.toCharArray();
  CharVector charVector=new CharVector(input.length * 2 + 2,input.length);
  charVector.add(JS_QUOTE_CHAR);
  for (int i=0, n=input.length; i < n; ++i) {
    char c=input[i];
    if (needsUnicodeEscape(c)) {
      unicodeEscape(c,charVector);
    }
 else {
      charVector.add(c);
    }
  }
  charVector.add(JS_QUOTE_CHAR);
  return String.valueOf(charVector.asArray(),0,charVector.getSize());
}
