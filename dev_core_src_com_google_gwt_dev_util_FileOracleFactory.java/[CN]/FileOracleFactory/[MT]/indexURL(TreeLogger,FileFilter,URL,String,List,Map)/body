{
  String urlString=url.toString();
  if (url.getProtocol().equals("file")) {
    URI uri=new URI(urlString);
    File f=new File(uri);
    if (f.isDirectory()) {
      int prefixCharsToStrip=f.getAbsolutePath().length() + 1 - pkgBase.length();
      indexFolder(logger,filter,prefixCharsToStrip,f,logicalNames,logicalToPhysical);
    }
 else {
      logger.log(TreeLogger.WARN,"Unexpected error, " + f + " is neither a file nor a jar",null);
    }
  }
 else   if (url.getProtocol().equals("jar")) {
    String path=url.getPath();
    int pos=path.indexOf('!');
    if (pos >= 0) {
      String jarPath=path.substring(0,pos);
      String dirPath=path.substring(pos + 2);
      URL jarURL=new URL(jarPath);
      if (jarURL.getProtocol().equals("file")) {
        URI jarURI=new URI(jarURL.toString());
        File f=new File(jarURI);
        JarFile jarFile=new JarFile(f);
        indexJar(logger,filter,"jar" + ":" + jarPath,jarFile,dirPath,pkgBase,logicalNames,logicalToPhysical);
      }
 else {
        logger.log(TreeLogger.WARN,"Unexpected error, jar at " + jarURL + " must be a file: type URL",null);
      }
    }
 else {
      throw new URISyntaxException(path,"Cannot locate '!' separator");
    }
  }
 else {
    logger.log(TreeLogger.WARN,"Unknown URL type for " + urlString,null);
  }
}
