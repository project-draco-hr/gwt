{
  if (!validateArgs(args)) {
    quitEarly(null);
  }
  Options options=new Options();
  int index=0;
  while (index < args.length - 1) {
    String arg=args[index++];
    String nextArg=index < args.length - 1 ? args[index] : null;
    ArgumentConsumer consumer=argumentConsumers.get(arg);
    if (consumer == null) {
      quitEarly("Unknown argument: " + arg);
    }
    boolean skipNextArg=consumer.consume(options,nextArg);
    if (skipNextArg) {
      index++;
    }
  }
  options.resource=new File(args[index]);
  options.singleFile=!options.resource.isDirectory();
  if (!options.resource.exists()) {
    quitEarly("File or Directory does not exists: " + options.resource.getAbsolutePath());
  }
  if (options.recurse && !options.resource.isDirectory()) {
    quitEarly("When using -r the last parameter needs to be a directory");
  }
  return options;
}
