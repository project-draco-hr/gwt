{
  MockLoadStrategy reqs=new MockLoadStrategy();
  MockProgressLogger progress=new MockProgressLogger();
  int numEntries=6;
  AsyncFragmentLoader loader=new AsyncFragmentLoader(numEntries,new int[]{1,2,3},reqs,progress,null);
  loader.inject(1,NULL_ERROR_HANDLER);
  reqs.assertFragmentsRequested(1);
  progress.assertEvent("download1",BEGIN,1);
  loader.inject(3,NULL_ERROR_HANDLER);
  reqs.assertFragmentsRequested();
  progress.assertNoEvents();
  loader.inject(5,NULL_ERROR_HANDLER);
  reqs.assertFragmentsRequested();
  progress.assertNoEvents();
  loader.fragmentHasLoaded(1);
  reqs.assertFragmentsRequested(2);
  progress.assertEvent("download1",END,1);
  progress.assertEvent("download2",BEGIN,2);
  loader.fragmentHasLoaded(2);
  reqs.assertFragmentsRequested(3);
  progress.assertEvent("download2",END,2);
  progress.assertEvent("download3",BEGIN,3);
  loader.fragmentHasLoaded(3);
  reqs.assertFragmentsRequested(numEntries);
  progress.assertEvent("download3",END,3);
  progress.assertEvent("leftoversDownload",BEGIN,numEntries);
  loader.leftoversFragmentHasLoaded();
  reqs.assertFragmentsRequested(5);
  progress.assertEvent("leftoversDownload",END,numEntries);
  progress.assertEvent("download5",BEGIN,5);
  loader.fragmentHasLoaded(5);
  reqs.assertFragmentsRequested();
  progress.assertEvent("download5",END,5);
  progress.assertNoEvents();
  loader.inject(4,NULL_ERROR_HANDLER);
  reqs.assertFragmentsRequested(4);
  progress.assertEvent("download4",BEGIN,4);
  loader.fragmentHasLoaded(4);
  reqs.assertFragmentsRequested();
  progress.assertEvent("download4",END,4);
  progress.assertNoEvents();
}
