{
  final long timeout=System.currentTimeMillis() + 15;
  JUnitMessageQueue queue=createQueue(15,1,1);
  assertEquals(0,queue.getUserAgents().length);
{
    queue.getTestBlock(createClientInfo(0,"ie6"),0,timeout);
    queue.reportFatalLaunch(createClientInfo(1,"gecko1_8"),null);
    queue.reportResults(createClientInfo(2,"safari"),createTestResults(0));
    assertSimilar(new String[]{"ie6","gecko1_8","safari"},queue.getUserAgents());
  }
{
    queue.getTestBlock(createClientInfo(3,"ie7"),0,timeout);
    queue.reportFatalLaunch(createClientInfo(3,"ie7"),null);
    queue.reportResults(createClientInfo(4,"gecko1_8"),createTestResults(0));
    queue.getTestBlock(createClientInfo(3,"ie7"),0,timeout);
    assertSimilar(new String[]{"ie6","ie7","gecko1_8","safari"},queue.getUserAgents());
  }
{
    queue.getTestBlock(createClientInfo(0,"ie6"),0,timeout);
    queue.reportFatalLaunch(createClientInfo(1,"gecko1_8"),null);
    queue.reportResults(createClientInfo(2,"safari"),createTestResults(0));
    assertSimilar(new String[]{"ie6","ie7","gecko1_8","safari"},queue.getUserAgents());
  }
}
