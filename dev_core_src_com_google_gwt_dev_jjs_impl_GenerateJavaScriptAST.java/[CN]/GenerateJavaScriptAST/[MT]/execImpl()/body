{
  new FixNameClashesVisitor().accept(program);
  new CanObserveSubclassUninitializedFieldsVisitor().accept(program);
  new FindNameOfTargets().accept(program);
  new SortVisitor().accept(program);
  if (hasWholeWorldKnowledge) {
    new RecordCrossClassCallsAndConstructorLiveness().accept(program);
    new RecordJSInlinableMethods().accept(program);
  }
  contructTypeToClassLiteralDeclarationMap();
  CreateNamesAndScopesVisitor creator=new CreateNamesAndScopesVisitor();
  creator.accept(program);
  GenerateJavaScriptVisitor generator=new GenerateJavaScriptVisitor();
  generator.accept(program);
  jsProgram.setIndexedFields(indexedFields);
  jsProgram.setIndexedFunctions(indexedFunctions);
  JavaToJavaScriptMap jjsMap=new JavaToJavaScriptMapImpl(program.getDeclaredTypes(),names,typeForStatMap,vtableInitForMethodMap);
  return Pair.create(jjsMap,generator.functionsForJsInlining);
}
