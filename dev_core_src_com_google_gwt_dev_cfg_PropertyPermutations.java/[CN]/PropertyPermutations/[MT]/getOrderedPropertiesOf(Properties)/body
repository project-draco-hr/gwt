{
  Set<BindingProperty> bindingProps=new LinkedHashSet<BindingProperty>(properties.getBindingProperties());
  Map<String,BindingProperty> evaluationOrder=new LinkedHashMap<String,BindingProperty>(bindingProps.size());
  while (!bindingProps.isEmpty()) {
    boolean changed=false;
    for (Iterator<BindingProperty> it=bindingProps.iterator(); it.hasNext(); ) {
      BindingProperty prop=it.next();
      Set<String> deps=prop.getRequiredProperties();
      if (evaluationOrder.keySet().containsAll(deps)) {
        it.remove();
        evaluationOrder.put(prop.getName(),prop);
        changed=true;
      }
    }
    if (!changed) {
      throw new IllegalStateException("Cycle detected within remaining property dependencies " + bindingProps.toString());
    }
  }
  return evaluationOrder.values().toArray(new BindingProperty[evaluationOrder.size()]);
}
