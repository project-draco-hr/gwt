{
  Entity previous=soup.get(entity.getId());
  if (null == previous) {
    throw new IllegalArgumentException(String.format("In %s, unknown id %d",entity,entity.getId()));
  }
  if (!previous.getClass().equals(entity.getClass())) {
    throw new IllegalArgumentException(String.format("Type mismatch, fetched %s for %s",entity,previous));
  }
  return (E)previous;
}
