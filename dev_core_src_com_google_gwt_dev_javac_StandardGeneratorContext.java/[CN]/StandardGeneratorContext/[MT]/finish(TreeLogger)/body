{
  abortUncommittedResources(logger);
  List<String> genTypeNames=new ArrayList<String>();
  try {
    TreeLogger branch;
    if (!committedGeneratedCups.isEmpty()) {
      String msg="Assimilating generated source";
      branch=logger.branch(TreeLogger.DEBUG,msg,null);
      TreeLogger subBranch=null;
      if (branch.isLoggable(TreeLogger.DEBUG)) {
        subBranch=branch.branch(TreeLogger.DEBUG,"Generated source files...",null);
      }
      for (      GeneratedUnit gcup : committedGeneratedCups) {
        String qualifiedTypeName=gcup.getTypeName();
        genTypeNames.add(qualifiedTypeName);
        if (subBranch != null) {
          subBranch.log(TreeLogger.DEBUG,qualifiedTypeName,null);
        }
      }
      compilationState.addGeneratedCompilationUnits(logger,committedGeneratedCups);
    }
    return newlyGeneratedArtifacts;
  }
  finally {
    if (!uncommittedGeneratedCupsByPrintWriter.isEmpty()) {
      String msg="For the following type(s), generated source was never committed (did you forget to call commit()?)";
      logger=logger.branch(TreeLogger.WARN,msg,null);
      for (      Generated unit : uncommittedGeneratedCupsByPrintWriter.values()) {
        logger.log(TreeLogger.WARN,unit.getTypeName(),null);
      }
    }
    uncommittedGeneratedCupsByPrintWriter.clear();
    committedGeneratedCups.clear();
    newlyGeneratedTypeNames.clear();
    newlyGeneratedArtifacts=new ArtifactSet();
  }
}
