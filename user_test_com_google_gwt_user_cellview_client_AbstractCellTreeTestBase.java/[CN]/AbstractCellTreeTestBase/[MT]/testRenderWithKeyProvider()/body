{
  final List<String> rendered=new ArrayList<String>();
  final IndexCell<String> cell=new IndexCell<String>(){
    @Override public void render(    Context context,    String data,    SafeHtmlBuilder sb){
      super.render(context,data,sb);
      int call=rendered.size();
      rendered.add(data);
      assertTrue("render() called more than thrice",rendered.size() < 4);
      assertEquals(call + "value",data);
      Object key=context.getKey();
      assertTrue(key instanceof Integer);
      assertEquals(call,key);
    }
  }
;
  TreeViewModel model=new TreeViewModel(){
    @Override public NodeInfo<?> getNodeInfo(    Object value){
      ProvidesKey<String> keyProvider=new ProvidesKey<String>(){
        @Override public Object getKey(        String item){
          return Integer.parseInt(item.substring(0,1));
        }
      }
;
      ListDataProvider<String> dataProvider=new ListDataProvider<String>(keyProvider);
      dataProvider.getList().add("0value");
      dataProvider.getList().add("1value");
      dataProvider.getList().add("2value");
      return new DefaultNodeInfo<String>(dataProvider,cell);
    }
    @Override public boolean isLeaf(    Object value){
      return value != null;
    }
  }
;
  createAbstractCellTree(model,null);
  delayTestFinish(5000);
  Scheduler.get().scheduleDeferred(new Scheduler.ScheduledCommand(){
    @Override public void execute(){
      assertEquals("Cell#render() should be called exactly thrice",3,rendered.size());
      cell.assertLastRenderIndex(2);
      finishTest();
    }
  }
);
}
