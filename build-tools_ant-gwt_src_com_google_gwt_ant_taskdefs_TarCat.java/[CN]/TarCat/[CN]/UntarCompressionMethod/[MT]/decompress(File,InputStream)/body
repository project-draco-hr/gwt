{
  final String value=getValue();
  if (GZIP.equals(value)) {
    return new GZIPInputStream(istream);
  }
 else {
    if (BZIP2.equals(value)) {
      final char[] magic=new char[]{'B','Z'};
      for (int i=0; i < magic.length; i++) {
        if (istream.read() != magic[i]) {
          throw new BuildException("Invalid bz2 file." + file.toString());
        }
      }
      return new CBZip2InputStream(istream);
    }
  }
  return istream;
}
