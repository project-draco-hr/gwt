{
  if (inString) {
    buf.append("\")");
    inString=false;
  }
  if (returnsSafeHtml && !isSafeHtmlTyped && !isPrimititiveTyped) {
    buf.append(".appendEscaped(");
    if (needsConversionToString) {
      buf.append("String.valueOf(");
    }
  }
 else {
    buf.append(".append(");
  }
  buf.append(expression);
  buf.append(")");
  if (returnsSafeHtml && !isSafeHtmlTyped && !isPrimititiveTyped&& needsConversionToString) {
    buf.append(")");
  }
}
