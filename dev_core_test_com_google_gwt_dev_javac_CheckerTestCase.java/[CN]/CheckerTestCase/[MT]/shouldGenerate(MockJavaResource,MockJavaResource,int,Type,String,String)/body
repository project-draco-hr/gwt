{
  UnitTestTreeLogger.Builder b=new UnitTestTreeLogger.Builder();
  b.setLowestLogLevel(logLevel);
  if (message != null) {
    b.expect(logLevel,logHeader + " in '" + buggyCode.getLocation()+ "'",null);
    final String fullMessage="Line " + line + ": "+ message;
    b.expect(logLevel,fullMessage,null);
  }
  UnitTestTreeLogger logger=b.createLogger();
  TypeOracle oracle=buildOracle(logger,buggyCode,extraCode);
  logger.assertCorrectLogEntries();
  String className=buggyCode.getTypeName();
  if (message != null && logLevel == TreeLogger.ERROR) {
    assertNull("Buggy compilation unit not removed from type oracle",oracle.findType(className));
  }
 else {
    assertNotNull("Buggy compilation unit removed with only a warning",oracle.findType(className));
  }
}
