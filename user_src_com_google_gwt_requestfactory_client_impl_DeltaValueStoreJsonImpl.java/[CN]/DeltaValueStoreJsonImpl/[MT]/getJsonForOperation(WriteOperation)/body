{
  assert(writeOperation == WriteOperation.PERSIST || writeOperation == WriteOperation.UPDATE);
  Map<EntityProxyId<?>,ProxyJsoImpl> recordsMap=getRecordsMap(writeOperation);
  if (recordsMap.size() == 0) {
    return "";
  }
  StringBuffer requestData=new StringBuffer("\"" + writeOperation.getUnObfuscatedEnumName() + "\":[");
  boolean first=true;
  for (  Map.Entry<EntityProxyId<?>,ProxyJsoImpl> entry : recordsMap.entrySet()) {
    ProxyJsoImpl impl=entry.getValue();
    if (first) {
      first=false;
    }
 else {
      requestData.append(",");
    }
    requestData.append("{\"" + entry.getValue().getSchema().getToken() + "\":");
    requestData.append(impl.toJson());
    requestData.append("}");
  }
  requestData.append("]");
  return requestData.toString();
}
