{
  PerfLogger.start("GWTHosted.startUpServer");
  try {
    TreeLogger serverLogger=getTopLogger().branch(TreeLogger.INFO,"Starting HTTP on port " + getPort(),null);
    ModuleDef[] moduleArray=modules.toArray(new ModuleDef[modules.size()]);
    for (    ModuleDef moduleDef : moduleArray) {
      String[] servletPaths=moduleDef.getServletPaths();
      if (servletPaths.length > 0) {
        serverLogger.log(TreeLogger.WARN,"Ignoring legacy <servlet> tag(s) in module '" + moduleDef.getName() + "'; add servlet tags to your web.xml instead");
      }
    }
    servletFilter=new GWTShellServletFilter(serverLogger,options,moduleArray);
    server=launcher.start(serverLogger,getPort(),options.getOutDir(),servletFilter);
    assert(server != null);
    return server.getPort();
  }
 catch (  BindException e) {
    System.err.println("Port " + getPort() + " is already is use; you probably still have another session active");
  }
catch (  Exception e) {
    System.err.println("Unable to start embedded HTTP server");
    e.printStackTrace();
  }
 finally {
    PerfLogger.end();
  }
  return -1;
}
