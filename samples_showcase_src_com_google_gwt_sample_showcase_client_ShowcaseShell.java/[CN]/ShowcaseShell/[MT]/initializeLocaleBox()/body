{
  final String cookieName=LocaleInfo.getLocaleCookieName();
  final String queryParam=LocaleInfo.getLocaleQueryParam();
  if (cookieName == null && queryParam == null) {
    localeSelectionCell.getStyle().setDisplay(Display.NONE);
    return;
  }
  String currentLocale=LocaleInfo.getCurrentLocale().getLocaleName();
  if (currentLocale.equals("default")) {
    currentLocale="en";
  }
  String[] localeNames=LocaleInfo.getAvailableLocaleNames();
  for (  String localeName : localeNames) {
    if (!localeName.equals("default")) {
      String nativeName=LocaleInfo.getLocaleNativeDisplayName(localeName);
      localeBox.addItem(nativeName,localeName);
      if (localeName.equals(currentLocale)) {
        localeBox.setSelectedIndex(localeBox.getItemCount() - 1);
      }
    }
  }
  localeBox.addChangeHandler(new ChangeHandler(){
    @SuppressWarnings("deprecation") public void onChange(    ChangeEvent event){
      String localeName=localeBox.getValue(localeBox.getSelectedIndex());
      if (cookieName != null) {
        Date expires=new Date();
        expires.setYear(expires.getYear() + 1);
        Cookies.setCookie(cookieName,localeName,expires);
      }
      if (queryParam != null) {
        UrlBuilder builder=Location.createUrlBuilder().setParameter(queryParam,localeName);
        Window.Location.replace(builder.buildString());
      }
 else {
        Window.Location.reload();
      }
    }
  }
);
}
