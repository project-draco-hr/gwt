{
  String result;
  if (outprop == null) {
    throw new BuildException("<svninfo> task requires an outputproperty attribute");
  }
  if (workdir == null) {
    workdir=getProject().getProperty("basedir");
  }
  File workDirFile=new File(workdir);
  if (!workDirFile.isDirectory()) {
    throw new BuildException(workdir + " is not a directory");
  }
  String branch;
  String revision;
  File svnDirFile=new File(workdir,".svn");
  if (!svnDirFile.exists()) {
    branch="unknown";
    revision="unknown";
  }
 else {
    branch=getSvnBranch(workDirFile);
    revision=getSvnVersion(workDirFile);
  }
  getProject().setNewProperty(outprop,branch + "@" + revision);
  if (fileprop != null) {
    getProject().setNewProperty(fileprop,branch + "-" + revision.replaceAll(":","-"));
  }
}
