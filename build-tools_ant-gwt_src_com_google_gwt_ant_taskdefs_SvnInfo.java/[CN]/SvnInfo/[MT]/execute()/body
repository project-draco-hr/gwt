{
  if (outprop == null) {
    throw new BuildException("<svninfo> task requires an outputproperty attribute");
  }
  if (workdir == null) {
    workdir=getProject().getProperty("basedir");
  }
  File workDirFile=new File(workdir);
  if (!workDirFile.isDirectory()) {
    throw new BuildException(workdir + " is not a directory");
  }
  Info info;
  if (looksLikeSvn(workDirFile)) {
    info=parseInfo(getSvnInfo(workDirFile));
    info.revision=getSvnVersion(workDirFile);
  }
 else   if (looksLikeGit(workDirFile)) {
    info=parseInfo(getGitSvnInfo(workDirFile));
    if (!doesGitWorkingCopyMatchSvnRevision(workDirFile,info.revision)) {
      info.revision+="M";
    }
  }
 else {
    info=new Info("unknown","unknown");
  }
  getProject().setNewProperty(outprop,info.branch + "@" + info.revision);
  if (fileprop != null) {
    getProject().setNewProperty(fileprop,info.branch.replace('/','-') + "-" + info.revision.replace(':','-'));
  }
}
