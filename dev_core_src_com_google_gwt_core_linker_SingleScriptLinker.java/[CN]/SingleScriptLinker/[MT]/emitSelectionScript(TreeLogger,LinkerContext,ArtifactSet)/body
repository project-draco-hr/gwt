{
  DefaultTextOutput out=new DefaultTextOutput(true);
  String bootstrap=generateSelectionScript(logger,context,artifacts);
  bootstrap=context.optimizeJavaScript(logger,bootstrap);
  out.print(bootstrap);
  out.newlineOpt();
  out.print("(function () {");
  out.newlineOpt();
  out.print("var $gwt_version = \"" + About.getGwtVersionNum() + "\";");
  out.newlineOpt();
  out.print("var $wnd = window;");
  out.newlineOpt();
  out.print("var $doc = $wnd.document;");
  out.newlineOpt();
  out.print("var $moduleName, $moduleBase;");
  out.newlineOpt();
  out.print("var $stats = $wnd.__gwtStatsEvent ? function(a) {$wnd.__gwtStatsEvent(a)} : null;");
  out.newlineOpt();
  Set<CompilationResult> results=artifacts.find(CompilationResult.class);
  if (results.size() != 1) {
    logger.log(TreeLogger.ERROR,"The module must have exactly one distinct" + " permutation when using the " + getDescription() + " Linker.",null);
    throw new UnableToCompleteException();
  }
  CompilationResult result=results.iterator().next();
  out.print("var $strongName = '" + result.getStrongName() + "';");
  out.newlineOpt();
  String[] js=result.getJavaScript();
  if (js.length != 1) {
    logger.log(TreeLogger.ERROR,"The module must not have multiple fragments when using the " + getDescription() + " Linker.",null);
    throw new UnableToCompleteException();
  }
  out.print(js[0]);
  out.newlineOpt();
  out.print("if (" + context.getModuleFunctionName() + ") "+ context.getModuleFunctionName()+ ".onScriptLoad(gwtOnLoad);");
  out.newlineOpt();
  out.print("})();");
  out.newlineOpt();
  return emitString(logger,out.toString(),context.getModuleName() + ".nocache.js");
}
