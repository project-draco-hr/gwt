def _match_impl(self, state, pos):
    'Tries to match all the sub rules'
    sequence = []
    for rule in self._sub_rules:
        (nextPos, ast) = rule.match(state, pos)
        if (nextPos is not None):
            if ast:
                if isinstance(ast, _list_type):
                    sequence.extend(ast)
                else:
                    sequence.append(ast)
            pos = nextPos
        else:
            return (None, None)
    return (pos, sequence)
