{
  String ticker=transaction.getTicker();
  if (ticker == null || ticker.length() < 0) {
    throw new IllegalArgumentException("Stock could not be found");
  }
  Result result=queryExactTicker(ticker);
  if (result.numRows != 1 || result.quotes.size() != 1) {
    throw new IllegalArgumentException("Could not resolve stock ticker");
  }
  StockQuote quote=result.quotes.get(0);
  int quantity=transaction.getQuantity();
  int price=quote.getPrice();
  PlayerStatus player=ensurePlayer();
  if (transaction.isBuy()) {
    player.buy(ticker,quantity,price);
    player.addStatus(player.getDisplayName() + " bought " + quantity+ " share"+ ((quantity == 1) ? "" : "s")+ " of "+ ticker);
  }
 else {
    player.sell(ticker,quantity,price);
    player.addStatus(player.getDisplayName() + " sold " + quantity+ " share"+ ((quantity == 1) ? "" : "s")+ " of "+ ticker);
  }
  return new Transaction(transaction.isBuy(),ticker,quantity,price);
}
