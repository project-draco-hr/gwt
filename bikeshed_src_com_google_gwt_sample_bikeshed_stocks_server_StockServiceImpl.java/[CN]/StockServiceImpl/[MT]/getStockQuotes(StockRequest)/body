{
  String query=request.getSearchQuery();
  if (query == null || query.length() == 0) {
    query=".*";
  }
  Range searchRange=request.getSearchRange();
  Range favoritesRange=request.getFavoritesRange();
  Range sectorRange=request.getSectorRange();
  PlayerStatus player=ensurePlayer();
  Result searchResults=getSearchQuotes(query,searchRange);
  Result favorites=queryFavorites(favoritesRange);
  String sectorName=request.getSector();
  Result sector=sectorRange != null ? getSectorQuotes(sectorName,sectorRange) : null;
  return createStockResponse(player,request.getSearchQuery(),searchResults,favorites,sectorName,sector);
}
