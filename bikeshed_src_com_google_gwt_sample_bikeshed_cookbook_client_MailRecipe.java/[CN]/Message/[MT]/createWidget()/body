{
  ListDataProvider<Message> dataProvider=new ListDataProvider<Message>();
  messages=dataProvider.getList();
  addMessages(10);
  table=new CellTable<Message>(10);
  table.setSelectionModel(selectionModel);
  dataProvider.addDataDisplay(table);
  SelectionColumn<Message> selectedColumn=new SelectionColumn<Message>(selectionModel);
  Header<Boolean> selectedHeader=new Header<Boolean>(new CheckboxCell(true)){
    @Override public Boolean getValue(){
      return selectionModel.getType().equals("ALL");
    }
  }
;
  selectedHeader.setUpdater(new ValueUpdater<Boolean>(){
    public void update(    Boolean value){
      if (value == true) {
        selectionModel.setType("ALL");
      }
 else       if (value == false) {
        selectionModel.setType("NONE");
      }
    }
  }
);
  table.addColumn(selectedColumn,selectedHeader);
  addColumn(table,"ID",new TextCell(),new GetValue<Message,String>(){
    public String getValue(    Message object){
      return "" + object.id;
    }
  }
,idComparator);
  addColumn(table,"Read",new GetValue<Message,String>(){
    public String getValue(    Message object){
      return object.isRead ? "read" : "unread";
    }
  }
);
  Column<Message,Date> dateColumn=addColumn(table,"Date",new DatePickerCell(),new GetValue<Message,Date>(){
    public Date getValue(    Message object){
      return object.date;
    }
  }
,dateComparator);
  dateColumn.setFieldUpdater(new FieldUpdater<Message,Date>(){
    public void update(    int index,    Message object,    Date value){
      Window.alert("Changed date from " + object.date + " to "+ value);
      object.date=value;
      table.redraw();
    }
  }
);
  addColumn(table,"Sender",new GetValue<Message,String>(){
    public String getValue(    Message object){
      return object.getSender();
    }
  }
);
  addColumn(table,"Subject",new GetValue<Message,String>(){
    public String getValue(    Message object){
      return object.getSubject();
    }
  }
);
  Column<Message,String> toggleColumn=new Column<Message,String>(new ButtonCell()){
    @Override public String getValue(    Message object){
      return object.isRead ? "Mark Unread" : "Mark Read";
    }
  }
;
  toggleColumn.setFieldUpdater(new FieldUpdater<Message,String>(){
    public void update(    int index,    Message object,    String value){
      object.isRead=!object.isRead;
      messages.set(index,object);
    }
  }
);
  table.addColumn(toggleColumn,"Toggle Read/Unread");
  ScrollbarPager pager=new ScrollbarPager();
  pager.setView(table);
  Label searchLabel=new Label("Search Sender or Subject:");
  final TextBox searchBox=new TextBox();
  searchBox.addKeyUpHandler(new KeyUpHandler(){
    public void onKeyUp(    KeyUpEvent event){
      selectionModel.setSearch(searchBox.getText());
    }
  }
);
  HorizontalPanel panel=new HorizontalPanel();
  panel.add(searchLabel);
  panel.add(searchBox);
  FlowPanel p=new FlowPanel();
  p.add(panel);
  p.add(makeButton("Search Subject","SUBJECT"));
  p.add(makeButton("Search Senders","SENDER"));
  p.add(new HTML("<br>"));
  HorizontalPanel hp=new HorizontalPanel();
  hp.add(pager);
  hp.add(table);
  p.add(hp);
  p.add(new HTML("<hr>"));
  p.add(makeButton("Select None","NONE"));
  p.add(makeButton("Select All On This Page","PAGE"));
  p.add(makeButton("Select All","ALL"));
  p.add(makeButton("Select Read","READ"));
  p.add(makeButton("Select Unread","UNREAD"));
  p.add(selectionLabel);
  p.add(new HTML("<hr>"));
  p.add(makeButton("Add 5 messages","ADD5"));
  p.add(makeButton("Remove 5 messages","REM5"));
  p.add(messageIdsLabel);
  return p;
}
