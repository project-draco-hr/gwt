{
  if (domainValue == null) {
    return null;
  }
  Class<?> returnClass=service.getClientType(domainValue.getClass());
  if (ValueCodex.canDecode(returnClass)) {
    return domainValue;
  }
  if (EntityProxy.class.isAssignableFrom(returnClass)) {
    return resolveClientEntityProxy(source,domainValue,propertyRefs,prefix);
  }
  if (Collection.class.isAssignableFrom(returnClass)) {
    Collection<Object> accumulator;
    if (List.class.isAssignableFrom(returnClass)) {
      accumulator=new ArrayList<Object>();
    }
 else     if (Set.class.isAssignableFrom(returnClass)) {
      accumulator=new HashSet<Object>();
    }
 else {
      throw new ReportableException("Unsupported collection type" + returnClass.getName());
    }
    for (    Object o : (Collection<?>)domainValue) {
      accumulator.add(resolveClientValue(source,o,propertyRefs,prefix));
    }
    return accumulator;
  }
  throw new ReportableException("Unsupported domain type " + returnClass.getCanonicalName());
}
