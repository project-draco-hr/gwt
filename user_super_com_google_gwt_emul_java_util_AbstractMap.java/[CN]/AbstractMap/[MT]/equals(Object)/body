{
  if (obj == this) {
    return true;
  }
  if (!(obj instanceof Map)) {
    return false;
  }
  Map<?,?> otherMap=(Map<?,?>)obj;
  Set<K> keys=keySet();
  Set<?> otherKeys=otherMap.keySet();
  if (!keys.equals(otherKeys)) {
    return false;
  }
  for (Iterator<K> iter=keys.iterator(); iter.hasNext(); ) {
    K key=iter.next();
    V value=get(key);
    Object otherValue=otherMap.get(key);
    if (value == null ? otherValue != null : !value.equals(otherValue)) {
      return false;
    }
  }
  return true;
}
