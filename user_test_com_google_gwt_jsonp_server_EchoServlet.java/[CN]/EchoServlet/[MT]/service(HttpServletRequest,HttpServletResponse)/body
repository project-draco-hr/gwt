{
  res.setContentType("application/javascript");
switch (Action.valueOf(req.getParameter("action"))) {
case SUCCESS:
{
      handleDelay(req);
      String callback=req.getParameter("callback");
      String value=req.getParameter("value");
      if (value == null) {
        value="";
      }
      res.getWriter().println(callback + "(" + value+ ");");
      res.getWriter().flush();
      break;
    }
case FAILURE:
{
    handleDelay(req);
    String failureCallback=req.getParameter("failureCallback");
    String error=req.getParameter("error");
    if (failureCallback != null) {
      res.getWriter().println(failureCallback + "('" + error+ "');");
      res.getWriter().flush();
    }
 else {
      String callback=req.getParameter("callback");
      res.getWriter().println(callback + "('" + error+ "');");
      res.getWriter().flush();
    }
    break;
  }
case TIMEOUT:
}
}
