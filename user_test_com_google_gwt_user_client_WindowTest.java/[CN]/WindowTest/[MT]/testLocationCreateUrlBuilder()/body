{
  History.newItem("theHash");
  String expected=Location.getHref();
  UrlBuilder builder=Location.createUrlBuilder();
  String actual=builder.buildString();
{
    String[] expectedParts=expected.split("#");
    String[] actualParts=actual.split("#");
    assertEquals(2,actualParts.length);
    assertEquals(expectedParts[1],actualParts[1]);
    expected=expectedParts[0];
    actual=actualParts[0];
  }
{
    String[] expectedParts=expected.split("[?]");
    String[] actualParts=actual.split("[?]");
    if (expectedParts.length > 1) {
      assertEquals(2,actualParts.length);
      String[] expectedPairs=expectedParts[1].split("&");
      String[] actualPairs=actualParts[1].split("&");
      assertEquals(expectedPairs.length,actualPairs.length);
      for (      String actualPair : actualPairs) {
        String[] kv=actualPair.split("=");
        assertEquals(Location.getParameter(kv[0]),kv.length > 1 ? URL.decodeQueryString(kv[1]) : "");
      }
    }
    expected=expectedParts[0];
    actual=actualParts[0];
  }
  assertEquals(expected,actual);
}
