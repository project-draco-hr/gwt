{
  if ((chord & 0x01) != 0)   event.stateMask|=SWT.BUTTON1;
  if ((chord & 0x02) != 0)   event.stateMask|=SWT.BUTTON3;
  if ((chord & 0x04) != 0)   event.stateMask|=SWT.BUTTON2;
  if ((chord & 0x08) != 0)   event.stateMask|=SWT.BUTTON4;
  if ((chord & 0x10) != 0)   event.stateMask|=SWT.BUTTON5;
  if ((modifiers & OS.optionKey) != 0)   event.stateMask|=SWT.ALT;
  if ((modifiers & OS.shiftKey) != 0)   event.stateMask|=SWT.SHIFT;
  if ((modifiers & OS.controlKey) != 0)   event.stateMask|=SWT.CONTROL;
  if ((modifiers & OS.cmdKey) != 0)   event.stateMask|=SWT.COMMAND;
switch (type) {
case SWT.MouseDown:
case SWT.MouseDoubleClick:
    if (event.button == 1)     event.stateMask&=~SWT.BUTTON1;
  if (event.button == 2)   event.stateMask&=~SWT.BUTTON2;
if (event.button == 3) event.stateMask&=~SWT.BUTTON3;
if (event.button == 4) event.stateMask&=~SWT.BUTTON4;
if (event.button == 5) event.stateMask&=~SWT.BUTTON5;
break;
case SWT.MouseUp:
if (event.button == 1) event.stateMask|=SWT.BUTTON1;
if (event.button == 2) event.stateMask|=SWT.BUTTON2;
if (event.button == 3) event.stateMask|=SWT.BUTTON3;
if (event.button == 4) event.stateMask|=SWT.BUTTON4;
if (event.button == 5) event.stateMask|=SWT.BUTTON5;
break;
case SWT.KeyDown:
case SWT.Traverse:
{
if (event.keyCode != 0 || event.character != 0) return true;
int lastModifiers=display.lastModifiers;
if ((modifiers & OS.alphaLock) != 0 && (lastModifiers & OS.alphaLock) == 0) {
event.keyCode=SWT.CAPS_LOCK;
return true;
}
if ((modifiers & OS.shiftKey) != 0 && (lastModifiers & OS.shiftKey) == 0) {
event.stateMask&=~SWT.SHIFT;
event.keyCode=SWT.SHIFT;
return true;
}
if ((modifiers & OS.controlKey) != 0 && (lastModifiers & OS.controlKey) == 0) {
event.stateMask&=~SWT.CONTROL;
event.keyCode=SWT.CONTROL;
return true;
}
if ((modifiers & OS.cmdKey) != 0 && (lastModifiers & OS.cmdKey) == 0) {
event.stateMask&=~SWT.COMMAND;
event.keyCode=SWT.COMMAND;
return true;
}
if ((modifiers & OS.optionKey) != 0 && (lastModifiers & OS.optionKey) == 0) {
event.stateMask&=~SWT.ALT;
event.keyCode=SWT.ALT;
return true;
}
break;
}
case SWT.KeyUp:
{
if (event.keyCode != 0 || event.character != 0) return true;
int lastModifiers=display.lastModifiers;
if ((modifiers & OS.alphaLock) == 0 && (lastModifiers & OS.alphaLock) != 0) {
event.keyCode=SWT.CAPS_LOCK;
return true;
}
if ((modifiers & OS.shiftKey) == 0 && (lastModifiers & OS.shiftKey) != 0) {
event.stateMask|=SWT.SHIFT;
event.keyCode=SWT.SHIFT;
return true;
}
if ((modifiers & OS.controlKey) == 0 && (lastModifiers & OS.controlKey) != 0) {
event.stateMask|=SWT.CONTROL;
event.keyCode=SWT.CONTROL;
return true;
}
if ((modifiers & OS.cmdKey) == 0 && (lastModifiers & OS.cmdKey) != 0) {
event.stateMask|=SWT.COMMAND;
event.keyCode=SWT.COMMAND;
return true;
}
if ((modifiers & OS.optionKey) == 0 && (lastModifiers & OS.optionKey) != 0) {
event.stateMask|=SWT.ALT;
event.keyCode=SWT.ALT;
return true;
}
break;
}
}
return true;
}
