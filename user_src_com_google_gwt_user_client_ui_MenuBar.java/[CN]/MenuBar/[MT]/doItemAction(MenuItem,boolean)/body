{
  if ((shownChildMenu != null) && (item.getSubMenu() == shownChildMenu)) {
    return;
  }
  if (shownChildMenu != null) {
    shownChildMenu.onHide();
    popup.hide();
  }
  if (item.getSubMenu() == null) {
    if (fireCommand) {
      closeAllParents();
      Command cmd=item.getCommand();
      if (cmd != null) {
        DeferredCommand.addCommand(cmd);
      }
    }
    return;
  }
  selectItem(item);
  popup=new PopupPanel(true){
{
      setWidget(item.getSubMenu());
      item.getSubMenu().onShow();
    }
    @Override public boolean onEventPreview(    Event event){
switch (DOM.eventGetType(event)) {
case Event.ONCLICK:
        Element target=DOM.eventGetTarget(event);
      Element parentMenuElement=item.getParentMenu().getElement();
    if (DOM.isOrHasChild(parentMenuElement,target)) {
      return false;
    }
  break;
}
return super.onEventPreview(event);
}
}
;
popup.addPopupListener(this);
if (vertical) {
popup.setPopupPosition(this.getAbsoluteLeft() + this.getOffsetWidth() - 1,item.getAbsoluteTop());
}
 else {
popup.setPopupPosition(item.getAbsoluteLeft(),this.getAbsoluteTop() + this.getOffsetHeight() - 1);
}
shownChildMenu=item.getSubMenu();
item.getSubMenu().parentMenu=this;
popup.show();
}
