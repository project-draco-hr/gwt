{
  Set<String> validBinaryTypeNames=new HashSet<String>();
  for (  CompilationUnit unit : units) {
    Set<CompiledClass> compiledClasses=unit.getCompiledClasses();
    if (compiledClasses != null) {
      for (      CompiledClass compiledClass : compiledClasses) {
        validBinaryTypeNames.add(compiledClass.getBinaryName());
      }
    }
  }
  JdtCompiler.compile(units);
  CompilationUnitInvalidator.validateCompilationUnits(units,validBinaryTypeNames);
  if (CompilationUnitInvalidator.invalidateUnitsWithErrors(logger,units)) {
    CompilationUnitInvalidator.invalidateUnitsWithInvalidRefs(logger,units);
  }
  TypeOracleMediator mediator=new TypeOracleMediator();
  mediator.refresh(logger,units);
  return mediator.getTypeOracle();
}
