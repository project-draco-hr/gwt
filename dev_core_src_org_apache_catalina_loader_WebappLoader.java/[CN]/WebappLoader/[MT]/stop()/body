{
  if (!started)   throw new LifecycleException(sm.getString("webappLoader.notStarted"));
  if (log.isDebugEnabled())   log.debug(sm.getString("webappLoader.stopping"));
  lifecycle.fireLifecycleEvent(STOP_EVENT,null);
  started=false;
  if (container instanceof Context) {
    ServletContext servletContext=((Context)container).getServletContext();
    servletContext.removeAttribute(Globals.CLASS_PATH_ATTR);
  }
  if (classLoader instanceof Lifecycle)   ((Lifecycle)classLoader).stop();
  DirContextURLStreamHandler.unbind((ClassLoader)classLoader);
  try {
    StandardContext ctx=(StandardContext)container;
    Engine eng=(Engine)ctx.getParent().getParent();
    String path=ctx.getPath();
    if (path.equals("")) {
      path="/";
    }
    ObjectName cloname=new ObjectName(ctx.getEngineName() + ":type=WebappClassLoader,path=" + path+ ",host="+ ctx.getParent().getName());
    Registry.getRegistry(null,null).unregisterComponent(cloname);
  }
 catch (  Throwable t) {
    log.error("LifecycleException ",t);
  }
  classLoader=null;
  destroy();
}
