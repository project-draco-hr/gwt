{
  Event moduleDefLoadFromClassPathEvent=SpeedTracerLogger.start(CompilerEventType.MODULE_DEF,"phase","loadFromClassPath","moduleName",moduleName);
  try {
    String physicalName=moduleEffectiveNameToPhysicalName.get(moduleName);
    if (physicalName != null) {
      moduleName=physicalName;
    }
    ModuleDef moduleDef=tryGetLoadedModule(moduleName,refresh);
    if (moduleDef != null) {
      return moduleDef;
    }
    ModuleDefLoader loader=new ModuleDefLoader(compilerContext,resources);
    ModuleDef module=ModuleDefLoader.doLoadModule(loader,logger,moduleName,resources,compilerContext.shouldCompileMonolithic());
    LibraryWriter libraryWriter=compilerContext.getLibraryWriter();
    libraryWriter.setLibraryName(module.getName());
    libraryWriter.addDependencyLibraryNames(module.getExternalLibraryModuleNames());
    for (    BindingProperty bindingProperty : module.getProperties().getBindingProperties()) {
      libraryWriter.addNewBindingPropertyValuesByName(bindingProperty.getName(),bindingProperty.getTargetLibraryDefinedValues());
    }
    for (    ConfigurationProperty configurationProperty : module.getProperties().getConfigurationProperties()) {
      libraryWriter.addNewConfigurationPropertyValuesByName(configurationProperty.getName(),configurationProperty.getTargetLibraryValues());
    }
    for (    Resource buildResource : module.getBuildResourceOracle().getResources()) {
      if (buildResource.getPath().endsWith(".java") || buildResource.getPath().endsWith(".gwt.xml")) {
        continue;
      }
      libraryWriter.addBuildResource(buildResource);
    }
    for (    Resource publicResource : module.getPublicResourceOracle().getResources()) {
      libraryWriter.addPublicResource(publicResource);
    }
    return module;
  }
  finally {
    moduleDefLoadFromClassPathEvent.end();
  }
}
