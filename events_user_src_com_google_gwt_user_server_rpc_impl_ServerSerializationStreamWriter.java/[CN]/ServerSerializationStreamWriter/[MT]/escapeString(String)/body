{
  char[] input=toEscape.toCharArray();
  CharVector charVector=new CharVector(input.length * 2 + 2,input.length);
  charVector.add(JS_QUOTE_CHAR);
  for (int i=0, n=input.length; i < n; ++i) {
    char c=input[i];
    if (c < NUMBER_OF_JS_ESCAPED_CHARS && JS_CHARS_ESCAPED[c] != 0) {
      charVector.add(JS_ESCAPE_CHAR);
      charVector.add(JS_CHARS_ESCAPED[c]);
    }
 else     if (needsUnicodeEscape(c)) {
      charVector.add(JS_ESCAPE_CHAR);
      unicodeEscape(c,charVector);
    }
 else {
      charVector.add(c);
    }
  }
  charVector.add(JS_QUOTE_CHAR);
  return String.valueOf(charVector.asArray(),0,charVector.getSize());
}
