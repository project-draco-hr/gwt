{
  ensureChildContainer().setInnerHTML(tree.getLoadingHtml());
  ensureAnimationFrame().getStyle().setProperty("display","");
  ListModel<C> listModel=nodeInfo.getListModel();
  listReg=listModel.addListHandler(new ListHandler<C>(){
    public void onDataChanged(    ListEvent<C> event){
      Map<Object,TreeNodeView<?>> map=new HashMap<Object,TreeNodeView<?>>();
      if (children != null) {
        for (        TreeNodeView<?> child : children) {
          if (child.getState()) {
            Object key=child.getValueKey();
            map.put(key,child);
          }
        }
      }
      ensureAnimationFrame().getStyle().setDisplay(Display.NONE);
      TreeViewModel model=tree.getTreeViewModel();
      int imageWidth=tree.getImageWidth();
      Cell<C> theCell=nodeInfo.getCell();
      StringBuilder sb=new StringBuilder();
      for (      C childValue : event.getValues()) {
        TreeNodeView<?> savedView=map.get(nodeInfo.getKey(childValue));
        if (savedView != null) {
          savedView.getElement().removeFromParent();
        }
        sb.append("<div style=\"position:relative;padding-left:");
        sb.append(imageWidth);
        sb.append("px;\">");
        if (savedView != null) {
          sb.append(tree.getOpenImageHtml());
        }
 else         if (model.isLeaf(childValue)) {
          sb.append(LEAF_IMAGE);
        }
 else {
          sb.append(tree.getClosedImageHtml());
        }
        sb.append("<div>");
        theCell.render(childValue,sb);
        sb.append("</div>");
        sb.append("</div>");
      }
      childContainer.setInnerHTML(sb.toString());
      children=new ArrayList<TreeNodeView<?>>();
      Element childElem=childContainer.getFirstChildElement();
      for (      C childValue : event.getValues()) {
        TreeNodeView<C> child=new TreeNodeView<C>(tree,TreeNodeView.this,nodeInfo,childElem,childValue);
        TreeNodeView<?> savedChild=map.get(nodeInfo.getKey(childValue));
        if (savedChild != null) {
          child.children=savedChild.children;
          child.childContainer=savedChild.childContainer;
          child.listReg=savedChild.listReg;
          child.nodeInfo=savedChild.nodeInfo;
          child.nodeInfoLoaded=savedChild.nodeInfoLoaded;
          child.open=savedChild.open;
          child.getElement().appendChild(savedChild.childContainer.getParentElement());
        }
        children.add(child);
        childElem=childElem.getNextSiblingElement();
      }
      tree.maybeAnimateTreeNode(TreeNodeView.this);
    }
    public void onSizeChanged(    SizeChangeEvent event){
    }
  }
);
  listReg.setRangeOfInterest(0,100);
}
