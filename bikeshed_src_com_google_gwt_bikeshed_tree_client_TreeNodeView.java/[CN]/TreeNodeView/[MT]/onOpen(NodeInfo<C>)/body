{
  ensureChildContainer().setInnerHTML(tree.getLoadingHtml());
  ensureAnimationFrame().getStyle().setProperty("display","");
  ListModel<C> listModel=nodeInfo.getListModel();
  listReg=listModel.addListHandler(new ListHandler<C>(){
    public void onDataChanged(    ListEvent<C> event){
      Map<Object,TreeNodeView<?>> map=new HashMap<Object,TreeNodeView<?>>();
      if (children != null) {
        for (        TreeNodeView<?> child : children) {
          if (child.getState()) {
            Object key=child.getValueKey();
            map.put(key,child);
          }
        }
      }
      if (tree.isAnimationEnabled()) {
        ensureAnimationFrame().getStyle().setDisplay(Display.NONE);
      }
      List<TreeNodeView<?>> savedViews=new ArrayList<TreeNodeView<?>>();
      for (      C childValue : event.getValues()) {
        TreeNodeView<?> savedView=map.get(nodeInfo.getKey(childValue));
        if (savedView != null) {
          savedView.getElement().removeFromParent();
        }
        savedViews.add(savedView);
      }
      StringBuilder sb=new StringBuilder();
      emitHtml(sb,nodeInfo,event.getValues(),savedViews);
      childContainer.setInnerHTML(sb.toString());
      children=new ArrayList<TreeNodeView<?>>();
      Element childElem=childContainer.getFirstChildElement();
      int idx=0;
      for (      C childValue : event.getValues()) {
        TreeNodeView<C> child=createTreeNodeView(nodeInfo,childElem,childValue,idx);
        TreeNodeView<?> savedChild=map.get(nodeInfo.getKey(childValue));
        if (savedChild != null) {
          child.children=savedChild.children;
          child.childContainer=savedChild.childContainer;
          child.listReg=savedChild.listReg;
          child.nodeInfo=savedChild.nodeInfo;
          child.nodeInfoLoaded=savedChild.nodeInfoLoaded;
          child.open=savedChild.getState();
          child.getElement().appendChild(savedChild.childContainer.getParentElement());
        }
        children.add(child);
        childElem=childElem.getNextSiblingElement();
        idx++;
      }
      if (tree.isAnimationEnabled()) {
        tree.maybeAnimateTreeNode(TreeNodeView.this);
      }
    }
    public void onSizeChanged(    SizeChangeEvent event){
    }
  }
);
  listReg.setRangeOfInterest(0,100);
}
