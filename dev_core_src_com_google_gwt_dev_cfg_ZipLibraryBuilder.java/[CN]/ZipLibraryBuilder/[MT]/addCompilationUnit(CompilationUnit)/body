{
  Preconditions.checkState(!compilationUnitsByTypeName.containsKey(compilationUnit.getTypeName()));
  if (compilationUnit.isSuperSource()) {
    superSourceCompilationUnitTypeNames.add(compilationUnit.getTypeName());
  }
 else {
    compilationUnitTypeNames.add(compilationUnit.getTypeName());
  }
  compilationUnitsByTypeName.put(compilationUnit.getTypeName(),compilationUnit);
  for (  CompiledClass compiledClass : compilationUnit.getCompiledClasses()) {
    if (compilationUnit.isSuperSource()) {
      String classFilePath=compiledClass.getInternalName();
      superSourceClassFilePaths.add(Libraries.computeClassFileName(classFilePath));
      zipLibraryWriter.writeClassFile(classFilePath,compiledClass.getBytes());
    }
 else {
      String classFilePath=compiledClass.getInternalName();
      classFilePaths.add(Libraries.computeClassFileName(classFilePath));
      zipLibraryWriter.writeClassFile(classFilePath,compiledClass.getBytes());
    }
  }
  zipLibraryWriter.writeCompilationUnitFile(compilationUnit);
}
