{
  if (codePointOffset < 0) {
    while (codePointOffset < 0) {
      --index;
      if (Character.isLowSurrogate(seq.charAt(index)) && Character.isHighSurrogate(seq.charAt(index - 1))) {
        --index;
      }
      ++codePointOffset;
    }
  }
 else {
    while (codePointOffset > 0) {
      if (Character.isHighSurrogate(seq.charAt(index)) && Character.isLowSurrogate(seq.charAt(index + 1))) {
        ++index;
      }
      ++index;
      --codePointOffset;
    }
  }
  return index;
}
