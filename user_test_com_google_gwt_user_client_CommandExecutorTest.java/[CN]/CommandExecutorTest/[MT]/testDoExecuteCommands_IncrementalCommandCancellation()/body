{
  final CommandExecutor ce=new NonRestartingCommandExecutor();
  final TestIncrementalCommand ic=new TestIncrementalCommand();
  ce.setExecuting(true);
  ce.submit(ic);
  ce.setLast(0);
  Exception capturedException=null;
  try {
    ce.doCommandCanceled();
    fail("exception should have thrown");
  }
 catch (  Exception e) {
    capturedException=e;
  }
  assertSame(ic,((IncrementalCommandCanceledException)capturedException).getCommand());
  ce.doExecuteCommands(Duration.currentTimeMillis());
  assertEquals(0,ic.getExecuteCount());
  delayTestFinish(TEST_FINISH_DELAY_MILLIS);
  ce.submit(createFinishTestCommand());
  ce.doExecuteCommands(Duration.currentTimeMillis());
}
