{
  final CommandExecutor ce=new NonRestartingCommandExecutor();
  final Command c1=new Command(){
    public void execute(){
    }
  }
;
  ce.setExecuting(true);
  ce.submit(c1);
  ce.setLast(0);
  final UncaughtExceptionHandler originalUEH=GWT.getUncaughtExceptionHandler();
  UncaughtExceptionHandler ueh1=new UncaughtExceptionHandler(){
    public void onUncaughtException(    Throwable e){
      if (!(e instanceof CommandCanceledException)) {
        originalUEH.onUncaughtException(e);
        return;
      }
      CommandCanceledException cce=(CommandCanceledException)e;
      if (cce.getCommand() != c1) {
        fail("CommandCanceledException did not contain the correct failed command");
      }
      ce.submit(new IncrementalCommand(){
        public boolean execute(){
          return false;
        }
      }
);
      delayTestFinish(TEST_FINISH_DELAY_MILLIS);
      ce.submit(new Command(){
        public void execute(){
          finishTest();
        }
      }
);
      ce.doExecuteCommands(Duration.currentTimeMillis());
    }
  }
;
  GWT.setUncaughtExceptionHandler(ueh1);
  ce.doCommandCanceled();
}
