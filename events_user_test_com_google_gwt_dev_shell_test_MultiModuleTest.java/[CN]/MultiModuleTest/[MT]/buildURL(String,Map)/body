{
  int pos=url.indexOf("?");
  if (pos >= 0) {
    url=url.substring(0,pos);
  }
  boolean firstParam=true;
  if (params.containsKey("gwt.hybrid")) {
    url+="?gwt.hybrid";
    firstParam=false;
  }
  for (Iterator it=params.entrySet().iterator(); it.hasNext(); ) {
    Map.Entry entry=(Map.Entry)it.next();
    String param=(String)entry.getKey();
    if (param.equals("gwt.hybrid")) {
      continue;
    }
    if (firstParam) {
      url+="?";
      firstParam=false;
    }
 else {
      url+="&";
    }
    url+=param;
    String value=(String)entry.getValue();
    if (value != null) {
      url+="=" + value;
    }
  }
  return url;
}
