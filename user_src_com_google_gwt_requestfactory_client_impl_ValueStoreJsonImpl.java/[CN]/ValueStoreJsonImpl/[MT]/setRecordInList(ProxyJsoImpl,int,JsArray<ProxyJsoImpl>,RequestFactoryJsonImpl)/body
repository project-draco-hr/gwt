{
  EntityProxyId recordKey=new EntityProxyId(newJsoRecord,RequestFactoryJsonImpl.NOT_FUTURE);
  newJsoRecord.setValueStore(this);
  newJsoRecord.setRequestFactory(requestFactory);
  ProxyJsoImpl oldRecord=records.get(recordKey);
  if (oldRecord == null) {
    records.put(recordKey,newJsoRecord);
  }
 else {
    boolean changed=oldRecord.merge(newJsoRecord);
    newJsoRecord=oldRecord.cast();
    if (array != null) {
      array.set(i,newJsoRecord);
    }
    if (changed) {
      requestFactory.postChangeEvent(newJsoRecord,WriteOperation.UPDATE);
    }
  }
}
