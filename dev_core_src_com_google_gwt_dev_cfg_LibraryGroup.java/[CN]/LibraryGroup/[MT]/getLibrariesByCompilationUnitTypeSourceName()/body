{
  if (librariesByCompilationUnitTypeSourceName == null) {
    librariesByCompilationUnitTypeSourceName=Maps.newLinkedHashMap();
    for (    Library library : libraries) {
      for (      String compilationUnitTypeSourceName : library.getRegularCompilationUnitTypeSourceNames()) {
        assertUniquelyProvided(library,compilationUnitTypeSourceName);
        librariesByCompilationUnitTypeSourceName.put(compilationUnitTypeSourceName,library);
        Collection<String> nestedTypeSourceNames=library.getNestedSourceNamesByCompilationUnitName().get(compilationUnitTypeSourceName);
        for (        String nestedTypeSourceName : nestedTypeSourceNames) {
          librariesByCompilationUnitTypeSourceName.put(nestedTypeSourceName,library);
        }
      }
    }
    for (    Library library : libraries) {
      for (      String superSourceCompilationUnitTypeSourceName : library.getSuperSourceCompilationUnitTypeSourceNames()) {
        assertUniquelyProvided(library,superSourceCompilationUnitTypeSourceName);
        librariesByCompilationUnitTypeSourceName.put(superSourceCompilationUnitTypeSourceName,library);
        Collection<String> nestedTypeSourceNames=library.getNestedSourceNamesByCompilationUnitName().get(superSourceCompilationUnitTypeSourceName);
        for (        String nestedTypeSourceName : nestedTypeSourceNames) {
          librariesByCompilationUnitTypeSourceName.put(nestedTypeSourceName,library);
        }
      }
    }
  }
  return Collections.unmodifiableMap(librariesByCompilationUnitTypeSourceName);
}
