{
  try {
    perThreadRequest.set(request);
    perThreadResponse.set(response);
    String requestPayload=RPCServletUtils.readContentAsUtf8(request);
    onBeforeRequestDeserialized(requestPayload);
    String responsePayload=processCall(requestPayload);
    onAfterResponseSerialized(responsePayload);
    writeResponse(request,response,responsePayload);
    return;
  }
 catch (  Throwable e) {
    doUnexpectedFailure(e);
  }
 finally {
    perThreadRequest.set(null);
    perThreadResponse.set(null);
  }
}
