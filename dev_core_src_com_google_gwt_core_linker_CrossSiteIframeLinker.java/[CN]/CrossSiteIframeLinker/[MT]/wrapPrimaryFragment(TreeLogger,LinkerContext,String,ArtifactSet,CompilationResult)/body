{
  StringBuffer out=new StringBuffer();
  if (shouldIncludeBootstrapInPrimaryFragment(context)) {
    out.append(generateSelectionScript(logger,context,artifacts,result));
  }
  if (shouldInstallCode(context)) {
    out.append(context.getModuleFunctionName());
    out.append(".onScriptDownloaded([");
    String[] chunks=script.split(getScriptChunkSeparator(logger,context));
    boolean first=true;
    for (    String chunk : chunks) {
      if (!first) {
        out.append(", ");
      }
      out.append(JsToStringGenerationVisitor.javaScriptString(chunk));
      first=false;
    }
    out.append("])");
  }
 else {
    out.append(script);
  }
  return out.toString();
}
