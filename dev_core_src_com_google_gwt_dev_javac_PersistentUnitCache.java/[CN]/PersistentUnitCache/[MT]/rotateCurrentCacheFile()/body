{
  if (logger.isLoggable(TreeLogger.TRACE)) {
    logger.log(TreeLogger.TRACE,"Wrote " + unitsWritten + " units to persistent cache.");
  }
  closeCurrentCacheFile(currentCacheFile,currentCacheFileStream);
  unitsWritten=0;
  currentCacheFile=createCacheFile(logger,cacheDirectory);
  FileOutputStream fstream=null;
  BufferedOutputStream bstream=null;
  try {
    fstream=new FileOutputStream(currentCacheFile);
    bstream=new BufferedOutputStream(fstream);
    currentCacheFileStream=new ObjectOutputStream(bstream);
  }
 catch (  IOException ex) {
    Utility.close(bstream);
    Utility.close(fstream);
    closeCurrentCacheFile(currentCacheFile,currentCacheFileStream);
    logger.log(TreeLogger.ERROR,"Error rotating file.  Shutting down cache thread.",ex);
    throw new UnableToCompleteException();
  }
}
