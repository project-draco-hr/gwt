{
  boolean needBraces=!x.isGlobalBlock();
  if (needBraces) {
    _blockOpen();
  }
  int count=0;
  for (Iterator<JsStatement> iter=x.getStatements().iterator(); iter.hasNext(); ++count) {
    if (truncate && count > JSBLOCK_LINES_TO_PRINT) {
      p.print("[...]");
      _newlineOpt();
      break;
    }
    JsStatement stmt=iter.next();
    needSemi=true;
    accept(stmt);
    if (needSemi) {
      boolean functionStmt=stmt instanceof JsExprStmt && ((JsExprStmt)stmt).getExpression() instanceof JsFunction;
      boolean lastStatement=!iter.hasNext() && needBraces && !JsRequiresSemiVisitor.exec(stmt);
      if (functionStmt) {
        if (lastStatement) {
          _newlineOpt();
        }
 else {
          _newline();
        }
      }
 else {
        if (lastStatement) {
          _semiOpt();
        }
 else {
          _semi();
        }
        _newlineOpt();
      }
    }
  }
  if (needBraces) {
    _blockClose();
  }
  needSemi=false;
}
