{
  cancel();
  Element newContainer=getContainer(newWidget);
  int newIndex=DOM.getChildIndex(DOM.getParent(newContainer),newContainer);
  if (oldWidget == null) {
    UIObject.setVisible(newContainer,true);
    newWidget.setVisible(true);
    return;
  }
  this.oldWidget=oldWidget;
  Element oldContainer=getContainer(oldWidget);
  int oldIndex=DOM.getChildIndex(DOM.getParent(oldContainer),oldContainer);
  if (newIndex > oldIndex) {
    container1=oldContainer;
    container2=newContainer;
    growing=false;
  }
 else {
    container1=newContainer;
    container2=oldContainer;
    growing=true;
  }
  if (animate) {
    com.google.gwt.dom.client.Element deckElem=container1.getParentElement();
    int deckHeight=deckElem.getOffsetHeight();
    if (growing) {
      fixedHeight=container2.getOffsetHeight();
      container2.getStyle().setPropertyPx("height",Math.max(1,fixedHeight - 1));
    }
 else {
      fixedHeight=container1.getOffsetHeight();
      container1.getStyle().setPropertyPx("height",Math.max(1,fixedHeight - 1));
    }
    if (deckElem.getOffsetHeight() != deckHeight) {
      fixedHeight=-1;
    }
    run(ANIMATION_DURATION,fixedHeight == -1 ? null : deckElem);
  }
 else {
    onInstantaneousRun();
  }
  newWidget.setVisible(true);
}
