{
  ArrayList<Element> chain=new ArrayList<Element>();
  collectElementChain(chain,getElement(),hElem);
  TreeItem item=findItemByChain(chain,0,root);
  if (item != null) {
    if (DOM.isOrHasChild(item.getImageElement(),hElem)) {
      item.setState(!item.getState(),true);
      if (!item.getState()) {
        if (curSelection != null) {
          TreeItem tempItem=curSelection;
          while (tempItem != null) {
            if (tempItem == item) {
              setSelectedItem(item);
              break;
            }
            tempItem=tempItem.getParentItem();
          }
        }
      }
      return true;
    }
 else     if (DOM.isOrHasChild(item.getElement(),hElem)) {
      onSelection(item,true,!shouldTreeDelegateFocusToElement(hElem));
      return true;
    }
  }
  return false;
}
