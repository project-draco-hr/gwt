{
  PlayerStatus player=ensurePlayer();
  List<String> symbols=getTickers(query,queryPattern);
  if (symbols.size() == 0) {
    return new Result(new StockQuoteList(0),0);
  }
  int start=range.getStart();
  int end=Math.min(start + range.getLength(),symbols.size());
  Set<String> symbolsInRange=new HashSet<String>();
  if (end > start) {
    symbolsInRange.addAll(symbols.subList(start,end));
  }
  StringBuilder sb=new StringBuilder("http://www.google.com/finance/info?client=ig&q=");
  boolean first=true;
  for (  String symbol : symbolsInRange) {
    if (!first) {
      sb.append(',');
    }
    sb.append(symbol);
    first=false;
  }
  if (first) {
    return new Result(new StockQuoteList(0),0);
  }
  String content="";
  try {
    String urlString=sb.toString();
    URL url=new URL(urlString);
    InputStream urlInputStream=url.openStream();
    Scanner contentScanner=new Scanner(urlInputStream,"UTF-8");
    if (contentScanner.hasNextLine()) {
      content=contentScanner.useDelimiter("\\A").next();
    }
  }
 catch (  MalformedURLException mue) {
    System.err.println(mue);
  }
catch (  IOException ioe) {
    System.err.println(ioe);
  }
  Map<String,StockQuote> priceMap=new HashMap<String,StockQuote>();
  Matcher matcher=QUOTE_PATTERN.matcher(content);
  while (matcher.find()) {
    String group=matcher.group();
    String symbol=null;
    String price=null;
    Matcher dataMatcher=DATA_PATTERN.matcher(group);
    while (dataMatcher.find()) {
      String tag=dataMatcher.group(1);
      String data=dataMatcher.group(2);
      if (tag.equals("t")) {
        symbol=data;
      }
 else       if (tag.equals("l_cur")) {
        price=data;
      }
    }
    if (symbol != null && price != null) {
      int iprice=0;
      try {
        iprice=(int)(Double.parseDouble(price) * 100);
        String name=companyNamesBySymbol.get(symbol);
        Integer sharesOwned=player.getSharesOwned(symbol);
        boolean favorite=player.isFavorite(symbol);
        priceMap.put(symbol,new StockQuote(symbol,name,iprice,sharesOwned == null ? 0 : sharesOwned.intValue(),favorite));
      }
 catch (      NumberFormatException e) {
        System.out.println("Bad price " + price + " for symbol "+ symbol);
      }
    }
  }
  StockQuoteList toRet=new StockQuoteList(start);
  for (int i=start; i < end; i++) {
    String symbol=symbols.get(i);
    StockQuote quote=priceMap.get(symbol);
    if (quote == null) {
      System.out.println("Bad symbol " + symbol);
    }
 else {
      toRet.add(quote);
    }
  }
  return new Result(toRet,symbols.size());
}
