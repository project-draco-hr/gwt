{
  String ticker=transaction.getTicker();
  if (ticker == null || ticker.length() < 0) {
    throw new IllegalArgumentException("Stock could not be found");
  }
  String tickerRegex=ticker;
  if (!ticker.startsWith("^")) {
    tickerRegex="^" + tickerRegex;
  }
  if (!ticker.endsWith("$")) {
    tickerRegex=tickerRegex + "$";
  }
  Pattern tickerPattern=compile(ticker);
  Result result=query(tickerRegex,tickerPattern,new DefaultRange(0,1),false);
  if (result.numRows != 1 || result.quotes.size() != 1) {
    throw new IllegalArgumentException("Could not resolve stock ticker");
  }
  StockQuote quote=result.quotes.get(0);
  int quantity=transaction.getQuantity();
  int price=quote.getPrice();
  if (transaction.isBuy()) {
    ensurePlayer().buy(ticker,quantity,price);
  }
 else {
    ensurePlayer().sell(ticker,quantity,price);
  }
  return new Transaction(transaction.isBuy(),ticker,quantity,price);
}
