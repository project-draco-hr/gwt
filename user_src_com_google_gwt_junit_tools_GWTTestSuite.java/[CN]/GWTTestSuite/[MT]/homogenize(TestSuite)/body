{
  String suiteName=suite.getName();
  List<TestSuite> buckets=new ArrayList<TestSuite>();
  Map<TestSuite,TestSuite> moduleToBucket=new HashMap<TestSuite,TestSuite>();
  for (Enumeration<Test> enumeration=suite.tests(); enumeration.hasMoreElements(); ) {
    Test test=enumeration.nextElement();
    if (test instanceof TestSuite) {
      TestSuite[] subSuites=homogenize((TestSuite)test);
      for (      TestSuite subSuite : subSuites) {
        sortIntoBucket(subSuite,buckets,moduleToBucket,suiteName);
      }
    }
 else {
      sortIntoBucket(test,buckets,moduleToBucket,suiteName);
    }
  }
  int numBuckets=buckets.size();
  if (numBuckets == 1) {
    return new TestSuite[]{suite};
  }
 else {
    return buckets.toArray(new TestSuite[numBuckets]);
  }
}
