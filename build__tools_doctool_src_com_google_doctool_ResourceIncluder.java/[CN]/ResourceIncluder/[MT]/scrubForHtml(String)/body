{
  char[] chars=contents.toCharArray();
  int len=chars.length;
  StringBuffer sb=new StringBuffer(len);
  for (int i=0; i < len; ++i) {
    char c=chars[i];
switch (c) {
case '\r':
      if (i == len - 1 || chars[i + 1] != '\n') {
        sb.append('\n');
      }
    break;
case '&':
  sb.append("&amp;");
break;
case '<':
sb.append("&lt;");
break;
case '>':
sb.append("&gt;");
break;
default :
sb.append(c);
break;
}
}
return sb.toString();
}
