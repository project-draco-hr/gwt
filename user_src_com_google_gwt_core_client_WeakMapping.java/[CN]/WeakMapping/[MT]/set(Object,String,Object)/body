{
  cleanup();
  if (instance instanceof String) {
    throw new IllegalArgumentException("Cannot use Strings with WeakMapping");
  }
  IdentityWeakReference ref=new IdentityWeakReference(instance,queue);
  HashMap<String,Object> m=map.get(ref);
  if (m == null) {
    m=new HashMap<String,Object>();
    map.put(ref,m);
  }
  m.put(key,value);
}
