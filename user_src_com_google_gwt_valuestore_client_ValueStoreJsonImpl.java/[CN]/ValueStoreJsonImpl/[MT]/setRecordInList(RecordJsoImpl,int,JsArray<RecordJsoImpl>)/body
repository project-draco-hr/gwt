{
  RecordKey recordKey=new RecordKey(newRecord);
  RecordJsoImpl oldRecord=records.get(recordKey);
  if (oldRecord == null) {
    records.put(recordKey,newRecord);
  }
 else {
    boolean changed=oldRecord.merge(newRecord);
    newRecord=oldRecord.cast();
    if (array != null) {
      array.set(i,newRecord);
    }
    if (changed) {
      eventBus.fireEvent(newRecord.getSchema().createChangeEvent(newRecord,WriteOperation.UPDATE));
    }
  }
}
