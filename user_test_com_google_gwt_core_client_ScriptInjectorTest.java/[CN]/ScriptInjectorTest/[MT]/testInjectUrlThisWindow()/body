{
  this.delayTestFinish(TEST_DELAY);
  final String scriptUrl="script_injector_test4.js";
  assertFalse(nativeTest4Worked());
  final JavaScriptObject injectedElement=ScriptInjector.fromUrl(scriptUrl).inject();
  Scheduler.get().scheduleFixedDelay(new RepeatingCommand(){
    int numLoops=0;
    @Override public boolean execute(){
      numLoops++;
      boolean worked=nativeTest4Worked();
      if (!worked && (numLoops * CHECK_DELAY < TEST_DELAY)) {
        return true;
      }
      JavaScriptObject scriptElement=findScriptUrlInThisWindow(scriptUrl);
      if (!isIE()) {
        cleanupThisWindow("__ti4_var__",scriptElement);
        assertFalse("cleanup failed",nativeTest4Worked());
      }
      assertTrue("__ti4_var not set in this window",worked);
      assertNotNull("script element 4 not found",scriptElement);
      assertEquals(injectedElement,scriptElement);
      finishTest();
      return false;
    }
  }
,CHECK_DELAY);
  assertNotNull(injectedElement);
}
