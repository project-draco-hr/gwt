{
  WebClient webClient=new WebClient(browser);
  try {
    webClient.setAlertHandler(this);
    webClient.setIncorrectnessListener(this);
    webClient.setThrowExceptionOnFailingStatusCode(false);
    webClient.setThrowExceptionOnScriptError(true);
    webClient.setOnbeforeunloadHandler(this);
    setupWebClient(webClient);
    Page page=webClient.getPage(url);
    webClient.waitForBackgroundJavaScriptStartingBefore(2000);
    page.getEnclosingWindow().getJobManager().waitForJobs(60000);
    treeLogger.log(TreeLogger.DEBUG,"getPage returned " + ((HtmlPage)page).asXml());
  }
 catch (  FailingHttpStatusCodeException e) {
    treeLogger.log(TreeLogger.ERROR,"HTTP request failed",e);
  }
catch (  MalformedURLException e) {
    treeLogger.log(TreeLogger.ERROR,"Bad URL",e);
  }
catch (  IOException e) {
    treeLogger.log(TreeLogger.ERROR,"I/O error on HTTP request",e);
  }
 finally {
    webClient.closeAllWindows();
  }
}
