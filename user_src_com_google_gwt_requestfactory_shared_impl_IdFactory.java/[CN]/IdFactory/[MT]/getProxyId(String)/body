{
  if (IdUtil.isPersisted(historyToken)) {
    return getId(IdUtil.getTypeToken(historyToken),IdUtil.getServerId(historyToken));
  }
  if (IdUtil.isEphemeral(historyToken)) {
    @SuppressWarnings("unchecked") SimpleEntityProxyId<P> toReturn=(SimpleEntityProxyId<P>)ephemeralIds.get(historyToken);
    if (toReturn == null) {
      Class<P> clazz=checkTypeToken(IdUtil.getTypeToken(historyToken));
      toReturn=new SimpleEntityProxyId<P>(clazz,-1 * ephemeralIds.size());
      ephemeralIds.put(historyToken,toReturn);
    }
    return toReturn;
  }
  throw new IllegalArgumentException(historyToken);
}
