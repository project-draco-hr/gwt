{
  ModuleDef moduleDef=maybeCompileModuleImpl2(moduleName,syntheticModuleName,strategy,treeLogger);
  if (!compiledModuleNames.contains(syntheticModuleName)) {
    compiledModuleNames.add(syntheticModuleName);
    if (!batchingStrategy.isSingleTestOnly()) {
      boolean isFinalModule=compiledModuleNames.size() >= getModuleCount();
      List<TestInfo[]> testBlocks=batchingStrategy.getTestBlocks(syntheticModuleName);
      getMessageQueue().addTestBlocks(testBlocks,isFinalModule);
    }
  }
  return moduleDef;
}
