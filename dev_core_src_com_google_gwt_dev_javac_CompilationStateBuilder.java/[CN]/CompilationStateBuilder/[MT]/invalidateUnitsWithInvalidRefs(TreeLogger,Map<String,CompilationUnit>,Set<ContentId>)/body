{
  Set<CompilationUnit> validResultUnits=new HashSet<CompilationUnit>(resultUnits.values());
  CompilationUnitInvalidator.retainValidUnits(logger,validResultUnits,set);
  for (  Entry<String,CompilationUnit> entry : resultUnits.entrySet()) {
    CompilationUnit unit=entry.getValue();
    if (unit.isCompiled() && !validResultUnits.contains(unit)) {
      entry.setValue(new InvalidCompilationUnit(unit));
    }
  }
}
