{
  if (finished) {
    throw new IllegalStateException("finish() has already been called");
  }
  new BackRefAssigner().accept(command);
  if (command instanceof ValueCommand) {
    makeBackRef((ValueCommand)command);
  }
  visitor.accept(command);
}
