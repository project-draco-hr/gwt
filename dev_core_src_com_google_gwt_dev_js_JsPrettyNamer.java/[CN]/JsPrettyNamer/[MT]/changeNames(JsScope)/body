{
  Set<String> childIdents=new HashSet<String>();
  for (  JsScope child : scope.getChildren()) {
    childIdents.addAll(changeNames(child));
  }
  HashMap<String,Integer> suffixCounters=new HashMap<String,Integer>();
  for (  JsName name : scope.getAllNames()) {
    if (!referenced.contains(name)) {
      continue;
    }
    if (!name.isObfuscatable()) {
      name.setShortIdent(name.getIdent());
      continue;
    }
    String prefix=name.getShortIdent();
    if (!isLegal(scope,childIdents,prefix)) {
      Integer suffixOrNull=suffixCounters.get(prefix);
      int suffix=(suffixOrNull == null) ? 0 : suffixOrNull;
      String candidate;
      do {
        candidate=prefix + "_" + suffix++;
      }
 while (!isLegal(scope,childIdents,candidate));
      suffixCounters.put(prefix,suffix);
      name.setShortIdent(candidate);
    }
  }
  for (  JsName name : scope.getAllNames()) {
    childIdents.add(name.getShortIdent());
  }
  return childIdents;
}
