{
  if (pendingState == null) {
    pendingState=new PendingState<T>(state);
  }
  pendingStateCommand=new ScheduledCommand(){
    public void execute(){
      if (pendingStateCommand == this) {
        resolvePendingState();
      }
    }
  }
;
  scheduleFinally(pendingStateCommand);
  return pendingState;
}
