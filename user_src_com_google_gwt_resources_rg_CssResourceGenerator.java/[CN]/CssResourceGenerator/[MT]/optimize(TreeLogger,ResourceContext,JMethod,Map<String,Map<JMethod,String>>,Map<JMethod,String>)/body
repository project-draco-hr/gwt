{
  boolean strict=isStrict(logger,method);
  CssStylesheet sheet=stylesheetMap.get(method);
  (new Spriter(logger,context)).accept(sheet);
  SubstitutionCollector collector=new SubstitutionCollector();
  collector.accept(sheet);
  (new SubstitutionReplacer(logger,context,collector.getSubstitutions())).accept(sheet);
  (new IfEvaluator(logger,context.getGeneratorContext().getPropertyOracle())).accept(sheet);
  ExternalClassesCollector externalClasses=new ExternalClassesCollector();
  externalClasses.accept(sheet);
  ClassRenamer renamer=new ClassRenamer(logger,classReplacementsWithPrefix,strict,externalClasses.getClasses());
  renamer.accept(sheet);
  actualReplacements.putAll(renamer.getReplacements());
  if (enableMerge) {
    (new SplitRulesVisitor()).accept(sheet);
    (new MergeIdenticalSelectorsVisitor()).accept(sheet);
    (new MergeRulesByContentVisitor()).accept(sheet);
  }
}
