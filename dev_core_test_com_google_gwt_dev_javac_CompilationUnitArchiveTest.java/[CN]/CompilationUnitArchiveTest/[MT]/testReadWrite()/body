{
  CompilationUnitArchive archive1=new CompilationUnitArchive("com.example.Foo");
  MockCompilationUnit unit1=new MockCompilationUnit(MOCK_TYPE_1,"Foo");
  MockCompilationUnit unit2=new MockCompilationUnit(MOCK_TYPE_2,"Bar");
  MockCompilationUnit unit3=new MockCompilationUnit(MOCK_TYPE_3,"Baz");
  archive1.addUnit(unit1);
  archive1.addUnit(unit2);
  archive1.addUnit(unit3);
  assertEquals(3,archive1.getUnits().size());
  compareUnits(unit1,archive1,MOCK_TYPE_1);
  compareUnits(unit2,archive1,MOCK_TYPE_2);
  compareUnits(unit3,archive1,MOCK_TYPE_3);
  File tmp=File.createTempFile("cu-archive-test",".ser");
  tmp.deleteOnExit();
  archive1.writeToFile(tmp);
  CompilationUnitArchive archive2=CompilationUnitArchive.createFromFile(tmp);
  assertEquals(3,archive2.getUnits().size());
  compareUnits(unit1,archive2,MOCK_TYPE_1);
  compareUnits(unit2,archive2,MOCK_TYPE_2);
  compareUnits(unit3,archive2,MOCK_TYPE_3);
}
