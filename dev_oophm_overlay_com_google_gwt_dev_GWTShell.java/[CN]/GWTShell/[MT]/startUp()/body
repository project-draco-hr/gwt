{
  if (started) {
    throw new IllegalStateException("Startup code has already been run");
  }
  started=true;
  if (!headlessMode) {
    openAppWindow();
  }
  initializeLogger();
  startOophmListener();
  if (runTomcat) {
    final int serverPort=getPort();
    PerfLogger.start("GWTShell.startup (Tomcat launch)");
    String whyFailed=EmbeddedTomcatServer.start(headlessMode ? getTopLogger() : webServerLog.getLogger(),serverPort,options);
    PerfLogger.end();
    if (whyFailed != null) {
      System.err.println(whyFailed);
      return false;
    }
    port=EmbeddedTomcatServer.getPort();
  }
  return true;
}
