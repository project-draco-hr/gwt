{
  w.println();
  JType asyncReturnType=asyncMethod.getReturnType().getErasedType();
  w.print("public ");
  w.print(asyncReturnType.getQualifiedSourceName());
  w.print(" ");
  w.print(asyncMethod.getName() + "(");
  boolean needsComma=false;
  boolean needsTryCatchBlock=false;
  NameFactory nameFactory=new NameFactory();
  JParameter[] asyncParams=asyncMethod.getParameters();
  for (int i=0; i < asyncParams.length; ++i) {
    JParameter param=asyncParams[i];
    if (needsComma) {
      w.print(", ");
    }
 else {
      needsComma=true;
    }
    JType paramType=param.getType();
    paramType=paramType.getErasedType();
    if (i < asyncParams.length - 1 && paramType.isPrimitive() == null && !paramType.getQualifiedSourceName().equals(String.class.getCanonicalName())) {
      needsTryCatchBlock=true;
    }
    w.print(paramType.getQualifiedSourceName());
    w.print(" ");
    String paramName=param.getName();
    nameFactory.addName(paramName);
    w.print(paramName);
  }
  w.println(") {");
  w.indent();
  String requestIdName=nameFactory.createName("requestId");
  w.println("int " + requestIdName + " = getNextRequestId();");
  String statsMethodExpr=getProxySimpleName() + "." + syncMethod.getName();
  String tossName=nameFactory.createName("toss");
  w.println("boolean " + tossName + " = isStatsAvailable() && stats("+ "timeStat(\""+ statsMethodExpr+ "\", getRequestId(), \"begin\"));");
  w.print(ClientSerializationStreamWriter.class.getSimpleName());
  w.print(" ");
  String streamWriterName=nameFactory.createName("streamWriter");
  w.println(streamWriterName + " = createStreamWriter();");
  w.println("// createStreamWriter() prepared the stream");
  w.println(streamWriterName + ".writeString(REMOTE_SERVICE_INTERFACE_NAME);");
  if (needsTryCatchBlock) {
    w.println("try {");
    w.indent();
  }
  if (!shouldEnforceTypeVersioning()) {
    w.println(streamWriterName + ".addFlags(" + ClientSerializationStreamReader.class.getName()+ ".SERIALIZATION_STREAM_FLAGS_NO_TYPE_VERSIONING);");
  }
  w.println(streamWriterName + ".writeString(\"" + syncMethod.getName()+ "\");");
  JParameter[] syncParams=syncMethod.getParameters();
  w.println(streamWriterName + ".writeInt(" + syncParams.length+ ");");
  for (  JParameter param : syncParams) {
    w.println(streamWriterName + ".writeString(\"" + serializableTypeOracle.getSerializedTypeName(param.getType().getErasedType())+ "\");");
  }
  for (int i=0; i < asyncParams.length - 1; ++i) {
    JParameter asyncParam=asyncParams[i];
    w.print(streamWriterName + ".");
    w.print(Shared.getStreamWriteMethodNameFor(asyncParam.getType()));
    w.println("(" + asyncParam.getName() + ");");
  }
  JParameter callbackParam=asyncParams[asyncParams.length - 1];
  String callbackName=callbackParam.getName();
  if (needsTryCatchBlock) {
    w.outdent();
    w.print("} catch (SerializationException ");
    String exceptionName=nameFactory.createName("ex");
    w.println(exceptionName + ") {");
    w.indent();
    w.println(callbackName + ".onFailure(" + exceptionName+ ");");
    w.outdent();
    w.println("}");
  }
  w.println();
  String payloadName=nameFactory.createName("payload");
  w.println("String " + payloadName + " = "+ streamWriterName+ ".toString();");
  w.println(tossName + " = isStatsAvailable() && stats(" + "timeStat(\""+ statsMethodExpr+ "\", getRequestId(), \"requestSerialized\"));");
  if (asyncReturnType == JPrimitiveType.VOID) {
    w.print("doInvoke(");
  }
 else   if (asyncReturnType.getQualifiedSourceName().equals(RequestBuilder.class.getName())) {
    w.print("return doPrepareRequestBuilder(");
  }
 else   if (asyncReturnType.getQualifiedSourceName().equals(Request.class.getName())) {
    w.print("return doInvoke(");
  }
 else {
    throw new RuntimeException("Unhandled return type " + asyncReturnType.getQualifiedSourceName());
  }
  JType returnType=syncMethod.getReturnType();
  w.print("ResponseReader." + getResponseReaderFor(returnType).name());
  w.println(", \"" + getProxySimpleName() + "."+ syncMethod.getName()+ "\", getRequestId(), "+ payloadName+ ", "+ callbackName+ ");");
  w.outdent();
  w.println("}");
}
