{
  Set<String> allRootTypes=Sets.newHashSet();
  Properties properties=new Properties();
  BindingProperty userAgentProperty=properties.createBinding("user.agent");
  userAgentProperty.setProvider(new PropertyProvider("return navigator.userAgent;"));
  userAgentProperty.addTargetLibraryDefinedValue(userAgentProperty.getRootCondition(),"mozilla");
  userAgentProperty.addTargetLibraryDefinedValue(userAgentProperty.getRootCondition(),"webkit");
  BindingProperty flavorProperty=properties.createBinding("flavor");
  flavorProperty.setProvider(new PropertyProvider("return window.properties.flavor;"));
  flavorProperty.addTargetLibraryDefinedValue(flavorProperty.getRootCondition(),"Vanilla");
  flavorProperty.addTargetLibraryDefinedValue(flavorProperty.getRootCondition(),"Chocolate");
  ConfigurationProperty emulateStackProperty=properties.createConfiguration("emulateStack",false);
  emulateStackProperty.setValue("TRUE");
  compiler.jprogram=new JProgram(new MinimalRebuildCache());
  precompiler.buildPropertyProviderRegistrator(allRootTypes,Sets.newTreeSet(Lists.newArrayList(userAgentProperty,flavorProperty)),Sets.newTreeSet(Lists.newArrayList(emulateStackProperty)));
  assertEquals("com.google.gwt.lang.mock_PropertyProviderRegistrator",compiler.jprogram.getPropertyProviderRegistratorTypeSourceName());
  assertTrue(allRootTypes.contains(compiler.jprogram.getPropertyProviderRegistratorTypeSourceName()));
  String registratorSource=generatorContext.stringWriterByTypeSourceName.get(compiler.jprogram.getPropertyProviderRegistratorTypeSourceName()).toString();
  assertTrue(registratorSource.contains("class PropertyValueProvider0"));
  assertTrue(registratorSource.contains("\"flavor\""));
  assertTrue(registratorSource.contains("/*-return window.properties.flavor;-*/"));
  assertTrue(registratorSource.contains("registerPropertyValueProvider(" + "new PropertyValueProvider0())"));
  assertTrue(registratorSource.contains("class PropertyValueProvider1"));
  assertTrue(registratorSource.contains("\"user.agent\""));
  assertTrue(registratorSource.contains("/*-return navigator.userAgent;-*/;"));
  assertTrue(registratorSource.contains("registerPropertyValueProvider(" + "new PropertyValueProvider1())"));
}
