{
  if (type == COM.VT_EMPTY) {
    OLE.error(OLE.ERROR_CANNOT_CHANGE_VARIANT_TYPE,-1);
  }
  if (type == COM.VT_DISPATCH) {
    return new OleAutomation(dispatchData);
  }
  int oldPtr=OS.GlobalAlloc(COM.GMEM_FIXED | COM.GMEM_ZEROINIT,sizeof);
  int newPtr=OS.GlobalAlloc(COM.GMEM_FIXED | COM.GMEM_ZEROINIT,sizeof);
  Variant autoVar=null;
  try {
    getData(oldPtr);
    int result=COM.VariantChangeType(newPtr,oldPtr,(short)0,COM.VT_DISPATCH);
    if (result != COM.S_OK)     OLE.error(OLE.ERROR_CANNOT_CHANGE_VARIANT_TYPE,result);
    autoVar=new Variant();
    autoVar.setData(newPtr);
    return autoVar.getAutomation();
  }
  finally {
    COM.VariantClear(oldPtr);
    OS.GlobalFree(oldPtr);
    COM.VariantClear(newPtr);
    OS.GlobalFree(newPtr);
    if (autoVar != null)     autoVar.dispose();
  }
}
