{
  ProxyImpl createProxy=(ProxyImpl)requestFactory.create(SimpleFooProxy.class);
  assertTrue(createProxy.isFuture());
  Long futureId=createProxy.getId();
  ProxyImpl mockProxy=new ProxyImpl(ProxyJsoImpl.create(futureId,1,SimpleRequestFactoryInstance.schema(),SimpleRequestFactoryInstance.impl()),RequestFactoryJsonImpl.NOT_FUTURE);
  valueStore.putInValueStore(mockProxy.asJso());
  DeltaValueStoreJsonImpl deltaValueStore=new DeltaValueStoreJsonImpl(valueStore,requestFactory);
  deltaValueStore.set(SimpleFooProxyProperties.userName,createProxy,"harry");
  deltaValueStore.set(SimpleFooProxyProperties.userName,mockProxy,"bovik");
  assertTrue(deltaValueStore.isChanged());
  String jsonString=deltaValueStore.toJson();
  JSONObject jsonObject=(JSONObject)JSONParser.parseLenient(jsonString);
  assertFalse(jsonObject.containsKey(WriteOperation.DELETE.getUnObfuscatedEnumName()));
  assertTrue(jsonObject.containsKey(WriteOperation.CREATE.getUnObfuscatedEnumName()));
  assertTrue(jsonObject.containsKey(WriteOperation.UPDATE.getUnObfuscatedEnumName()));
  JSONArray createOperationArray=jsonObject.get(WriteOperation.CREATE.getUnObfuscatedEnumName()).isArray();
  assertEquals(1,createOperationArray.size());
  assertEquals("harry",createOperationArray.get(0).isObject().get(SIMPLE_FOO_CLASS_NAME).isObject().get(SimpleFooProxyProperties.userName.getName()).isString().stringValue());
  JSONArray updateOperationArray=jsonObject.get(WriteOperation.UPDATE.getUnObfuscatedEnumName()).isArray();
  assertEquals(1,updateOperationArray.size());
  assertEquals("bovik",updateOperationArray.get(0).isObject().get(SIMPLE_FOO_CLASS_NAME).isObject().get(SimpleFooProxyProperties.userName.getName()).isString().stringValue());
}
