{
  SortedMap<String,SortedSet<String>> collapsedPropertyMap=new TreeMap<String,SortedSet<String>>();
  for (  BindingProps bindingProps : allProps) {
    BindingProperty[] props=bindingProps.getOrderedProps();
    String[] values=bindingProps.getOrderedPropValues();
    for (int i=0; i < props.length; i++) {
      BindingProperty prop=props[i];
      String value=values[i];
      boolean isCollapsed=false;
      for (      Set<String> equivalenceSet : prop.getCollapsedValues()) {
        if (equivalenceSet.contains(value)) {
          SortedSet<String> toAdd=collapsedPropertyMap.get(prop.getName());
          if (toAdd == null) {
            toAdd=new TreeSet<String>();
            collapsedPropertyMap.put(prop.getName(),toAdd);
            isCollapsed=true;
          }
          toAdd.addAll(equivalenceSet);
        }
      }
      if (!isCollapsed) {
        collapsedPropertyMap.put(prop.getName(),new TreeSet<String>(Arrays.asList(value)));
      }
    }
  }
  return collapsedPropertyMap.toString();
}
