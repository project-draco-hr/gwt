{
  boolean isFirstStatement=true;
  boolean hasEmployee=employeeId != null && employeeId >= 0;
  boolean hasDepartment=!hasEmployee && department != null && department.length() > 0;
  boolean hasStartsWith=startsWith != null && startsWith.length() > 0;
  if (isCount && !hasEmployee && !hasDepartment&& !hasStartsWith) {
    return null;
  }
  String retValue=isCount ? "count(o)" : "o";
  String queryString="select " + retValue + " from Report o";
  if (hasEmployee) {
    queryString+=isFirstStatement ? " WHERE" : " AND";
    isFirstStatement=false;
    queryString+=" o.reporterKey =:reporterKey";
  }
  if (hasDepartment) {
    queryString+=isFirstStatement ? " WHERE" : " AND";
    isFirstStatement=false;
    queryString+=" o.department =:department";
  }
  if (hasStartsWith) {
    queryString+=isFirstStatement ? " WHERE" : " AND";
    isFirstStatement=false;
    queryString+=" o.purposeLowerCase >=:startsWith";
    queryString+=" AND o.purposeLowerCase <=:startsWithZ";
  }
  if (!hasStartsWith && orderBy != null && orderBy.length() >= 0) {
    queryString+=" ORDER BY " + orderBy;
  }
  Query query=em.createQuery(queryString);
  if (hasEmployee) {
    query.setParameter("reporterKey",employeeId);
  }
  if (hasDepartment) {
    query.setParameter("department",department);
  }
  if (hasStartsWith) {
    String startsWithLc=startsWith.toLowerCase();
    query.setParameter("startsWith",startsWithLc);
    query.setParameter("startsWithZ",startsWithLc + "zzzzzz");
  }
  return query;
}
