{
  try {
    SelectionProperty localeProp=propertyOracle.getSelectionProperty(logger,PROP_LOCALE);
    ConfigurationProperty runtimeLocaleProp=propertyOracle.getConfigurationProperty(PROP_RUNTIME_LOCALES);
    CacheKey key=new CacheKey(localeProp,runtimeLocaleProp);
synchronized (cacheLock) {
      if (cache == null) {
        cache=new HashMap<CacheKey,LocaleUtils>();
      }
      LocaleUtils localeUtils=cache.get(key);
      if (localeUtils == null) {
        localeUtils=createInstance(logger,localeProp,runtimeLocaleProp);
        cache.put(key,localeUtils);
      }
      return localeUtils;
    }
  }
 catch (  BadPropertyValueException e) {
    logger.log(TreeLogger.WARN,"Unable to get locale properties, using defaults",e);
    GwtLocale defaultLocale=factory.fromString("default");
    Set<GwtLocale> allLocales=new HashSet<GwtLocale>();
    allLocales.add(defaultLocale);
    return new LocaleUtils(defaultLocale,allLocales,allLocales,Collections.<GwtLocale>emptySet());
  }
}
