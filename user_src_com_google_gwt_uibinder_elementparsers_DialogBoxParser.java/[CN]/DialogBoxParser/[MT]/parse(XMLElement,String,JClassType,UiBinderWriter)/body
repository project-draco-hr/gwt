{
  String caption=null;
  String body=null;
  XMLElement customCaption=null;
  String prefix=elem.getPrefix();
  for (  XMLElement child : elem.consumeChildElements()) {
    if (CAPTION.equals(child.getLocalName())) {
      if (caption != null) {
        writer.die(elem,"May have only one <%s:%s>",prefix,CAPTION);
      }
      HtmlInterpreter interpreter=HtmlInterpreter.newInterpreterForUiObject(writer,fieldName);
      caption=child.consumeInnerHtml(interpreter);
    }
 else     if (CUSTOM_CAPTION.equals(child.getLocalName())) {
      if (customCaption != null) {
        writer.die(elem,"May only have one <%s:%s>",prefix,CUSTOM_CAPTION);
      }
      customCaption=child.consumeSingleChildElement();
    }
 else {
      if (body != null) {
        writer.die(elem,"May have only one widget, but found %s and %s",body,child);
      }
      if (!writer.isWidgetElement(child)) {
        writer.die(elem,"Found non-widget %s",child);
      }
      body=writer.parseElementToField(child);
    }
  }
  if (caption != null && customCaption != null) {
    writer.die("Must choose between <%s:%s> or <%s:%s>",prefix,CAPTION,prefix,CUSTOM_CAPTION);
  }
  handleConstructorArgs(elem,fieldName,type,writer,customCaption);
  if (caption != null) {
    writer.addStatement("%s.setHTML(\"%s\");",fieldName,caption);
  }
  if (body != null) {
    writer.addStatement("%s.setWidget(%s);",fieldName,body);
  }
}
