{
  if (jsProgram.getFragmentCount() == 1) {
    return;
  }
  if (!shouldPredeclareReferences()) {
    return;
  }
  defineJsLink();
  FindNameReferences findNameReferences=new FindNameReferences();
  findNameReferences.accept(jsProgram);
  chooseNamesToPredefine(findNameReferences.islandsDefining,findNameReferences.islandsUsing);
  new RewriteDeclsAndRefs().accept(jsProgram);
}
