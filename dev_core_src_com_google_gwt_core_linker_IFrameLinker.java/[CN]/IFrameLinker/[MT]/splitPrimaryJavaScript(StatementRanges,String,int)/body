{
  if (charsPerChunk < 0) {
    return js;
  }
  StringBuilder sb=new StringBuilder();
  int bytesInCurrentTag=0;
  for (int i=0; i < ranges.numStatements(); i++) {
    int start=ranges.start(i);
    int end=ranges.end(i);
    int length=end - start;
    if (bytesInCurrentTag > 0 && bytesInCurrentTag + length > charsPerChunk) {
      if (lastChar(sb) != '\n') {
        sb.append('\n');
      }
      sb.append(SCRIPT_CHUNK_SEPARATOR);
      bytesInCurrentTag=0;
    }
    if (bytesInCurrentTag > 0) {
      char lastChar=lastChar(sb);
      if (lastChar != '\n' && lastChar != ';' && lastChar != '}') {
        sb.append(";");
      }
    }
    sb.append(js,start,end);
    bytesInCurrentTag+=length;
  }
  return sb.toString();
}
