{
  String[] bits=historyToken.split(HISTORY_TOKEN_SEPARATOR);
  if (bits.length < 2 || bits.length > 3) {
    return null;
  }
  boolean isFuture=bits.length == 3;
  ProxySchema<? extends EntityProxy> schema=recordToTypeMap.getType(bits[SCHEMA_INDEX]);
  if (schema == null) {
    return null;
  }
  String id=bits[ID_INDEX];
  Object futureId=null;
  if (!isFuture) {
    futureId=datastoreToFutureMap.get(id,schema);
  }
  return new EntityProxyIdImpl<EntityProxy>(id,schema,isFuture,futureId);
}
