{
  com.google.gwt.requestfactory.server.SimpleFoo.reset();
  JSONObject foo=fetchVerifyAndGetInitialObject();
  String savedVersion=createNoChangeRequestAndGetServerVersion(foo);
  JSONObject result=getResultFromServer(foo);
  assertTrue(result.getJSONObject("sideEffects").has("UPDATE"));
  JSONArray updateArray=result.getJSONObject("sideEffects").getJSONArray("UPDATE");
  assertEquals(1,updateArray.length());
  assertEquals(2,updateArray.getJSONObject(0).length());
  assertTrue(updateArray.getJSONObject(0).has(Constants.ENCODED_ID_PROPERTY));
  assertTrue(updateArray.getJSONObject(0).has(Constants.ENCODED_VERSION_PROPERTY));
  assertEquals(savedVersion,updateArray.getJSONObject(0).getString(Constants.ENCODED_VERSION_PROPERTY));
  SimpleFoo fooResult=SimpleFoo.findSimpleFooById(999L);
  assertEquals(45,(int)fooResult.getIntId());
  assertEquals("JSC",fooResult.getUserName());
  assertEquals(savedVersion,requestProcessor.encodePropertyValue(fooResult.getVersion()).toString());
}
