{
  Activity nextActivity=mapper.getActivity(event.getNewPlace());
  Throwable caughtOnStop=null;
  Throwable caughtOnStart=null;
  if (nextActivity == null) {
    nextActivity=NULL_ACTIVITY;
  }
  if (currentActivity.equals(nextActivity)) {
    return;
  }
  if (startingNext) {
    currentActivity.onCancel();
    currentActivity=NULL_ACTIVITY;
    startingNext=false;
  }
 else   if (!currentActivity.equals(NULL_ACTIVITY)) {
    stopperedEventBus.removeHandlers();
    try {
      currentActivity.onStop();
    }
 catch (    Throwable t) {
      caughtOnStop=t;
    }
 finally {
      stopperedEventBus.removeHandlers();
    }
  }
  currentActivity=nextActivity;
  if (currentActivity.equals(NULL_ACTIVITY)) {
    display.showActivityWidget(null);
    return;
  }
  startingNext=true;
  try {
    currentActivity.start(new ProtectedDisplay(currentActivity),stopperedEventBus);
  }
 catch (  Throwable t) {
    caughtOnStart=t;
  }
  if (caughtOnStart != null || caughtOnStop != null) {
    Set<Throwable> causes=new LinkedHashSet<Throwable>();
    if (caughtOnStop != null) {
      causes.add(caughtOnStop);
    }
    if (caughtOnStart != null) {
      causes.add(caughtOnStart);
    }
    throw new UmbrellaException(causes);
  }
}
