{
  Set<Entry<String,Object>> out=new HashSet<Entry<String,Object>>(){
    @Override public boolean remove(    Object o){
      if (o instanceof Entry) {
        Entry<?,?> entry=(Entry<?,?>)o;
        boolean removed=(DiskCache.this.remove(entry.getKey())) != null;
        super.remove(o);
        return removed;
      }
      return false;
    }
  }
;
  out.addAll(cache.entrySet());
  if (directory != null) {
    possiblyCreateCacheDirectory();
    File[] entries=directory.listFiles();
    for (int i=0; i < entries.length; i++) {
      if (!cache.containsKey(new FileEntry(entries[i]).getKey())) {
        out.add(new FileEntry(entries[i]));
      }
    }
  }
  return out;
}
