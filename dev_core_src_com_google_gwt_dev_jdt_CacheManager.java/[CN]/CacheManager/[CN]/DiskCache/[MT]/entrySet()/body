{
  Set<Entry<String,Object>> out=new HashSet<Entry<String,Object>>(){
    @Override public boolean remove(    Object o){
      Entry<String,Object> entry=(Entry<String,Object>)o;
      boolean removed=(DiskCache.this.remove(entry.getKey())) != null;
      super.remove(o);
      return removed;
    }
  }
;
  out.addAll(cache.entrySet());
  if (directory != null) {
    possiblyCreateCacheDirectory();
    File[] entries=directory.listFiles();
    for (int i=0; i < entries.length; i++) {
      if (!cache.containsKey(new FileEntry(entries[i]).getKey())) {
        out.add(new FileEntry(entries[i]));
      }
    }
  }
  return out;
}
