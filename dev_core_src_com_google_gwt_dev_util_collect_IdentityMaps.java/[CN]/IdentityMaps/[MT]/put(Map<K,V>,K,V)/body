{
switch (map.size()) {
case 0:
    return create(key,value);
case 1:
{
    Map<K,V> result=new IdentityHashMap<K,V>();
    result.put(map.keySet().iterator().next(),map.values().iterator().next());
    result.put(key,value);
    return result;
  }
default :
map.put(key,value);
return map;
}
}
