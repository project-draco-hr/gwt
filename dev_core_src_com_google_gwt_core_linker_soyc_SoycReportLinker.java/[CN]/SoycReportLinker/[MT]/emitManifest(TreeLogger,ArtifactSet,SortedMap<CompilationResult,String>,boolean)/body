{
  ByteArrayOutputStream bytes=new ByteArrayOutputStream();
  OutputStreamWriter out;
  try {
    out=new OutputStreamWriter(compress ? new GZIPOutputStream(bytes) : bytes);
  }
 catch (  IOException e) {
    logger.log(TreeLogger.ERROR,"Unable to set up gzip stream",e);
    throw new UnableToCompleteException();
  }
  PrintWriter pw=new PrintWriter(out);
  HtmlTextOutput htmlOut=new HtmlTextOutput(pw,false);
  String curLine="<?xml version=\"1.0\" encoding=\"UTF-8\"?>";
  htmlOut.printRawOpt(curLine);
  htmlOut.newline();
  curLine="<soyc-manifest>";
  htmlOut.printRawOpt(curLine);
  htmlOut.newline();
  htmlOut.indentIn();
  htmlOut.indentIn();
  curNumIndents++;
  for (  Map.Entry<CompilationResult,String> entry : partialPathsByResult.entrySet()) {
    curLine="<report href=\"" + entry.getValue() + "\">";
    htmlOut.printRawOpt(curLine);
    htmlOut.newline();
    htmlOut.indentIn();
    htmlOut.indentIn();
    curNumIndents++;
    for (    Map<SelectionProperty,String> map : entry.getKey().getPropertyMap()) {
      if (map.size() > 0) {
        curLine="<permutation>";
        htmlOut.printRawOpt(curLine);
        htmlOut.newline();
        htmlOut.indentIn();
        htmlOut.indentIn();
        curNumIndents++;
      }
 else {
        curLine="<permutation/>";
        htmlOut.printRawOpt(curLine);
        htmlOut.newline();
      }
      for (      Map.Entry<SelectionProperty,String> propertyEntry : map.entrySet()) {
        curLine="<property name=\"" + propertyEntry.getKey().getName() + "\" value=\""+ propertyEntry.getValue()+ "\"/>";
        htmlOut.printRawOpt(curLine);
        htmlOut.newline();
      }
      if (map.size() > 0) {
        htmlOut.indentOut();
        htmlOut.indentOut();
        curNumIndents--;
        curLine="</permutation>";
        htmlOut.printRawOpt(curLine);
        htmlOut.newline();
      }
    }
    htmlOut.indentOut();
    htmlOut.indentOut();
    curNumIndents--;
    curLine="</report>";
    htmlOut.printRawOpt(curLine);
    htmlOut.newline();
  }
  htmlOut.indentOut();
  htmlOut.indentOut();
  curNumIndents--;
  curLine="</soyc-manifest>";
  htmlOut.printRawOpt(curLine);
  htmlOut.newline();
  pw.close();
  Utility.close(out);
  SyntheticArtifact toReturn=emitBytes(logger,bytes.toByteArray(),"manifest.xml");
  return toReturn;
}
