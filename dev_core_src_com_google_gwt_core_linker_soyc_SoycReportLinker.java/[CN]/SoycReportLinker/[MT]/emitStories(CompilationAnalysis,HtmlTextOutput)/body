{
  String curLine;
  Map<Story,Integer> storyIds=new HashMap<Story,Integer>();
  Set<Story> stories=report.getStories();
  curLine="<stories>";
  htmlOut.printRawOpt(curLine);
  htmlOut.newlineOpt();
  if (stories.size() > 0) {
    htmlOut.indentIn();
    htmlOut.indentIn();
    curNumIndents++;
  }
  for (  Story story : stories) {
    int storyNum=storyIds.size();
    storyIds.put(story,storyNum);
    curLine="<story id=\"story" + Integer.toString(storyNum) + "\"";
    if (story.getLiteralTypeName() != null) {
      curLine=curLine + " literal=\"" + story.getLiteralTypeName()+ "\"";
    }
    curLine=curLine + ">";
    htmlOut.printRawOpt(curLine);
    htmlOut.newlineOpt();
    Set<Origin> origins=story.getSourceOrigin();
    if (origins.size() > 0) {
      htmlOut.indentIn();
      htmlOut.indentIn();
      curNumIndents++;
      curLine="<origins>";
      htmlOut.printRawOpt(curLine);
      htmlOut.newlineOpt();
      htmlOut.indentIn();
      htmlOut.indentIn();
      curNumIndents++;
    }
    for (    Origin origin : origins) {
      curLine="<origin lineNumber=\"" + Integer.toString(origin.getLineNumber()) + "\" location=\""+ origin.getLocation()+ "\"/>";
      htmlOut.printRawOpt(curLine);
      htmlOut.newlineOpt();
    }
    if (origins.size() > 0) {
      htmlOut.indentOut();
      htmlOut.indentOut();
      curNumIndents--;
      curLine="</origins>";
      htmlOut.printRawOpt(curLine);
      htmlOut.newlineOpt();
      htmlOut.indentOut();
      htmlOut.indentOut();
      curNumIndents--;
    }
    Set<Member> correlations=story.getMembers();
    if (correlations.size() > 0) {
      htmlOut.indentIn();
      htmlOut.indentIn();
      curNumIndents++;
      curLine="<correlations>";
      htmlOut.printRawOpt(curLine);
      htmlOut.newlineOpt();
      htmlOut.indentIn();
      htmlOut.indentIn();
      curNumIndents++;
    }
    for (    Member correlation : correlations) {
      curLine="<by idref=\"" + correlation.getSourceName() + "\"/>";
      htmlOut.printRawOpt(curLine);
      htmlOut.newlineOpt();
    }
    if (correlations.size() > 0) {
      htmlOut.indentOut();
      htmlOut.indentOut();
      curNumIndents--;
      curLine="</correlations>";
      htmlOut.printRawOpt(curLine);
      htmlOut.newlineOpt();
      htmlOut.indentOut();
      htmlOut.indentOut();
      curNumIndents--;
    }
    curLine="</story>";
    htmlOut.printRawOpt(curLine);
    htmlOut.newlineOpt();
  }
  if (stories.size() > 0) {
    htmlOut.indentOut();
    htmlOut.indentOut();
    curNumIndents--;
  }
  curLine="</stories>";
  htmlOut.printRawOpt(curLine);
  htmlOut.newlineOpt();
  return storyIds;
}
