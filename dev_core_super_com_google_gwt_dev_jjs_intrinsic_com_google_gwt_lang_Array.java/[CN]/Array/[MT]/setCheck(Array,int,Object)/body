{
  if (value != null) {
    int elementTypeClass=Array.getElementTypeClass(array);
    JavaScriptObject elementTypeId=Array.getElementTypeId(array);
    if (elementTypeClass == TYPE_JAVA_OBJECT && !Cast.canCast(value,elementTypeId)) {
      throw new ArrayStoreException();
    }
 else     if (elementTypeClass == TYPE_JSO && !Cast.isJavaScriptObject(value)) {
      throw new ArrayStoreException();
    }
 else     if (elementTypeClass == TYPE_JAVA_OBJECT_OR_JSO && !Cast.isJavaScriptObject(value) && !Cast.canCast(value,elementTypeId)) {
      throw new ArrayStoreException();
    }
  }
  return set(array,index,value);
}
