{
  if (value != null) {
    int elementTypeCategory=Array.getElementTypeCategory(array);
    JavaScriptObject elementTypeId=Array.getElementTypeId(array);
switch (elementTypeCategory) {
case TYPE_JAVA_LANG_STRING:
      if (!Cast.isJavaString(value)) {
        throw new ArrayStoreException();
      }
    break;
case TYPE_JAVA_OBJECT:
  if (!Cast.canCast(value,elementTypeId)) {
    throw new ArrayStoreException();
  }
break;
case TYPE_JSO:
if (!Cast.isJavaScriptObject(value)) {
throw new ArrayStoreException();
}
break;
case TYPE_JAVA_OBJECT_OR_JSO:
if (!Cast.isJavaScriptObject(value) && !Cast.canCast(value,elementTypeId)) {
throw new ArrayStoreException();
}
break;
}
}
return set(array,index,value);
}
