{
  if (value != null) {
switch (Array.getElementTypeCategory(array)) {
case TYPE_JAVA_LANG_STRING:
      if (!Cast.isJavaString(value)) {
        throw new ArrayStoreException();
      }
    break;
case TYPE_JAVA_OBJECT:
{
    JavaScriptObject elementTypeId=Array.getElementTypeId(array);
    if (!Cast.canCast(value,elementTypeId)) {
      throw new ArrayStoreException();
    }
    break;
  }
case TYPE_JSO:
if (!Cast.isJavaScriptObject(value)) {
  throw new ArrayStoreException();
}
break;
case TYPE_JAVA_OBJECT_OR_JSO:
{
JavaScriptObject elementTypeId=Array.getElementTypeId(array);
if (!Cast.isJavaScriptObject(value) && !Cast.canCast(value,elementTypeId)) {
throw new ArrayStoreException();
}
break;
}
}
}
return set(array,index,value);
}
