{
  HashSet<String> hashSet=new HashSet<String>();
  assertEquals("",ApiCompatibilityChecker.getApiDiff(new ApiDiffGenerator(api1,apiSameAs1),hashSet,false));
  ApiDiffGenerator apiDiff=new ApiDiffGenerator(api2,api1);
  boolean removeDuplicates=false;
  String strWithDuplicates=ApiCompatibilityChecker.getApiDiff(apiDiff,hashSet,removeDuplicates);
  String strWithoutDuplicates=ApiCompatibilityChecker.getApiDiff(apiDiff,hashSet,!removeDuplicates);
  String delimiter=ApiDiffGenerator.DELIMITER;
  String status="java.newpackage" + delimiter + ApiChange.Status.MISSING;
  assertEquals(1,countPresence(status,strWithDuplicates));
  assertEquals(1,countPresence(status,strWithoutDuplicates));
  assertEquals(1,countPresence("test.apicontainer.NonApiClass.AnotherApiClassInNonApiClass" + delimiter + ApiChange.Status.MISSING,strWithoutDuplicates));
  assertEquals(1,countPresence("test.apicontainer.NonApiClass.ApiClassInNonApiClass" + delimiter + ApiChange.Status.ABSTRACT_ADDED,strWithoutDuplicates));
  if (ApiCompatibilityChecker.REMOVE_ABSTRACT_CLASS_FROM_API) {
    assertEquals(1,countPresence("test.apicontainer.NonApiClass.ApiClassInNonApiClass::ApiClassInNonApiClass()" + delimiter + ApiChange.Status.MISSING,strWithoutDuplicates));
    assertEquals(1,countPresence("test.apicontainer.NonApiClass.ApiClassInNonApiClass::protectedMethod()" + delimiter + ApiChange.Status.MISSING,strWithoutDuplicates));
  }
  assertEquals(1,countPresence("java.lang.Object::apiField" + delimiter + ApiChange.Status.FINAL_ADDED,strWithoutDuplicates));
  assertEquals(1,countPresence("java.lang.Object::protectedMethod()" + delimiter + ApiChange.Status.FINAL_ADDED,strWithoutDuplicates));
  if (ApiCompatibilityChecker.REMOVE_ABSTRACT_CLASS_FROM_API) {
    assertEquals(2,countPresence("protectedMethod()" + delimiter + ApiChange.Status.FINAL_ADDED,strWithDuplicates));
  }
 else {
    assertEquals(3,countPresence("protectedMethod()" + delimiter + ApiChange.Status.FINAL_ADDED,strWithDuplicates));
  }
  String methodSignature="checkParametersAndReturnTypes(Ltest/apicontainer/ApiClass;)";
  assertEquals(1,countPresence(methodSignature + delimiter + ApiChange.Status.RETURN_TYPE_ERROR,strWithoutDuplicates));
  assertEquals(1,countPresence(methodSignature + delimiter + ApiChange.Status.EXCEPTIONS_ERROR,strWithoutDuplicates));
  assertEquals(2,countPresence(methodSignature,strWithoutDuplicates));
  methodSignature="methodInNonApiClass(Ljava/lang/Object;)";
  assertEquals(1,countPresence(methodSignature + delimiter + ApiChange.Status.OVERLOADED,strWithoutDuplicates));
}
