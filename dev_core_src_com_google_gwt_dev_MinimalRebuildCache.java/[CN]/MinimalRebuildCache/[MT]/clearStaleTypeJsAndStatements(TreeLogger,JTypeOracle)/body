{
  if (immediateTypeRelations.isEmpty()) {
    return Sets.newHashSet();
  }
  Set<String> staleTypeNames=Sets.newHashSet();
  Set<String> modifiedTypeNames=computeModifiedTypeNames();
{
    staleTypeNames.addAll(modifiedTypeNames);
    appendSubTypes(staleTypeNames,modifiedTypeNames,typeOracle);
    ImmutableList<String> modifiedTypeAndSubTypeNames=ImmutableList.copyOf(staleTypeNames);
    appendReferencingTypes(staleTypeNames,modifiedTypeAndSubTypeNames);
    appendReferencingTypes(staleTypeNames,jsoStatusChangedTypeNames);
    appendTypesThatRebindTypes(staleTypeNames,computeReboundTypesAffectedByModifiedResources());
    staleTypeNames.removeAll(JProgram.SYNTHETIC_TYPE_NAMES);
  }
  if (logger.isLoggable(TreeLogger.DEBUG)) {
    logger.log(TreeLogger.DEBUG,"known modified types = " + modifiedTypeNames);
    logger.log(TreeLogger.DEBUG,"known modified resources = " + modifiedResourcePaths);
    logger.log(TreeLogger.DEBUG,"clearing cached output for resulting stale types = " + staleTypeNames);
  }
  for (  String staleTypeName : staleTypeNames) {
    clearCachedTypeOutput(staleTypeName);
  }
  return staleTypeNames;
}
