{
  File zipFile=File.createTempFile("Test",".gwtlib");
  zipFile.deleteOnExit();
  String expectedLibraryName="BazLib";
  final String expectedResourceContents="<html><head><title>Index</title></head><body>Hi</body></html>";
  Set<String> expectedRanGeneratorNames=Sets.newHashSet("UiBinderGenerator","PlatinumGenerator");
  Set<String> expectedUserAgentConfigurationValues=Sets.newHashSet("webkit");
  Set<String> expectedLocaleConfigurationValues=Sets.newHashSet("en","fr");
  Set<String> expectedDependencyLibraryNames=Sets.newHashSet("FooLib","BarLib");
  MockCompilationUnit expectedCompilationUnit=new MockCompilationUnit("com.google.gwt.lang.RuntimeRebinder","blah");
  MockCompilationUnit expectedSuperSourceCompilationUnit=new MockCompilationUnit("com.google.gwt.lang.SuperRuntimeRebinder","superblah"){
    @Override public boolean isSuperSource(){
      return true;
    }
  }
;
  ZipLibraryWriter zipLibraryWriter=new ZipLibraryWriter(zipFile.getPath());
  zipLibraryWriter.setLibraryName(expectedLibraryName);
  zipLibraryWriter.addPublicResource(new SimpleMockResource("ui:binder:com.foo.baz.TableView"));
  zipLibraryWriter.addPublicResource(new MockResource("index.html"){
    @Override public CharSequence getContent(){
      return expectedResourceContents;
    }
  }
);
  zipLibraryWriter.addNewConfigurationPropertyValuesByName("user.agent",expectedUserAgentConfigurationValues);
  zipLibraryWriter.addNewConfigurationPropertyValuesByName("locale",expectedLocaleConfigurationValues);
  for (  String generatorName : expectedRanGeneratorNames) {
    zipLibraryWriter.addRanGeneratorName(generatorName);
  }
  zipLibraryWriter.addDependencyLibraryNames(expectedDependencyLibraryNames);
  zipLibraryWriter.addCompilationUnit(expectedCompilationUnit);
  zipLibraryWriter.addCompilationUnit(expectedSuperSourceCompilationUnit);
  zipLibraryWriter.write();
  ZipLibrary zipLibrary=new ZipLibrary(zipFile.getPath());
  CompilationUnit actualCompilationUnit=zipLibrary.getCompilationUnitByTypeSourceName("com.google.gwt.lang.RuntimeRebinder");
  CompilationUnit actualSuperSourceCompilationUnit=zipLibrary.getCompilationUnitByTypeSourceName("com.google.gwt.lang.SuperRuntimeRebinder");
  assertEquals(expectedLibraryName,zipLibrary.getLibraryName());
  assertEquals(expectedResourceContents,Util.readStreamAsString(zipLibrary.getPublicResourceByPath("index.html").openContents()));
  assertEquals(expectedRanGeneratorNames,zipLibrary.getRanGeneratorNames());
  assertEquals(expectedUserAgentConfigurationValues,zipLibrary.getNewConfigurationPropertyValuesByName().get("user.agent"));
  assertEquals(expectedLocaleConfigurationValues,zipLibrary.getNewConfigurationPropertyValuesByName().get("locale"));
  assertEquals(expectedDependencyLibraryNames,zipLibrary.getDependencyLibraryNames());
  assertEquals(expectedCompilationUnit.getResourceLocation(),actualCompilationUnit.getResourceLocation());
  assertEquals(expectedCompilationUnit.getTypeName(),actualCompilationUnit.getTypeName());
  assertEquals(expectedSuperSourceCompilationUnit.getResourceLocation(),actualSuperSourceCompilationUnit.getResourceLocation());
  assertEquals(expectedSuperSourceCompilationUnit.getTypeName(),actualSuperSourceCompilationUnit.getTypeName());
}
