{
  for (Iterator<CompilationUnit> it=unitMap.values().iterator(); it.hasNext(); ) {
    CompilationUnit unit=it.next();
    if (unit.isGenerated()) {
      unit.setState(State.FRESH);
      it.remove();
    }
  }
  refreshFromSourceOracle();
  CompilationUnitInvalidator.invalidateUnitsWithInvalidRefs(TreeLogger.NULL,getCompilationUnits());
  updateExposedUnits();
}
