{
  JReferenceType argType=(JReferenceType)x.getExpr().getType();
  JReferenceType toType=x.getTestType();
  if (program.typeOracle.canTriviallyCast(argType,toType)) {
    JNullLiteral nullLit=program.getLiteralNull();
    JBinaryOperation eq=new JBinaryOperation(program,x.getSourceInfo(),program.getTypePrimitiveBoolean(),JBinaryOperator.NEQ,x.getExpr(),nullLit);
    ctx.replaceMe(eq);
  }
 else {
    JMethod method;
    boolean isJsoCast=program.isJavaScriptObject(toType);
    if (isJsoCast) {
      method=program.getIndexedMethod("Cast.instanceOfJso");
    }
 else     if (dualImpls.contains(toType)) {
      method=program.getIndexedMethod("Cast.instanceOfOrJso");
    }
 else {
      method=program.getIndexedMethod("Cast.instanceOf");
    }
    JMethodCall call=new JMethodCall(program,x.getSourceInfo(),null,method);
    call.getArgs().add(x.getExpr());
    if (!isJsoCast) {
      JIntLiteral qId=program.getLiteralInt(queryIds.get(toType));
      call.getArgs().add(qId);
    }
    ctx.replaceMe(call);
  }
}
