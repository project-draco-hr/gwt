{
  boolean madeChanges=false;
  RecordVisitor recorder=new RecordVisitor();
  program.traverse(recorder);
  while (true) {
    TightenTypesVisitor tightener=new TightenTypesVisitor();
    program.traverse(tightener);
    ChangeList changes=tightener.getChangeList();
    if (changes.empty()) {
      return madeChanges;
    }
    changes.apply();
    madeChanges=true;
    FixDanglingRefsVisitor fixer=new FixDanglingRefsVisitor();
    program.traverse(fixer);
    changes=fixer.getChangeList();
    if (!changes.empty()) {
      changes.apply();
    }
  }
}
