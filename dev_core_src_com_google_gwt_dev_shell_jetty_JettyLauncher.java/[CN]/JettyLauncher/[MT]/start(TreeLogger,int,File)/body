{
  checkStartParams(logger,port,appRootDir);
  if (false) {
    System.setProperty("VERBOSE","true");
    JettyTreeLogger.setDefaultConstruction(logger,TreeLogger.INFO);
    System.setProperty("org.mortbay.log.class",JettyTreeLogger.class.getName());
    Log.isDebugEnabled();
    if (JettyTreeLogger.isDefaultConstructionReady()) {
      Log.setLog(new JettyTreeLogger());
    }
  }
  SelectChannelConnector connector=new SelectChannelConnector();
  connector.setPort(port);
  connector.setReuseAddress(false);
  connector.setSoLingerTime(0);
  Server server=new Server();
  server.addConnector(connector);
  WebAppContext wac=new WebAppContext(appRootDir.getAbsolutePath(),"/");
  FilteringParentClassLoader parentClassLoader=new FilteringParentClassLoader();
  WebAppClassLoader wacl=new WebAppClassLoader(parentClassLoader,wac);
  parentClassLoader.setChild(wacl);
  wac.setClassLoader(wacl);
  wac.getInitParams().put("org.mortbay.jetty.servlet.Default.useFileMappedBuffer","false");
  server.setHandler(wac);
  server.start();
  server.setStopAtShutdown(true);
  return new JettyServletContainer(logger,server,wac,connector.getLocalPort(),appRootDir);
}
