{
  delayTestFinish(5000);
  final SimpleFooProxy foo=req.create(SimpleFooProxy.class);
  Object futureId=foo.getId();
  assertEquals(futureId,foo.getId());
  assertTrue(((ProxyImpl)foo).isFuture());
  Request<SimpleFooProxy> fooReq=req.simpleFooRequest().persistAndReturnSelf(foo);
  fooReq.fire(new Receiver<SimpleFooProxy>(){
    @Override public void onSuccess(    final SimpleFooProxy returned){
      Object futureId=foo.getId();
      assertEquals(futureId,foo.getId());
      assertTrue(((ProxyImpl)foo).isFuture());
      checkStableIdEquals(foo,returned);
      finishTestAndReset();
    }
  }
);
}
