{
  Object key=context.getKey();
  ApprovalViewData viewData=getViewData(key);
  if (viewData != null && viewData.getPendingApproval().equals(value)) {
    clearViewData(key);
    viewData=null;
  }
  boolean isRejected=false;
  boolean isDisabled=false;
  String pendingValue=null;
  String renderValue=value;
  if (viewData != null) {
    isRejected=viewData.isRejected();
    pendingValue=viewData.getPendingApproval();
    if (!isRejected) {
      renderValue=pendingValue;
      isDisabled=true;
    }
  }
  boolean isApproved=approvedText.equals(renderValue);
  boolean isDenied=deniedText.equals(renderValue);
  SafeHtml approvedOption=createOption(isApproved,approvedText);
  SafeHtml deniedOption=createOption(isDenied,deniedText);
  if (isDisabled) {
    sb.append(template.disabled(approvedOption,deniedOption));
  }
 else {
    sb.append(template.enabled(approvedOption,deniedOption));
  }
  if (isRejected) {
    sb.append(errorIconHtml);
    sb.appendHtmlConstant("<a style='padding-left:3px;color:red;' href='javascript:;'>Error!</a>");
  }
 else   if (pendingValue != null) {
    sb.append(pendingIconHtml);
  }
}
