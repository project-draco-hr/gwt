{
  CellTable.Resources resources=GWT.create(TableResources.class);
  table=new CellTable<ExpenseProxy>(100,resources,Expenses.EXPENSE_RECORD_KEY_PROVIDER);
  Styles.Common common=Styles.common();
  table.addColumnStyleName(0,common.spacerColumn());
  table.addColumnStyleName(1,common.expenseDetailsDateColumn());
  table.addColumnStyleName(3,common.expenseDetailsCategoryColumn());
  table.addColumnStyleName(4,common.expenseDetailsAmountColumn());
  table.addColumnStyleName(5,common.expenseDetailsApprovalColumn());
  table.addColumnStyleName(6,common.spacerColumn());
  table.addColumn(new SpacerColumn<ExpenseProxy>());
  GetValue<ExpenseProxy,Date> createdGetter=new GetValue<ExpenseProxy,Date>(){
    public Date getValue(    ExpenseProxy object){
      return object.getCreated();
    }
  }
;
  defaultComparator=createColumnComparator(createdGetter,false);
  Comparator<ExpenseProxy> createdDesc=createColumnComparator(createdGetter,true);
  addColumn(table,"Created",new DateCell(DateTimeFormat.getFormat("MMM dd yyyy")),createdGetter,defaultComparator,createdDesc);
  lastComparator=defaultComparator;
  addColumn(table,"Description",new TextCell(),new GetValue<ExpenseProxy,String>(){
    public String getValue(    ExpenseProxy object){
      return object.getDescription();
    }
  }
);
  addColumn(table,"Category",new TextCell(),new GetValue<ExpenseProxy,String>(){
    public String getValue(    ExpenseProxy object){
      return object.getCategory();
    }
  }
);
  final GetValue<ExpenseProxy,Double> amountGetter=new GetValue<ExpenseProxy,Double>(){
    public Double getValue(    ExpenseProxy object){
      return object.getAmount();
    }
  }
;
  Comparator<ExpenseProxy> amountAsc=createColumnComparator(amountGetter,false);
  Comparator<ExpenseProxy> amountDesc=createColumnComparator(amountGetter,true);
  addColumn(table,"Amount",new NumberCell(NumberFormat.getCurrencyFormat()),new GetValue<ExpenseProxy,Number>(){
    public Number getValue(    ExpenseProxy object){
      return amountGetter.getValue(object);
    }
  }
,amountAsc,amountDesc);
  denialPopup.addCloseHandler(new CloseHandler<PopupPanel>(){
    public void onClose(    CloseEvent<PopupPanel> event){
      String reasonDenied=denialPopup.getReasonDenied();
      ExpenseProxy record=denialPopup.getExpenseRecord();
      if (reasonDenied == null || reasonDenied.length() == 0) {
        final Object key=items.getKey(record);
        approvalCell.clearViewData(key);
        syncCommit(record,null);
      }
 else {
        updateExpenseRecord(record,"Denied",reasonDenied);
      }
      table.setFocus(true);
    }
  }
);
  approvalCell=new ApprovalCell();
  Column<ExpenseProxy,String> approvalColumn=addColumn(table,"Approval Status",approvalCell,new GetValue<ExpenseProxy,String>(){
    public String getValue(    ExpenseProxy object){
      return object.getApproval();
    }
  }
);
  approvalColumn.setFieldUpdater(new FieldUpdater<ExpenseProxy,String>(){
    public void update(    int index,    final ExpenseProxy object,    String value){
      if ("Denied".equals(value)) {
        denialPopup.setExpenseRecord(object);
        denialPopup.setReasonDenied(object.getReasonDenied());
        denialPopup.popup();
      }
 else {
        updateExpenseRecord(object,value,"");
      }
    }
  }
);
  table.addColumn(new SpacerColumn<ExpenseProxy>());
  return table;
}
