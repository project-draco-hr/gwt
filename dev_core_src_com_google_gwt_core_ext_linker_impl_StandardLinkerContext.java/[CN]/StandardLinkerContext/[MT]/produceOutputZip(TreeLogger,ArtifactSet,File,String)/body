{
  outZip=outZip.getAbsoluteFile();
  logger=logger.branch(TreeLogger.TRACE,"Linking compilation into " + outZip.getPath(),null);
  try {
    ZipOutputStream zipOutputStream=new ZipOutputStream(new BufferedOutputStream(new FileOutputStream(outZip)));
    Set<String> createdDirs=new HashSet<String>();
    for (    EmittedArtifact artifact : artifacts.find(EmittedArtifact.class)) {
      TreeLogger artifactLogger=logger.branch(TreeLogger.DEBUG,"Emitting resource " + artifact.getPartialPath(),null);
      if (artifact.isPrivate()) {
        continue;
      }
      String path=pathPrefix + artifact.getPartialPath();
      writeArtifactToZip(artifactLogger,artifact,path,zipOutputStream,createdDirs);
    }
    Utility.close(zipOutputStream);
  }
 catch (  FileNotFoundException e) {
    logger.log(TreeLogger.ERROR,"Unable to create output archive " + outZip.getPath(),e);
    throw new UnableToCompleteException();
  }
}
