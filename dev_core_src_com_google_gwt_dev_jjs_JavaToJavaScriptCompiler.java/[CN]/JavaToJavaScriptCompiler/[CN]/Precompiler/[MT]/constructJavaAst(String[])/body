{
  Set<String> allRootTypes=new TreeSet<String>();
  CompilationState compilationState=rpo.getCompilationState();
  Memory.maybeDumpMemory("CompStateBuilt");
  recordJsoTypes(compilationState.getTypeOracle());
  populateRootTypes(allRootTypes,additionalRootTypes,compilationState.getTypeOracle());
  String entryMethodHolderTypeName=buildEntryMethodHolder(rpo.getGeneratorContext(),allRootTypes);
  beforeUnifyAst(allRootTypes);
  unifyJavaAst(allRootTypes,entryMethodHolderTypeName);
  if (options.isSoycEnabled() || options.isJsonSoycEnabled()) {
    SourceInfoCorrelator.exec(jprogram);
  }
  rpo.clear();
  Set<String> deletedTypeNames=options.isIncrementalCompileEnabled() ? getMinimalRebuildCache().computeDeletedTypeNames() : Sets.<String>newHashSet();
  jprogram.typeOracle.computeBeforeAST(StandardTypes.createFrom(jprogram),jprogram.getDeclaredTypes(),jprogram.getModuleDeclaredTypes(),deletedTypeNames);
  return compilationState;
}
