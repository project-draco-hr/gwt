{
  Event jjsCompilePermutationEvent=SpeedTracerLogger.start(CompilerEventType.JJS_COMPILE_PERMUTATION,"name",permutation.getProps().prettyPrint());
  long permStartMs=System.currentTimeMillis();
  try {
    Event javaEvent=SpeedTracerLogger.start(CompilerEventType.PERMUTATION_JAVA);
    long startTimeMs=System.currentTimeMillis();
    PermProps props=permutation.getProps();
    int permutationId=permutation.getId();
    AST ast=unifiedAst.getFreshAst();
    jprogram=ast.getJProgram();
    jsProgram=ast.getJsProgram();
    Map<StandardSymbolData,JsName> symbolTable=new TreeMap<StandardSymbolData,JsName>(new SymbolData.ClassIdentComparator());
    logger.log(TreeLogger.INFO,"Compiling permutation " + permutationId + "...");
    ResolveRebinds.exec(jprogram,permutation.getGwtCreateAnswers());
    Multimap<String,Integer> instrumentableLines=null;
    if (System.getProperty("gwt.coverage") != null) {
      instrumentableLines=BaselineCoverageGatherer.exec(jprogram);
    }
    jprogram.typeOracle.setJsInteropMode(compilerContext.getOptions().getJsInteropMode());
    maybeRecordReferencesAndControlFlow(false);
    CompileTimeConstantsReplacer.exec(jprogram);
    optimizeJava();
    TypeMapper<?> typeMapper=normalizeSemantics();
    postNormalizationOptimizeJava();
    maybeRecordReferencesAndControlFlow(true);
    jprogram.typeOracle.recomputeAfterOptimizations(jprogram.getDeclaredTypes());
    javaEvent.end();
    Event javaScriptEvent=SpeedTracerLogger.start(CompilerEventType.PERMUTATION_JAVASCRIPT);
    Pair<? extends JavaToJavaScriptMap,Set<JsNode>> jjsMapAndInlineableFunctions=GenerateJavaScriptAST.exec(logger,jprogram,jsProgram,compilerContext,typeMapper,symbolTable,props);
    JavaToJavaScriptMap jjsmap=jjsMapAndInlineableFunctions.getLeft();
    if (System.getProperty("gwt.coverage") != null) {
      CoverageInstrumentor.exec(jsProgram,instrumentableLines);
    }
    JsNormalizer.exec(jsProgram);
    JsSymbolResolver.exec(jsProgram);
    if (options.getNamespace() == JsNamespaceOption.PACKAGE) {
      JsNamespaceChooser.exec(jsProgram,jjsmap);
    }
    EvalFunctionsAtTopScope.exec(jsProgram,jjsmap);
    final Set<JsNode> inlinableJsFunctions=jjsMapAndInlineableFunctions.getRight();
    optimizeJs(inlinableJsFunctions);
    JsStackEmulator.exec(jprogram,jsProgram,props,jjsmap);
    Pair<SyntheticArtifact,MultipleDependencyGraphRecorder> dependenciesAndRecorder=splitJsIntoFragments(props,permutationId,jjsmap);
    Map<JsName,JsLiteral> internedLiteralByVariableName=renameJsSymbols(props,jjsmap);
    JsBreakUpLargeVarStatements.exec(jsProgram,props.getConfigProps());
    List<JsSourceMap> sourceInfoMaps=new ArrayList<JsSourceMap>();
    boolean isSourceMapsEnabled=props.isTrueInAnyPermutation("compiler.useSourceMaps");
    String[] jsFragments=new String[jsProgram.getFragmentCount()];
    StatementRanges[] ranges=new StatementRanges[jsFragments.length];
    SizeBreakdown[] sizeBreakdowns=options.isJsonSoycEnabled() || options.isSoycEnabled() || options.isCompilerMetricsEnabled() ? new SizeBreakdown[jsFragments.length] : null;
    generateJavaScriptCode(jjsmap,jsFragments,ranges,sizeBreakdowns,sourceInfoMaps,isSourceMapsEnabled || options.isJsonSoycEnabled());
    javaScriptEvent.end();
    PermutationResult permutationResult=new PermutationResultImpl(jsFragments,permutation,makeSymbolMap(symbolTable),ranges);
    addSyntheticArtifacts(unifiedAst,permutation,startTimeMs,permutationId,jjsmap,dependenciesAndRecorder,internedLiteralByVariableName,isSourceMapsEnabled,jsFragments,sizeBreakdowns,sourceInfoMaps,permutationResult);
    return permutationResult;
  }
 catch (  Throwable e) {
    throw CompilationProblemReporter.logAndTranslateException(logger,e);
  }
 finally {
    jjsCompilePermutationEvent.end();
    if (logger.isLoggable(TreeLogger.TRACE)) {
      logger.log(TreeLogger.TRACE,"Permutation took " + (System.currentTimeMillis() - permStartMs) + " ms");
    }
  }
}
