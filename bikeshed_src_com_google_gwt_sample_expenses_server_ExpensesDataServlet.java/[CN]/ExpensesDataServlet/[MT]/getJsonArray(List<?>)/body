{
  JSONArray jsonArray=new JSONArray();
  if (resultList.size() == 0) {
    return jsonArray;
  }
  Object firstElement=resultList.get(0);
  Class<?> entityClass=firstElement.getClass();
  Class<?> entityRefClass=Class.forName("com.google.gwt.sample.expenses.shared." + entityClass.getSimpleName() + "Ref");
  for (  Object entityElement : resultList) {
    JSONObject jsonObject=new JSONObject();
    for (    Field field : entityRefClass.getFields()) {
      if (isProperty(field) && requestedProperty(field)) {
        String propertyName=getPropertyName(field);
        jsonObject.put(propertyName,getPropertyValue(entityElement,propertyName));
      }
    }
    jsonArray.put(jsonObject);
  }
  return jsonArray;
}
