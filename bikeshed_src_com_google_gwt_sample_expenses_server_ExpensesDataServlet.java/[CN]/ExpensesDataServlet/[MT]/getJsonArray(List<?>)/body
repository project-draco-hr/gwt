{
  JSONArray jsonArray=new JSONArray();
  if (resultList.size() == 0) {
    return jsonArray;
  }
  Object firstElement=resultList.get(0);
  Class<?> entityClass=firstElement.getClass();
  Class<?> entityKeyClass=Class.forName("com.google.gwt.sample.expenses.shared." + entityClass.getSimpleName() + "Key");
  EntityKey<?> key=(EntityKey<?>)entityKeyClass.getMethod("get").invoke(null);
  for (  Object entityElement : resultList) {
    JSONObject jsonObject=new JSONObject();
    for (    Property<?,?> p : key.getProperties()) {
      if (requestedProperty(p)) {
        String propertyName=p.getName();
        jsonObject.put(propertyName,getPropertyValue(entityElement,propertyName));
      }
    }
    jsonArray.put(jsonObject);
  }
  return jsonArray;
}
