{
  JSONArray violations=new JSONArray();
  for (  EntityKey entityKey : involvedKeys) {
    EntityData entityData=afterDvsDataMap.get(entityKey);
    if (entityData == null || entityData.violations == null || entityData.violations.length() == 0) {
      continue;
    }
    DvsData dvsData=dvsDataMap.get(entityKey);
    if (dvsData != null) {
      JSONObject returnObject=new JSONObject();
      returnObject.put(VIOLATIONS_TOKEN,entityData.violations);
      if (entityKey.isFuture) {
        returnObject.put(ENCODED_FUTUREID_PROPERTY,entityKey.encodedId);
        returnObject.put(ENCODED_ID_PROPERTY,getSchemaAndId(entityKey.proxyType,null));
      }
 else {
        returnObject.put(ENCODED_ID_PROPERTY,getSchemaAndId(entityKey.proxyType,entityKey.encodedId));
      }
      violations.put(returnObject);
    }
  }
  return violations;
}
