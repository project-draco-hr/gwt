{
  JSONArray violations=new JSONArray();
  for (  EntityKey entityKey : involvedKeys) {
    EntityData entityData=afterDvsDataMap.get(entityKey);
    if (entityData == null || entityData.violations == null || entityData.violations.length() == 0) {
      continue;
    }
    DvsData dvsData=dvsDataMap.get(entityKey);
    if (dvsData != null) {
      JSONObject returnObject=new JSONObject();
      returnObject.put("violations",entityData.violations);
      if (entityKey.isFuture) {
        returnObject.put("futureId",entityKey.id + "");
        returnObject.put("id",getSchemaAndId(entityKey.record,null));
      }
 else {
        returnObject.put("id",getSchemaAndId(entityKey.record,entityKey.id));
      }
      violations.put(returnObject);
    }
  }
  return violations;
}
