{
  if (entityInstance == null) {
    return null;
  }
  JSONObject jsonObject=new JSONObject();
  jsonObject.put(ENCODED_ID_PROPERTY,entityKey.encodedId);
  for (  Property<?> p : allProperties(entityKey.proxyType)) {
    String propertyName=p.getName();
    String methodName=getMethodNameFromPropertyName(propertyName,"get");
    Method method=entityInstance.getClass().getMethod(methodName);
    Object returnValue=method.invoke(entityInstance);
    Object propertyValue;
    String encodedEntityId=isEntityReference(returnValue,p.getType());
    if (encodedEntityId != null) {
      propertyValue=encodedEntityId + "-NO-" + operationRegistry.getSecurityProvider().encodeClassType(p.getType());
    }
 else {
      propertyValue=encodePropertyValue(returnValue);
    }
    jsonObject.put(propertyName,propertyValue);
  }
  return jsonObject;
}
