{
  JSONObject exceptionResponse=new JSONObject();
  ServerFailure failure=exceptionHandler.createServerFailure(throwable);
  try {
    JSONObject exceptionMessage=new JSONObject();
    String message=failure.getMessage();
    String exceptionType=failure.getExceptionType();
    String stackTraceString=failure.getStackTraceString();
    if (message != null && message.length() != 0) {
      exceptionMessage.put("message",message);
    }
    if (exceptionType != null && exceptionType.length() != 0) {
      exceptionMessage.put("type",exceptionType);
    }
    if (stackTraceString != null && stackTraceString.length() != 0) {
      exceptionMessage.put("trace",stackTraceString);
    }
    exceptionResponse.put("exception",exceptionMessage);
  }
 catch (  JSONException jsonException) {
    throw new IllegalStateException(jsonException);
  }
  return exceptionResponse;
}
