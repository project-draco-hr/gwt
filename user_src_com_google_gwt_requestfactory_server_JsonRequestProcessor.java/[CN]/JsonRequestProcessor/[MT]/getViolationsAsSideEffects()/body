{
  JSONObject sideEffects=new JSONObject();
  for (  EntityKey entityKey : involvedKeys) {
    EntityData entityData=afterDvsDataMap.get(entityKey);
    if (entityData == null || entityData.violations == null || entityData.violations.length() == 0) {
      continue;
    }
    DvsData dvsData=dvsDataMap.get(entityKey);
    if (dvsData != null && dvsData.writeOperation != null) {
      JSONObject returnObject=new JSONObject();
      returnObject.put("violations",entityData.violations);
      if (entityKey.isFuture) {
        returnObject.put("futureId",entityKey.id + "");
        returnObject.put("id",getSchemaAndId(entityKey.record,null));
      }
 else {
        returnObject.put("id",getSchemaAndId(entityKey.record,entityKey.id));
      }
      JSONArray arrayForOperation=null;
      if (sideEffects.has(dvsData.writeOperation.name())) {
        arrayForOperation=sideEffects.getJSONArray(dvsData.writeOperation.name());
      }
 else {
        arrayForOperation=new JSONArray();
        sideEffects.put(dvsData.writeOperation.name(),arrayForOperation);
      }
      arrayForOperation.put(returnObject);
    }
  }
  return sideEffects;
}
