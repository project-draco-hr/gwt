{
  final String foo=cannotOptimize() ? "foo" : "bar";
  final String bar=cannotOptimize() ? "bar" : "foo";
  String result=new Object(){
    private String a=foo;
{
      a=foo;
    }
    public String toString(){
      return new Object(){
        private static final String constantString="wallawalla";
        private String ai=foo;
{
          ai=foo;
        }
        public String toString(){
          bar.valueOf(false);
          assertEquals("wallawalla",constantString);
          return foo + a + ai;
        }
      }
.toString() + a;
    }
  }
.toString();
  assertEquals(result,"foofoofoofoo");
}
