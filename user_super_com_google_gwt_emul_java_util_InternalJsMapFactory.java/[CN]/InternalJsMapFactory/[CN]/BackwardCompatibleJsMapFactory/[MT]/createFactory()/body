{
  if (isModern() && canHandleProto()) {
    return needsKeysWorkaround() ? new KeysWorkaroundJsMapFactory() : new InternalJsMapFactory();
  }
  return new LegacyInternalJsMapFactory();
}
