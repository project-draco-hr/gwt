{
  URL toReturn=null;
  if (locale != null) {
    String[] localeSegments=locale.split("_");
    int lastDot=resourceName.lastIndexOf(".");
    String prefix=lastDot == -1 ? resourceName : resourceName.substring(0,lastDot);
    String extension=lastDot == -1 ? "" : resourceName.substring(lastDot);
    for (int i=localeSegments.length - 1; i >= -1; i--) {
      String localeInsert="";
      for (int j=0; j <= i; j++) {
        localeInsert+="_" + localeSegments[j];
      }
      toReturn=locator.locate(prefix + localeInsert + extension);
      if (toReturn != null) {
        break;
      }
    }
  }
 else {
    toReturn=locator.locate(resourceName);
  }
  return toReturn;
}
