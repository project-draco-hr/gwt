{
  currentTask=tasks.poll();
  if (currentTask == null) {
    tryToExitNonFinalThread(null);
    exitFinalThread(new Runnable(){
      public void run(){
        results.add(FINISHED_RESULT);
      }
    }
);
  }
  boolean definitelyFinalThread=(threadCount.get() == 1);
  try {
    String result=currentTask.call();
    results.add(new SuccessResult(currentTask.getPermutation(),currentTask.getPermNum(),result));
  }
 catch (  OutOfMemoryError e) {
    if (definitelyFinalThread) {
      currentTask.logger.log(TreeLogger.ERROR,"Out of memory",e);
      exitFinalThread(new Runnable(){
        public void run(){
          results.add(new FailedResult(currentTask.getPermutation(),currentTask.getPermNum(),new UnableToCompleteException()));
        }
      }
);
    }
    tryToExitNonFinalThread(outOfMemoryRetryAction);
    outOfMemoryRetryAction.run();
  }
catch (  Throwable e) {
    results.add(new FailedResult(currentTask.getPermutation(),currentTask.getPermNum(),e));
    throw new ThreadDeath();
  }
}
