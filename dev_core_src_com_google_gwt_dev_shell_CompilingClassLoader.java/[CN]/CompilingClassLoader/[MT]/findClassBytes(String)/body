{
  if (JavaScriptHost.class.getName().equals(className)) {
    return javaScriptHostBytes;
  }
  if (classRewriter != null && classRewriter.isJsoIntf(className)) {
    return classRewriter.writeJsoIntf(className);
  }
  String lookupClassName=className.replace('.','/');
  if (classRewriter != null && classRewriter.isJsoImpl(className)) {
    lookupClassName=lookupClassName.substring(0,lookupClassName.length() - 1);
  }
  CompiledClass compiledClass=compilationState.getClassFileMap().get(lookupClassName);
  if (compiledClass != null) {
    injectJsniFor(compiledClass);
    byte[] classBytes=compiledClass.getBytes();
    if (!compiledClass.getUnit().isSuperSource()) {
      classBytes=emmaStrategy.getEmmaClassBytes(classBytes,lookupClassName,compiledClass.getUnit().getLastModified());
    }
 else {
      logger.log(TreeLogger.SPAM,"no emma instrumentation for " + lookupClassName + " because it is from super-source");
    }
    if (classRewriter != null) {
      byte[] newBytes=classRewriter.rewrite(className,classBytes);
      if (CLASS_DUMP) {
        if (!Arrays.equals(classBytes,newBytes)) {
          classDump(className,newBytes);
        }
      }
      classBytes=newBytes;
    }
    return classBytes;
  }
  return null;
}
