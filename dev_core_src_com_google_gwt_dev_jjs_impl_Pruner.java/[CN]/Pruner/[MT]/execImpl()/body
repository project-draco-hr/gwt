{
  OptimizerStats stats=new OptimizerStats(NAME);
  ControlFlowAnalyzer livenessAnalyzer=new ControlFlowAnalyzer(program);
  livenessAnalyzer.setForPruning();
  traverseTypes(livenessAnalyzer,program.immortalCodeGenTypes);
  if (saveCodeGenTypes) {
    traverseTypes(livenessAnalyzer,program.codeGenTypes);
  }
  livenessAnalyzer.traverseEverything();
  program.typeOracle.setInstantiatedTypes(livenessAnalyzer.getInstantiatedTypes());
  PruneVisitor pruner=new PruneVisitor(livenessAnalyzer.getReferencedTypes(),livenessAnalyzer.getLiveFieldsAndMethods());
  pruner.accept(program);
  stats.recordModified(pruner.getNumMods());
  if (!pruner.didChange()) {
    return stats;
  }
  CleanupRefsVisitor cleaner=new CleanupRefsVisitor(livenessAnalyzer.getLiveFieldsAndMethods(),pruner.getMethodToOriginalParamsMap());
  cleaner.accept(program.getDeclaredTypes());
  return stats;
}
