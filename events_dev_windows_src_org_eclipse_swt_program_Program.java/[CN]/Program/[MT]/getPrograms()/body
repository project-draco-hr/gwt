{
  Program[] programs=new Program[1024];
  TCHAR lpName=new TCHAR(0,1024);
  int[] lpcName=new int[]{lpName.length()};
  FILETIME ft=new FILETIME();
  int dwIndex=0, count=0;
  while (OS.RegEnumKeyEx(OS.HKEY_CLASSES_ROOT,dwIndex,lpName,lpcName,null,null,null,ft) != OS.ERROR_NO_MORE_ITEMS) {
    String path=lpName.toString(0,lpcName[0]);
    lpcName[0]=lpName.length();
    Program program=getProgram(path);
    if (program != null) {
      if (count == programs.length) {
        Program[] newPrograms=new Program[programs.length + 1024];
        System.arraycopy(programs,0,newPrograms,0,programs.length);
        programs=newPrograms;
      }
      programs[count++]=program;
    }
    dwIndex++;
  }
  if (count != programs.length) {
    Program[] newPrograms=new Program[count];
    System.arraycopy(programs,0,newPrograms,0,count);
    programs=newPrograms;
  }
  return programs;
}
