{
  try {
    String outputModuleName=module.getName();
    File outputDir=new File(compileDir.getWarDir().getCanonicalPath() + "/" + outputModuleName);
    if (!outputDir.exists()) {
      if (!outputDir.mkdir()) {
        compileLogger.log(Type.WARN,"cannot create directory: " + outputDir);
      }
    }
    writePublicResources(outputDir,module,compileLogger);
    String stub=generateStubNocacheJs(module.getName());
    File noCacheJs=new File(outputDir.getCanonicalPath(),module.getName() + ".nocache.js");
    Files.write(stub,noCacheJs,Charsets.UTF_8);
    String recompileNoCache=generateModuleRecompileJs(module,compileLogger);
    writeRecompileNoCacheJs(outputDir,outputModuleName,recompileNoCache,compileLogger);
  }
 catch (  IOException e) {
    compileLogger.log(Type.ERROR,"Error creating stub compile directory.",e);
    UnableToCompleteException wrapped=new UnableToCompleteException();
    wrapped.initCause(e);
    throw wrapped;
  }
}
