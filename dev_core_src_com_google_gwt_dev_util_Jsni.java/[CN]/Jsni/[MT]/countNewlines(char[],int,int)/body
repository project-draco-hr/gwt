{
  int total=0;
  while (start < end) {
switch (buf[start]) {
case '\r':
      ++total;
    if (start + 1 < end && buf[start + 1] == '\n') {
      ++start;
    }
  break;
case '\n':
++total;
break;
}
++start;
}
return total;
}
