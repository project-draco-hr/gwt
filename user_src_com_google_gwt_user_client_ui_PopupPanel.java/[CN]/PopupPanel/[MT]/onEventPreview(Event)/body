{
  Element target=DOM.eventGetTarget(event);
  boolean eventTargetsPopup=DOM.isOrHasChild(getElement(),target);
  int type=DOM.eventGetType(event);
switch (type) {
case Event.ONKEYDOWN:
{
      if (eventTargetsPopup) {
        return onKeyDownPreview((char)DOM.eventGetKeyCode(event),KeyboardListenerCollection.getKeyboardModifiers(event));
      }
 else {
        return !modal;
      }
    }
case Event.ONKEYUP:
{
    if (eventTargetsPopup) {
      return onKeyUpPreview((char)DOM.eventGetKeyCode(event),KeyboardListenerCollection.getKeyboardModifiers(event));
    }
 else {
      return !modal;
    }
  }
case Event.ONKEYPRESS:
{
  if (eventTargetsPopup) {
    return onKeyPressPreview((char)DOM.eventGetKeyCode(event),KeyboardListenerCollection.getKeyboardModifiers(event));
  }
 else {
    return !modal;
  }
}
case Event.ONMOUSEDOWN:
case Event.ONMOUSEUP:
case Event.ONMOUSEMOVE:
case Event.ONCLICK:
case Event.ONDBLCLICK:
{
if (DOM.getCaptureElement() != null) {
  return true;
}
if (!eventTargetsPopup && autoHide && (type == Event.ONMOUSEDOWN)) {
  hide(true);
  return true;
}
break;
}
case Event.ONFOCUS:
{
if (modal && !eventTargetsPopup && (target != null)) {
blur(target);
return false;
}
}
}
return !modal || eventTargetsPopup;
}
