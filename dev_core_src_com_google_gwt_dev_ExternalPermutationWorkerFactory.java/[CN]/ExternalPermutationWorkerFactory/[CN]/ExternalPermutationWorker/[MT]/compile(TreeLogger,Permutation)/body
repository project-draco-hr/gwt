{
  if (workerSocket == null) {
    try {
      workerSocket=serverSocket.accept();
      in=new ObjectInputStream(workerSocket.getInputStream());
      out=new ObjectOutputStream(workerSocket.getOutputStream());
      String c=in.readUTF();
      if (!cookies.contains(c)) {
        throw new TransientWorkerException("Received unknown cookie " + c,null);
      }
      out.writeObject(astFile);
      long memoryUse=in.readLong();
      logger.log(TreeLogger.SPAM,"Remote process indicates " + memoryUse + " bytes of memory used");
    }
 catch (    SocketTimeoutException e) {
      throw new TransientWorkerException("Remote process did not connect within timeout period",e);
    }
catch (    IOException e) {
      throw new TransientWorkerException("Unable to communicate with worker",e);
    }
  }
  try {
    out.writeBoolean(true);
    out.writeObject(permutation);
    out.flush();
    Object result=in.readObject();
    if (result instanceof Throwable) {
      Throwable t=(Throwable)result;
      logger.log(TreeLogger.ERROR,"Error from external worker",t);
      throw new UnableToCompleteException();
    }
    return (PermutationResult)result;
  }
 catch (  IOException e) {
    logger.log(TreeLogger.WARN,"Lost communication with remote process",e);
    throw new TransientWorkerException("Lost communication with remote process",e);
  }
catch (  ClassNotFoundException e) {
    logger.log(TreeLogger.ERROR,"Unable to receive response",e);
    throw new UnableToCompleteException();
  }
}
