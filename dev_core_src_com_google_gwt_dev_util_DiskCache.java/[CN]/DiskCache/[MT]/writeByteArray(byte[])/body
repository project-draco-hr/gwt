{
  try {
    if (!atEnd) {
      file.seek(file.length());
    }
    long position=file.getFilePointer();
    file.writeInt(bytes.length);
    file.write(bytes);
    return position;
  }
 catch (  IOException e) {
    throw new RuntimeException("Unable to write to byte cache",e);
  }
}
