{
  Preconditions.checkState(!compilationUnitsByTypeSourceName.containsKey(compilationUnit.getTypeName()));
  if (compilationUnit.isSuperSource()) {
    superSourceCompilationUnitTypeSourceNames.add(compilationUnit.getTypeName());
  }
 else {
    regularCompilationUnitTypeSourceNames.add(compilationUnit.getTypeName());
  }
  compilationUnitsByTypeSourceName.put(compilationUnit.getTypeName(),compilationUnit);
  for (  CompiledClass compiledClass : compilationUnit.getCompiledClasses()) {
    if (compilationUnit.isSuperSource()) {
      String classFilePath=compiledClass.getInternalName();
      superSourceClassFilePaths.add(Libraries.computeClassFileName(classFilePath));
      zipWriter.writeClassFile(classFilePath,compiledClass.getBytes());
    }
 else {
      String classFilePath=compiledClass.getInternalName();
      regularClassFilePaths.add(Libraries.computeClassFileName(classFilePath));
      zipWriter.writeClassFile(classFilePath,compiledClass.getBytes());
    }
  }
  zipWriter.writeCompilationUnitFile(compilationUnit);
}
