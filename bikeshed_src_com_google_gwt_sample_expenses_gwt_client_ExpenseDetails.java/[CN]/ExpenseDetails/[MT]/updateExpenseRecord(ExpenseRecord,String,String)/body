{
  if (Expenses.Approval.APPROVED.is(approval) && !Expenses.Approval.APPROVED.is(record.getApproval())) {
    double amount=record.getAmount();
    if (amount + totalApproved > MAX_COST) {
      syncCommit(record,"The total approved amount for an expense report cannot exceed $" + MAX_COST + ".");
      return;
    }
  }
  RequestObject<Void> editRequest=expensesRequestFactory.expenseRequest().persist();
  DeltaValueStore deltas=editRequest.getDeltaValueStore();
  deltas.set(ExpenseRecord.approval,record,approval);
  deltas.set(ExpenseRecord.reasonDenied,record,reasonDenied);
  editRequest.fire(new Receiver<Void>(){
    public void onSuccess(    Void ignore,    Set<SyncResult> response){
      String errorMessage=getErrorMessageFromSync(response);
      if (errorMessage.length() > 0) {
        syncCommit(record,errorMessage.length() > 0 ? errorMessage : null);
      }
    }
  }
);
}
