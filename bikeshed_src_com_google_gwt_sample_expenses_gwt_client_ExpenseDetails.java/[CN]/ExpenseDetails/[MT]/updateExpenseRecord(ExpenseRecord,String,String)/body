{
  if (Expenses.Approval.APPROVED.is(approval) && !Expenses.Approval.APPROVED.is(record.getApproval())) {
    double amount=record.getAmount();
    if (amount + totalApproved > MAX_COST) {
      syncCommit(record,"The total approved amount for an expense report cannot exceed $" + MAX_COST + ".");
      return;
    }
  }
  DeltaValueStore deltas=expensesRequestFactory.getValueStore().spawnDeltaView();
  deltas.set(ExpenseRecord.approval,record,approval);
  deltas.set(ExpenseRecord.reasonDenied,record,reasonDenied);
  expensesRequestFactory.syncRequest(deltas).to(new Receiver<Set<SyncResult>>(){
    public void onSuccess(    Set<SyncResult> response){
      String errorMessage=getErrorMessageFromSync(response);
      if (errorMessage.length() > 0) {
        syncCommit(record,errorMessage.length() > 0 ? errorMessage : null);
      }
    }
  }
).fire();
}
